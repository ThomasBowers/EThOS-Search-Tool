Inner Triplet Quadrupole Fringe Fields in the High Luminosity Large Hadron Collider
Inner Triplet Quadrupole Fringe Fields
in the High Luminosity Large Hadron
Collider
Thesis submitted in accordance with the requirements of
the University of Liverpool for the degree of Doctor in Philosophy by
Sam Jones
22nd June 2019
Contents
List of Figures vii
List of Tables xi
Abstract xiii
Acknowledgements xv
1 Introduction 1
2 Literature Review 3
2.1 HL-LHC studies . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3
2.1.1 The effect of fringe fields on the linear optics of the HL-LHC . . . 3
2.1.2 Numeric estimate of the impact of the fringe fields . . . . . . . . . 4
2.1.3 Dynamic aperture studies for the HL-LHC optics . . . . . . . . . . 4
2.2 Benchmarking SAMM against PTC and MAD-X using LHC optics . . . . 5
2.3 Generalised gradients . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5
2.4 Differential algebra BlitzDA code . . . . . . . . . . . . . . . . . . . . . . . 6
2.5 Analytic description of a fringe field . . . . . . . . . . . . . . . . . . . . . 6
2.6 Frequency map analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
3 Physics Theory 9
3.1 Magnets in accelerators . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9
3.1.1 Multipole fields . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9
3.1.2 Quadrupoles . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15
3.1.3 HL-LHC lattice . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16
3.1.4 Fringe fields . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
3.1.5 Enge fields . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 20
3.1.6 Generalised gradients . . . . . . . . . . . . . . . . . . . . . . . . . 21
3.1.7 Electromagnetic fields with s-dependence . . . . . . . . . . . . . . 25
3.2 Particle dynamics discussion . . . . . . . . . . . . . . . . . . . . . . . . . . 26
3.2.1 Newtonian mechanics . . . . . . . . . . . . . . . . . . . . . . . . . 26
3.2.2 Lagrangian mechanics . . . . . . . . . . . . . . . . . . . . . . . . . 27
3.2.3 Hamiltonian mechanics . . . . . . . . . . . . . . . . . . . . . . . . 28
3.2.4 Dynamical variables from a Hamiltonian . . . . . . . . . . . . . . . 29
3.2.5 Transfer maps for beamline elements . . . . . . . . . . . . . . . . . 31
3.2.6 Symplecticity . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34
Contents iv
3.2.7 The FODO lattice . . . . . . . . . . . . . . . . . . . . . . . . . . . 34
3.2.8 Courant-Snyder parameters . . . . . . . . . . . . . . . . . . . . . . 36
3.2.9 Chromaticity . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42
Chromaticity of a FODO . . . . . . . . . . . . . . . . . . . . . . . 43
Chromaticity in a storage ring . . . . . . . . . . . . . . . . . . . . 43
3.2.10 Tracking with many particles . . . . . . . . . . . . . . . . . . . . . 44
3.2.11 Coupled optics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 47
3.2.12 Tune shift with amplitude and frequency map analysis . . . . . . . 47
3.2.13 Dynamic aperture . . . . . . . . . . . . . . . . . . . . . . . . . . . 49
3.3 Numeric integration methods . . . . . . . . . . . . . . . . . . . . . . . . . 49
3.3.1 Wu-Forest-Robin . . . . . . . . . . . . . . . . . . . . . . . . . . . . 50
3.3.2 Implicit Runge-Kutta . . . . . . . . . . . . . . . . . . . . . . . . . 53
4 Method 57
4.1 Magnetic field descriptions of the inner triplet . . . . . . . . . . . . . . . . 58
4.1.1 Simulating the numeric field . . . . . . . . . . . . . . . . . . . . . . 58
4.1.2 Fitting the Enge field . . . . . . . . . . . . . . . . . . . . . . . . . 59
4.1.3 Generating the generalised gradients . . . . . . . . . . . . . . . . . 62
Cylindrical surface data creation . . . . . . . . . . . . . . . . . . . 63
Constructing generalised gradients from surface data . . . . . . . . 67
4.2 Construction of the HL-LHC in the simulation . . . . . . . . . . . . . . . 71
4.2.1 Importing a MAD lattice into SAMM . . . . . . . . . . . . . . . . 71
4.2.2 Adding fringe fields to the HL-LHC lattice . . . . . . . . . . . . . 71
4.2.3 Restoring the desired chromaticity of the HL-LHC lattice . . . . . 72
4.3 Techniques used to produce results . . . . . . . . . . . . . . . . . . . . . . 73
4.3.1 Transfer functions . . . . . . . . . . . . . . . . . . . . . . . . . . . 73
4.3.2 Numerical analysis of fundamental frequencies (NAFF) . . . . . . 73
4.3.3 Chromaticity investigations . . . . . . . . . . . . . . . . . . . . . . 74
4.3.4 Tune shift with amplitude . . . . . . . . . . . . . . . . . . . . . . . 74
4.3.5 Frequency map analysis . . . . . . . . . . . . . . . . . . . . . . . . 75
4.3.6 Processing the tracking results . . . . . . . . . . . . . . . . . . . . 75
4.4 BlitzDA differential algebra code . . . . . . . . . . . . . . . . . . . . . . . 76
4.5 SAMM particle tracking code . . . . . . . . . . . . . . . . . . . . . . . . . 76
5 Results 79
5.1 Generalised gradients . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79
5.2 Transfer functions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 85
5.3 Chromaticity . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 93
5.4 Tune shift with amplitude . . . . . . . . . . . . . . . . . . . . . . . . . . . 98
5.5 Frequency map analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . 101
6 Conclusions 115
6.1 Summary and conclusions . . . . . . . . . . . . . . . . . . . . . . . . . . . 115
6.2 Recommendations for further work . . . . . . . . . . . . . . . . . . . . . . 116
6.3 Closing remarks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 118
List of Publications 119
v Contents
Bibliography 121
List of Figures
3.1 The field line and pole face geometries for normal and skew multipoles
from dipole up to sextupole. . . . . . . . . . . . . . . . . . . . . . . . . . . 13
3.2 The field line and pole face geometries for normal and skew multipoles of
the octupole and dodecapole (12-pole). . . . . . . . . . . . . . . . . . . . . 14
3.3 The force field on a positive charge, travelling perpendicularly and into
the plane of the paper, due to a normal quadrupole field. . . . . . . . . . 16
3.4 A schematic of the inner triplet configurations of the HL-LHC and LHC.
The comparison between the field strengths of the quadrupoles and dipoles
and their distances from the interaction point is shown [2]. . . . . . . . . . 18
3.5 The Courant-Snyder parameters, for collision optics, in a 1000m section
of inner triplet section which includes an interaction point [2]. . . . . . . . 18
3.6 A comparison of a hard-edge field model against a linear model and also
an Enge fringe field model. . . . . . . . . . . . . . . . . . . . . . . . . . . 21
3.7 The normal component of a demonstrative wiggler magnetic field on a
circular cylindrical surface. . . . . . . . . . . . . . . . . . . . . . . . . . . 26
3.8 The phase space results of tracking a particle, with a horizontal deviation
from the closed orbit, through a FODO cell. . . . . . . . . . . . . . . . . . 37
3.9 A horizontal phase space ellipse for a given action Jx, and its features in
relation to Courant-Snyder parameters x, x, and x. . . . . . . . . . . . 40
3.10 The beta function calculated when tracking through a FODO cell. . . . . 41
4.1 The magnetic field data of an HL-LHC inner triplet quadrupole magnet
produced via simulation using an electromagnetic code. The horizontal
component is shown, Bx, at x = 0 mm and for different y values. The field
spans the region, along the z axis, between full field in the body of the
magnet and vacuum. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 58
4.2 A comparison between a simulated field of the HL-LHC fringe region, and
an analytic Enge field model which has been fit to the simulated field. . . 61
4.3 A contour plot of the numeric field component normal to the curved
surface of a circular cylinder, with an axis along the magnetic axis. . . . . 65
4.4 A contour plot of the analytic Enge field component normal to the curved
surface of a circular cylinder, with an axis along the magnetic axis. . . . . 65
4.5 A contour plot of the difference in the magnetic field component normal to
the curved surface of a circular cylinder between the numeric and analytic
Enge fields. The cylinder axis lies along the magnetic axis. . . . . . . . . . 66
4.6 The magnitude of the 2-D Fourier transform of the numeric surface data.
Fourier transforms were performed in  and z. The Fourier transform is
shown across the  and z wavenumbers. . . . . . . . . . . . . . . . . . . . 68
List of Figures viii
4.7 The magnitude of the 2-D Fourier transform of the analytic Enge surface
data. Fourier transforms were performed in  and z. The Fourier transform
is shown across the  and z wavenumbers. . . . . . . . . . . . . . . . . . . 69
4.8 A schematic showing how drifts and a retuning element are added in
combination with the fringe fields on either side of the inner triplet. . . . 72
5.1 A comparison of the generalised gradients, for multipole m = 2 and orders
from l = 0 up to 7, of the analytic Enge field and the numeric field. . . . . 82
5.2 A comparison of the generalised gradients, for multipole m = 4 and orders
from l = 0 upto 7, of the analytic Enge field and the numeric field. . . . . 83
5.3 A comparison of the generalised gradients, for multipole m = 6 and orders
from l = 0 up to 7, of the analytic Enge field and the numeric field. . . . . 84
5.4 The transfer functions of the Enge field Runge-Kutta model. . . . . . . . 86
5.5 The transfer functions of the Enge field Taylor map model. . . . . . . . . 87
5.6 The transfer functions of the numeric field Runge-Kutta model. . . . . . . 88
5.7 The transfer functions of the numeric field Taylor map model. . . . . . . . 89
5.8 The tune of a particle with respect to its deviation from the reference
energy (chromaticity), for different fringe field models, in the horizontal
and vertical phase space. The different fringe field models are for the
Taylor maps/implicit Runge-Kutta integrators using the analytic/numeric
fields, as well as the case of no fringe field. . . . . . . . . . . . . . . . . . . 95
5.9 The tune of a particle with respect to its deviation from the closed orbit,
for different fringe field models, in the horizontal and vertical phase space.
The different fringe field models are for the Taylor maps/implicit Runge-
Kutta integrators using the analytic/numeric fields, as well as the case of
no fringe field. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 99
5.10 Frequency maps in amplitude space for the lattice without a fringe field.
The tune diffusion rate is shown in relationship to particles different
amplitudes from the closed orbit. . . . . . . . . . . . . . . . . . . . . . . . 103
5.11 Frequency maps in tune space for the lattice without a fringe field model.
The tune diffusion rate is shown in relationship to particles different
amplitudes from the closed orbit. . . . . . . . . . . . . . . . . . . . . . . . 104
5.12 Frequency maps in amplitude space for the lattice with the analytic Runge-
Kutta fringe field model. The tune diffusion rate is shown in relationship
to particles different amplitudes from the closed orbit. . . . . . . . . . . . 105
5.13 Frequency maps in tune space for the lattice with the analytic Runge-
Kutta fringe field model. The tune diffusion rate is shown in relationship
to particles different amplitudes from the closed orbit. . . . . . . . . . . . 106
5.14 Frequency maps in amplitude space for the lattice with the analytic Taylor
map fringe field model. The tune diffusion rate is shown in relationship to
particles different amplitudes from the closed orbit. . . . . . . . . . . . . . 107
5.15 Frequency maps in tune space for the lattice with the analytic Taylor map
fringe field model. The tune diffusion rate is shown in relationship to
particles different amplitudes from the closed orbit. . . . . . . . . . . . . . 108
5.16 Frequency maps in amplitude space for the lattice with the simulated
Runge-Kutta fringe field model. The tune diffusion rate is shown in
relationship to particles different amplitudes from the closed orbit. . . . . 109
ix List of Figures
5.17 Frequency maps in tune space for the lattice with the simulated Runge-
Kutta fringe field model. The tune diffusion rate is shown in relationship
to particles different amplitudes from the closed orbit. . . . . . . . . . . . 110
5.18 Frequency maps in amplitude space for the lattice with the simulated
Taylor map fringe field model. The tune diffusion rate is shown in rela-
tionship to particles different amplitudes from the closed orbit. . . . . . . 111
5.19 Frequency maps in tune space for the lattice with the simulated Taylor
map fringe field model. The tune diffusion rate is shown in relationship to
particles different amplitudes from the closed orbit. . . . . . . . . . . . . . 112
List of Tables
3.1 The comparison of machine parameters for the LHC and HL-LHC [2,
Table 2.1]. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
3.2 The comparison of machine optics for the LHC and HL-LHC [2]. . . . . . 20
4.1 The values of the free parameters used to fit the analytic Enge field model
to the simulated numeric field data. . . . . . . . . . . . . . . . . . . . . . 60
5.1 The transfer function polynomial fit coefficients for the Enge field Runge-
Kutta. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90
5.2 The transfer function polynomial fit coefficients for the Enge field Taylor
map. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90
5.3 The transfer function polynomial fit coefficients for the numeric field
Runge-Kutta. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90
5.4 The transfer function polynomial fit coefficients for the numeric field Taylor
map. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90
5.5 Table of fit coefficients for the horizontal chromaticity results. The MAD
chromaticity result is included to provide a comparison. . . . . . . . . . . 94
5.6 Table of fit coefficients for the vertical chromaticity results determined
by SAMM for different lattice configurations. The chromaticity result
calculated using MAD is included to provide a comparison. . . . . . . . . 96
5.7 The retuning factor values for each fringe field case. . . . . . . . . . . . . 97
5.8 Table of fit coefficients for the horizontal tune shift with amplitude results.
The MAD tune result is included to provide a comparison. . . . . . . . . . 100
5.9 Table of fit coefficients for the vertical tune shift with amplitude results.
The MAD tune result is included to provide a comparison. . . . . . . . . . 100
5.10 An estimate of the dynamic aperture for each of the frequency map analysis
results, of a given model and energy deviation. The estimate is of the
greatest amplitude for which particles on the x-axis or y-axis. . . . . . . . 102
Abstract
The High Luminosity Large Hadron Collider is an upgrade to the Large Hadron Collider
which aims to produce more collisions over a single run of the accelerator. To do so,
there is an effort to improve the peak luminosity of the existing machine by a factor
of 5, and the total luminosity over time (integrated luminosity) by a factor of 10. To
increase the luminosity of the machine, one crucial way is to reduce the size of the beam
at the point of collision. To make a smaller beam, stronger focusing magnets are required.
Furthermore, the beam would also need to reach greater extents in the inner triplet
focusing magnets either side of the collision point. To facilitate the beam size in the inner
triplet magnets, the magnets require larger distances between poles. However, larger
distances between poles means that the tapering of the field at the end of the magnets
is more pronounced. These tapering fields are known as fringe fields, and they have a
nonlinear dynamical effect on the beam. This could mean a potentially disastrous effect
on the beam performance.
The goal of this thesis is to compare different fringe field models, and to observe the
differences between them.
An additional objective was to use a tracking code (SAMM) in a study of this kind. This
would be to test its extensibility for new work, and for its GPU tracking abilities.
The suitability of an analytic Enge field description for studies involving fringe fields was
also an aim of this work.
Though the results presented in this work show variations between the different models,
it is still possible that the fringe fields would have a large impact on the beam stability.
The result for the Enge field Taylor map showed a significant reduction in the stability
of the beam compared to the no fringe model. On the other hand the numeric field
Runge-Kutta fringe field model showed the opposite behaviour. Whereas the Enge field
Runge-Kutta and the numeric field Taylor map were found to be in closer agreement to
the no fringe model.
The analysis was successfully carried out using SAMM. Through this work its functionality
was extended to handle new field models and new integration routines. The GPU tracking
allowed frequency map analysis to be run on a desktop computer within a reasonable
timescale.
The analytic Enge model was shown to be an alternative to a numeric model, but further
work is required to find significant differences between them. The Enge model looks
like it could be used as a faster alternative to the numeric model in future projects that
require fringe field modelling.
Acknowledgements
I would like to thank my supervisors, Andrzej Wolski and David Newton, for their
guidance, help, and time. I found both of them be very intelligent and patient men. I
am grateful to have worked with them, and to have benefited from their mentorship.
I am very grateful to Sonal Mistry for the emotional and logistical support she has
provided me.
I would like to thank all the Cockcroft students who I shared my time at Cockcroft with.
I would like to particularly thank Alexandra Alexandrova, Alisa Healey, Chris Edmonds,
and Emilia Cruz-Alaniz.
To my family: Dave, Carol, and Jack. I am thankful for your love and support.
I would also like to thank Adam Kewley and Marcus Gallagher-Jones for their feedback
and support.
Chapter 1
Introduction
The Large Hadron Collider (LHC) is a particle accelerator that was constructed with
the goal of probing physics beyond the Standard Model [1]. The machine is primarily a
proton-proton collider1 with collision energies of 14 TeV. The data collected during the
proton-proton collisions is used to probe a range of different physics theories from the
Higgs boson to super symmetry. It is the products of the collisions that provide an insight
into different physical processes. It therefore follows that generating more collisions
will result in more data, and consequently enable statistically acute observations. The
amount of collisions is known as the luminosity, and the LHC was designed to have a
luminosity with a peak value of 1034 cm2 s1 [1].
The High Luminosity upgrade to the Large Hadron Collider (HL-LHC) is designed to
improve the peak luminosity of the existing machine by a factor of 5, and the total
luminosity over time (integrated luminosity) by a factor of 10 [2]. One method to increase
the luminosity of the collider is to ensure that the beam size at the point of collision, ,
is minimised. The smaller the beam size, the higher the density. This increased density
of the beams results in an increased probability of collisions.
Several changes to the LHC lattice are necessary to meet the specifications. Central
to the work presented in this thesis is the change to the inner triplet (IT) focusing
quadrupole magnets. To reduce  at the interaction region requires the beam to reach
a larger extent in the focusing inner triple quadrupoles either side of the interaction
point [3]. To accommodate the larger beam, the magnetic poles are required to be further
apart. The further apart the magnets, the greater the fringe fields extend from the edge
of the magnets. Fringe fields have a nonlinear effect on the beam and nonlinear effects
can significantly reduce the dynamic aperture and stability of the beam.
The work in this thesis aims to identify what potential effects the fringe fields from the
new IT magnets could have on the HL-LHC beam.
1The LHC can also be run as an ion-ion collider, for ions such as lead atoms.
Chapter 1. Introduction 2
Four different fringe field implementations have been investigated against each other
and the hard-edge model as is used in the HL-LHC v1.0 lattice used in SixTrack. The
four models are generated from two fields: a numeric field data from simulation and an
analytic Enge field fit to the former, and from two methods of integration: a truncated
Taylor map generated from a Wu-Forest-Robin integrator and a Runge-Kutta integrator.
These implementations were compared using several techniques:
1. Transfer functions were employed to examine the focusing properties of the fringe
fields.
2. The chromaticity of the lattice was calculated to determine whether the chromaticity
of the lattices with fringe fields agreed with the fringe free lattice.
3. The tune shift with amplitude of the lattice was calculated to examine simple
differences between the fringe field models. This is a simpler benchmark than the
more advanced frequency map analysis.
4. Finally frequency map analysis was performed to test the stability of the beam in
phase space and tune space.
Each of the techniques rely on particle tracking to numerically simulate the phase space
evolutions of particles within the lattice.
The tracking was performed using a program known as SAMM which allows the simulation
to be performed on a graphics card (GPU) using the CUDA language. Graphics cards are
known to have higher performance than general processors (CPUs) for highly parallelisable
tasks. The studies in this paper benefit from the speed improvement of GPU tracking.
Chapter 2
Literature Review
In this chapter, a background of topics relevant to this thesis is presented. Firstly, to set
the context, an overview of the literature detailing the High Luminosity upgrade to the
Large Hadron Collider (HL-LHC) is presented. Next, a comparison between the particle
tracking codes SAMM and MAD-X is given, to determine whether SAMM could be used
in this study. Then the technique of generalised gradients developed by Dragt et al. [4]
is critically reviewed, to determine its usefulness in providing accurate transfer maps
for fields with longitudinal dependence. Following on, a short description of the use of
David Newtons BlitzDA differential algebra code is presented, followed by a review of
the analytic fringe field model presented by Muratori et al. [5]. Finally, a short review of
frequency map analysis is given.
2.1 HL-LHC studies
2.1.1 The effect of fringe fields on the linear optics of the HL-LHC
Work carried out by Kelly et al. [6] in 2013 demonstrated how the fringe fields of the inner
triplet affect the linear optics of the HL-LHC. The optics were analysed using MAD-X [7]
in two optics scenarios known as SLHCV3.1b [8] and HLLHCV1.0 [9]. The fringe fields
were modelled using three functions each fitted piecewise to simulated magnetic field data.
The piecewise fitting uses two exponential models and one arctan model to provide a
piecewise analytic model between two chosen points s0 and s1. Because of this approach,
the nonzero Bz term that must exist in a fringe field is not modelled by the piecewise
fitting of the transverse field. The tracking was performed using a thick lens model
and the tracking element in MAD-X that corresponds to an inner triplet was replaced
with a combination of magnets representing the body and the fringe field. The body
was simulated as a truncated magnet with a strength equal to the magnet it replaced.
The fringe field was described by many smaller magnets, of equal length, with strength
Chapter 2. Literature Review 4
derived from the functions fit to fringe field data, i.e. each component magnet becomes
weaker further away from the body. The authors of the paper measured the change
in -beat due to the fringe fields. -beating occurs when the bunches oscillate with a
different frequency than expected by the Courant-Snyder parameters. It can happen
when the bunch and beamline Courant-Snyder parameters are not matched (equal) [10].
They concluded that the changes due to the field would have a detrimental effect on the
safety and efficient running of the accelerator.
Though Kelly et al. have successfully shown the impact of fringe fields, there is definitely
an opportunity to improve upon these studies by using a more detailed model, as well as
looking at potential effects beyond linear optics.
2.1.2 Numeric estimate of the impact of the fringe fields
In a study conducted by Dalena et al. [11] in 2014 a numerical estimate of the impact of
fringe fields was presented. The implementation details of how the fringe fields could be
integrated into the code SixTrack were also discussed. SixTrack has been described as
the workhorse for studies at CERN which require simulation of the beam dynamics [12],
and a particular topic noted by the paper was dynamic aperture studies. The authors
use magnetic field data to construct generalised gradients.
The study then compares a Lie algebra transformation, which uses the vector potential
calculated from the generalised gradients, to a symplectic integrator, which uses the
Lorentz force and finds them comparable. This is a useful result because it shows
generalised gradients can be used to process the inner triplet field.
2.1.3 Dynamic aperture studies for the HL-LHC optics
De Maria et al. [13] in 2015 conducted dynamic aperture studies in the HL-LHC. This
was to determine the inner triplet field quality necessary to meet the machines dynamic
aperture requirements. This study did not include quadrupole fringe fields.
Dynamic aperture studies are presented for the HL-LHCV1.0 lattice with round beam
optics of  = 15 cm. It was found that the dynamic aperture is a lot smaller compared
to a lattice with a larger .
The dynamic aperture results serve as an interesting comparison with the frequency map
analysis performed in this study.
5 Chapter 2. Literature Review
2.2 Benchmarking SAMM against PTC and MAD-X using
LHC optics
The Simple Accelerator Modelling in Matlab (SAMM) code [14] is used in this thesis
and described in more detail in section 4.5. A paper by Hock et al. [15] in 2013 presents
benchmarks of SAMM against PTC [16] and MAD-X [7]. In that study a MAD-X
sequence file (LHC V6.500) is used for describing a set of LHC optics. Each program is
used to interpret the optics files and then the tracking results were compared. Additionally,
results of tracking through individual elements such as a quadrupole or kicker were also
compared. The paper found that whilst there were many agreements in the results
between the codes, there were some differences also. The paper notes that SAMM and
MAD-X use the paraxial approximation. The paraxial approximation is used in the
Wu-Forest-Robin integrator employed in this thesis. The paraxial approximation is
an approximation that can be made to expand the Hamiltonian by assuming that the
transverse momenta of the particles is small. Obviously this approximation may not be
appropriate if the transverse momenta of the particles is large, such as in the focusing
portion of a collider.
The paper suggests that the SAMM code could be a suitable candidate for beam tracking
studies. The simulation results for SAMM are in broad agreement with two other well
understood codes (MAD-X and PTC). SAMM code offers the additional advantage of
being flexible enough to allow the addition of bespoke features, such as GPU tracking
and implementation of new integration routines, which have been used in the production
of the results presented in this thesis.
2.3 Generalised gradients
In Mitchell et al. [4], a system is presented which allows high order derivatives of field data
to be computed in the representation of analytic generalised gradients. It is mentioned
that the generalised gradients rely on numeric field data to be fit onto a bounding cylinder.
In this geometric setup, harmonic fields take their extrema on the boundary and are
subject to a feature known as smoothing; this means that any noise on the surface is
damped towards the interior of the cylinder. This effect is more pronounced for larger
cylinder diameters. From the fitted surface field data the analytic generalised gradients
can be calculated, and from the gradients the magnetic field, B, magnetic scalar potential,
, and magnetic vector potential, A, can also be calculated. These results can then
be used in integrators to produce an accurate transfer map up to high orders, as it is
tolerant to noise amplification from differentiation as a result of the smoothing feature.
Mitchell et al. uses a non-physical monopole doublet setup for benchmarking; a proposed
ILC damping ring wiggler is also used for benchmarking [17]. The monopole doublet is
Chapter 2. Literature Review 6
analytically solvable but requires high order derivatives. It was found that the monopole
doublet setup was accurately described with a small impact from noise even up to 7th
order, and that the noise can be further reduced by more points in the surface field data.
The study found good agreement in the case of the ILC damping ring wiggler.
One limitation of the generalised gradients is that it does a poor job of calculating values
outside of the cylinder used to produce the generalised gradients. This is because the
damping of errors inside the cylinder also has the side effect that errors grow exponentially
outside of the cylinder. For this reason the generalised gradients should not be used to
calculate field values outside the cylinder.
To conclude, there is scope to use these techniques to describe a fringe field.
2.4 Differential algebra BlitzDA code
D. Newton developed a C++ differential algebra code (BlitzDA) for storing, manipulating,
and applying mathematical operations to polynomial objects. When used in conjunction
with the generalised gradient technique, the code is able to store a polynomial description
of magnetic or electric fields which are decomposed into their multipole elements and
spatial derivatives. It has been used to describe inner triplet magnets in the HL-LHC [18],
or electrostatic elements of ELENA [19, 20] and g-2 [21].
Therefore it is an appropriate tool to use for applying the generalised gradient technique
to the fields studied in this thesis.
2.5 Analytic description of a fringe field
In a study by Muratori et al. [5] in 2015 an analytic description of fringe fields of multipole
magnets was developed. Importantly the fringe fields of quadrupole magnets and higher
order magnets can be described using the expressions derived in this paper. This is
advantageous because whilst dipole fringe fields are easily modelled and implemented
in numeric tracking, implementing quadrupoles and higher order fringe fields depends
on numeric field models or series expansion from the axis. Numeric field models require
detailed models of the magnet or direct empirical measurement. Therefore future particle
tracking studies can take advantage of the techniques described in this paper to allow
fringe field effects to be taken into account earlier than would otherwise have been
possible. When considering series expansion about the axis, another advantage that
the expressions provide is that they are analytic in the transverse plane, which is a
more suitable model than series expansion for beams that cannot be assumed to travel
along the beam axis. In this paper, two examples used for benchmarking the analytic
description include an inner triplet quadrupole from the HL-LHC, and a magnet from
7 Chapter 2. Literature Review
the non-scaling FFAG EMMA [22]. The analytic expressions in both cases are in good
agreement with numerical field maps.
There is scope for an investigation into whether the differences between a numeric field
map and analytic expression would produce differences in particle tracking studies with
strong nonlinear dynamic features.
2.6 Frequency map analysis
Frequency map analysis is a technique for analysing the stable and chaotic motion at
different points in phase space. It was originally used in "celestial mechanics, galactic
dynamics, atomic physics Hamiltonian toy models" [23]; its use in particle accelerators was
outlined by Laskar [24]. Later, Papaphilippou uses frequency map analysis to investigate
some of the nonlinear dynamical properties of the LHC lattice [25, 23].
Generally speaking, frequency map analysis is used in conjunction with the method
Numerical Analysis of Fundamental Frequencies (NAFF). NAFF is able to determine
the fundamental frequencies (represented by peaks in frequency space) with an accuracy
orders of magnitude better than a Fourier transform alone [26].
Frequency map analysis is a useful tool because it can be used to identify more unstable
regions of the beam. These unstable regions can be used as an estimate of the dynamic
aperture. Using the frequency map analysis to find the dynamic aperture is better than
using survival studies which requires orders of magnitude more tracking and is therefore
much less efficient.
Chapter 3
Physics Theory
In this section, the theoretical concepts that underpin the results of the work done in
this thesis will be detailed.
3.1 Magnets in accelerators
Magnetic fields are a key tool for directing the motion of charged particles. This section
will introduce general concepts for working with magnetic fields. Focus will then move
to quadrupoles individually, and after introducing the High Luminosity upgrade to the
Large Hadron Collider (HL-LHC) lattice, their part to play within this lattice will be
explored. Finally the magnetic field models will be expanded to the case of fields with
s-dependence (such as fringe fields which are the continuous nonlinear tapering of a field
between full field and zero field regions). A concept called generalised gradients will be
discussed and its advantages in relation to s-dependent fields.
3.1.1 Multipole fields
Particle accelerators rely on electromagnetic fields to control the charged particles within
them. The forces these fields generate on the charged particles can be used to steer,
focus, and accelerate charged particles This can be seen in the Lorentz force:
FEM = q (E + v B) . (3.1)
The electromagnetic force, FEM, is the sum of the contributions due to the electric field,
E, and the magnetic field, B. The left hand side of the sum is the force acting parallel
and due to the electric field. The vector cross product on the right hand side of the
equation means that the force due to the magnetic field requires a moving particle with
Chapter 3. Physics Theory 10
charge, q, and it acts perpendicular to both the magnetic field and velocity of the charge,
v. Therefore the action that can be taken upon the charged particles is constrained by
the electromagnetic system that can be created.
The electromagnetic fields themselves must obey Maxwells equations, which can be
stated as follows:
 D =  , (3.2)
 B = 0 , (3.3)
 E = 
, (3.4)
H = J +
. (3.5)
There are several new parameters introduced in Maxwells equations above. The sources
of the electromagnetic field are the electric charge density, , and electric current density,
J . The permittivity of free space, 0, and the vacuum permeability, 0, both are constants
defined in vacuum to be:
, (3.6)
0 = 4  107Hm1 , (3.7)
where 0 has the units of henries per metre.
The speed of light, c, is also defined in relation to these constants as:
. (3.8)
The electric permittivity, , and magnetic permeability, , constants are described by:
 = r0 , (3.9)
 = r0 , (3.10)
where the r and r are the relative permittivity and relative permeability respectively
of the material in which the fields propagate. Lastly the electric displacement, D, and
magnetic intensity, H, are related to the magnetic field, B, and electric field, E, by:
11 Chapter 3. Physics Theory
D = E , (3.11)
B = H , (3.12)
The fields themselves in the region in which the particles travel can be assumed to be
charge free, and therefore the fields must also obey the charge-free Laplace equation:
V  2V = 0 , (3.13)
where V is the magnetic scalar potential. When written in cylindrical coordinates this
becomes [3, eq. 3.2]:
 0 . (3.14)
Equation (3.14) has a solution that, whilst it is not general, does contain all multipole
fields which will be described shortly [3, eq. 3.3]:
V = Rb
nein , (3.15)
V = Rb
An (x+ iy)n , (3.16)
where An are field coefficients derived from eq. (3.14), and Rb is the beam rigidity. The
beam rigidity is defined as:
Rb = B =
, (3.17)
where B is the magnetic field needed to steer a beam with rigidity, Rb (in T m), along
a circle of gyroradius . This can also be represented in terms of P0 the reference
momentum of the beam, and q the charge of the particles that make up the beam.
The magnetic field is related to the magnetic scalar potential as follows [3]:
B = H = V , (3.18)
where H is the magnetic H-field which satisfies eq. (3.12).
Chapter 3. Physics Theory 12
The constants in eq. (3.16) and the factor  introduced by eq. (3.18) can be represented
RbAn
n 1
. (3.19)
Using the relation in eq. (3.18), a standard set of fields known as the multipole fields
can be derived. The derivations are shown below as outlined by Wolski in [10]. The
multipole fields are solutions to Maxwells equations and the wave equation. They can
be described by eq. (3.20):
By + iBx =
Cn (x+ iy)n1 , (3.20)
where the index n refers to the multipole field (where n = 1 is a dipole field, n = 2 is a
quadrupole field, etc) and Cn are the multipole coefficients. The zeroth order multipole
field is the solenoid term that usually has zero Bx, By terms and non-zero Bz, therefore
it is not considered a multipole field. The multipole coefficients can be represented as:
Cn = |Cn|ein , (3.21)
Cn = bn + ian . (3.22)
Equation (3.21) shows that each multipole coefficient, Cn, can be represented as a scalar
value and an associated phase. Cn has units that depend on the order of the multipole,
n, C1 has units of the dipole field (T), C2 has units of the quadrupole field gradient
(T m1), C3 has units of the sextupole field strength (T m2), and so on.
The multipole components bn and an quantify the normal and skew components re-
spectively. In the case that the multipole components are represented as dimensionless
quantities, such as in eq. (3.24), then a reference field Bref and reference radius Rref are
required for scaling.
By + iBx = Bref
|Cn|ein
(3.23)
By + iBx = Bref
(bn + ian)
x+ iy
(3.24)
13 Chapter 3. Physics Theory
The surface of the magnetic poles should be shaped such that the magnet follows an
equipotential line of magnetic scalar potential, from eq. (3.1) associated with the required
field [10, p23].
(a) A normal dipole field. (b) A skew dipole field.
(c) A normal quadrupole field. (d) A skew quadrupole field.
(e) A normal sextupole field. (f) A skew sextupole field.
Figure 3.1: The field line (blue) and pole face (red) geometries for normal and skew
multipoles from dipole up to sextupole.
The shape of the multipole fields from dipole, n = 1, up to octupole, n = 4, as well as
the dodecapole field, n = 6, represented by eq. (3.20) are shown in figs. 3.1 and 3.2. As
Chapter 3. Physics Theory 14
(a) A normal octupole field. (b) A skew octupole field.
(c) A normal 12-pole field. (d) A skew 12-pole field.
Figure 3.2: The field line and pole face geometries for normal and skew multipoles of
the octupole and dodecapole (12-pole). The dodecapole has a sign change under /12
and as such is an allowed higher order multipole of the quadrupole.
can be seen in figs. 3.1 and 3.2, it is apparent that there is a set of orthogonal fields with
a rotation around the z axis of /2n. These are known as skew multipoles in comparison
with the unrotated normal multipoles.
Upon further inspection it is evident that the field direction is reversed upon each /n
rotation of the field around the z axis. In terms of the phase in eq. (3.21), normal
multipoles occur when n = 0 or n =  and skew multipoles when n = /2. In terms
of the dimensionless representation in eq. (3.22), normal multipoles occur when an = 0
and skew multipoles when bn = 0.
A rotation of /n about the z axis is equivalent to a change in n by . Consider a
field that is a combination of two multipoles of order m and n with m 6= n. Then a
rotation of the field by /n is equivalent in a change of n by , but a change in m is
equal to a change of m/n. Therefore to maintain symmetry (a change of sign through
a rotation of /n) the following must be true:
15 Chapter 3. Physics Theory
eim/n = 1 . (3.25)
Eulers identity and symmetry under 2 mean that eq. (3.25) leads to the result that
m/n = 3, 5, 7, . . .. It may not seem intuitive that higher order multipoles are given by
odd integer multipoles - but this is a necessary requirement to satisfy a change of sign
for a /n rotation. Figure 3.2 shows this clearly; in the case of a quadrupole multipole,
n = 2, a rotation of /n would result in an identical field for the octupole, where the
12-pole would have a change of sign. The higher order multipoles symmetries, that satisfy
eq. (3.25) for a given multipole n are known as allowed multipoles, and those that do
not as forbidden multipoles.
Production of pure multipole fields require infinitely long magnets, that are transversely
homogeneous.
3.1.2 Quadrupoles
The Lorentz force from eq. (3.1) states that the resultant force on a charge is perpendicular
to both a magnetic field and the direction of the charge through the field. A particle
travelling normal to the dipole field, as seen in fig. 3.1a, will experience forces in the
horizontal plane. Dipole fields therefore are often used to steer beams.
The quadrupole field can be seen in fig. 3.1c, from the figure it is evident that the field
geometry of a quadrupole is more complicated than that of the dipole. The quadrupole
term of the multipole expansion, n = 2, taken from eq. (3.20) is as follows:
By + iBx = Bref (b2 + ia2)
x+ iy
. (3.26)
The gradient of a quadrupole field is linear which can be seen when taking the derivative
of eq. (3.26),
x y=0
= Bref
b2 + ia2
. (3.27)
The quadrupole field is focusing in one direction whilst defocusing in the other as can be
seen in fig. 3.3.
A combination of alternating gradient quadrupoles separated by drifts provides strong
focusing in both axes of the transverse plane. This combination is known as a FODO
lattice and the physics behind it is covered in more detail in section 3.2.7.
Chapter 3. Physics Theory 16
Figure 3.3: The force field (red) on a positive charge, travelling perpendicularly and
into the plane of the paper, due to a normal quadrupole field (blue).
Quadrupole magnets transversely focus a particle beam and when used in conjunction
with bending dipole magnets are the basis of determining the desired path of a beam
within an accelerator [3, p68].
3.1.3 HL-LHC lattice
The High Luminosity Large Hadron Collider (HL-LHC) aims to increase the number of
collisions by a factor of 5 compared to the Large Hadron Collider [2].
There are several key improvements to the LHC lattice that were designed with this
goal in mind. The most important one for this discussion is the implementation of new
focusing quadrupoles. These quadrupoles come in the form of triplets either side of the
interaction (collision) points. One way to produce more particle collisions is to reduce
the size of the beam at the interaction point, known as . To accomplish a reduction in
, the size of the beam at the inner triplet quadrupoles must be large, and the inner
triplet must therefore have a stronger field gradient. Therefore the quadrupoles must be
designed with a larger aperture (the distance between magnetic poles) to accommodate
the beam, as well as having a larger field gradient.
The instantaneous luminosity of the HL-LHC can be described by [27]:
2frev
42
F , (3.28)
17 Chapter 3. Physics Theory
where nb is the number of bunches in lattice at one time. N is the number of particles
per bunch. frev is the revolution frequency for a particle with reference momentum.  is
relativistic gamma.  is a measure of the beam size at the interaction point. n is the
normalised emittance of the beam [27].
F = 1/
, (3.29)
F is a luminosity reduction factor due to geometric effects from the crossing angle
and hourglass effect. and z are the transverse and longitudinal r.m.s beam sizes
respectively [27].
The specifics of the lattice parameters are detailed in table 3.1 [2, Table 2.1]. The relevant
parameters with respect to luminosity improvements between the nominal LHC and
HL-LHC are: the number of particles per bunch (which has increased),  (which has
reduced), and the normalised emittance (which has reduced). These improvements are
mitigated by: a larger crossing angle and increased normalized beam-beam separation,
and a smaller number of bunches per beam. The result of these changes is a predicted
peak luminosity for the HL-LHC of 7.18 compared to 1 1034 cm2s1 for the nominal
The specifics of the lattice optics are detailed in table 3.2 [2, Table 2.2]. The HL-
LHC has been described by several succeeding lattice configurations SLHCv3.1b [8],
HLLHCv1.0 [9], and HLLHCv1.1 [28]. One key difference between them is the choice of
inner triplet magnets. SLHCv3.1b implements higher gradient 150 Tm1 Nb3Sn magnets
and overall shorter magnetic length. HL-LHC v1.0 and HL-LHC v1.1 are based on
140 Tm1 Nb3Sn magnets, but have a longer magnetic length, with Q1 and Q3 each
split into two components. To help visualise the differences between the LHC and the
HL-LHC, a schematic of the inner triplet is shown in fig. 3.4 [2, Figures 3.1 & 3.2].
A plot of the Courant-Snyder parameters of the inner triplet of the HL-LHC is shown in
fig. 3.5 [2, Figure 2.4]. The properties of a lattice can be described by Courant-Snyder
parameters (which are also commonly known as Twiss parameters) which are discussed
further in section 3.2.8. It is relevant to state here that the  functions is a description
of the relative beam size at a point in the lattice. As can be seen in fig. 3.5,  becomes
much larger either side of the interaction region reaching its greatest extent in the inner
triplets. This is necessary in order to reach a small . The larger  in the inner triplets
will thus result in a beam that is spread across a larger transverse area, and will result in
particles with larger amplitudes from the closed orbit. Particles with larger amplitudes
will be more affected by the nonlinear dynamics of the quadrupole fringe fields. This is
explained in more detail in the relevant subsections of section 3.2.
Chapter 3. Physics Theory 18
Figure 3.4: A schematic of the inner triplet configurations of the HL-LHC (top
image) and LHC (bottom image). The comparison between the field strengths of the
quadrupoles (Q) and dipoles (D) and their distances from the interaction point (IP) is
shown. The magnets have thick black outlines and cryostats that contain the magnets
have thin black outlines [2].
Figure 3.5: The Courant-Snyder parameters, for collision optics, in a 1000m section
of inner triplet section which includes an interaction point [2].
19 Chapter 3. Physics Theory
Table 3.1: The comparison of machine parameters for the LHC and HL-LHC [2, Table
2.1].
3.1.4 Fringe fields
In many applications it is reasonable to assume that the magnetic field does not vary
with longitudinal position. There is a further assumption that the field stops at some
position and there is a discontinuous change to a field-free region.
In reality the field of a magnet must falloff continuously in the boundary region between
the body of a magnet and a field-free region. The field in this boundary region is known
as a fringe field. The size of the fringe field is determined in part by the size of the
aperture of the magnet. A larger apertures means that the fallout region will also be
larger. As discussed in section 3.1.3, the inner triplet magnets have been designed with
larger apertures than before; in combination with the larger field gradient, the resultant
fringe fields will have a larger effect than those of the existing focusing magnets.
Chapter 3. Physics Theory 20
Table 3.2: The comparison of machine optics for the LHC and HL-LHC [2].
Fringe fields have a non-linear effect on the beam dynamics. Changes to the nonlinear
dynamics of a beam can produce substantial changes to a beam. It is therefore important
to understand and determine if the fringe fields of the HL-LHC inner triplet will have
any major effect on the HL-LHC beam.
3.1.5 Enge fields
The Enge field is a model that approximates the fall-off of a field between a field-free
region and the body of a magnet.
The equation for an Enge field is given by [29][30]:
F (s) = 1/
1 + exp
)i1)]
. (3.30)
Therefore, by eq. (3.30) a three parameter Enge field would be:
F (s) = 1/
1 + exp
a1 + a2
. (3.31)
21 Chapter 3. Physics Theory
-20 -15 -10 -5 0 5 10 15 20
Distance along the magnet axis [arb. unit]
Hard edge model
Enge model
Linear model
Figure 3.6: A comparison of a hard-edge field model against a linear model and also
an Enge fringe field model.
The advantage of such a model is that it is simple to calculate for a given set of parameters.
Different fringe fields can be modelled by varying the Enge parameters, ai.
One disadvantage of such a model is that it may not provide detailed enough features to
accurately portray the physical reality of a fringe field. Furthermore, the fitting of an
Enge field is complicated by the matter that the Enge parameters are dependent on each
other. For instance, adding an extra parameter requires recalculation of all parameters.
3.1.6 Generalised gradients
There will always be some level of uncertainty about the nature of reality, and sometimes
this is a limiting factor in the ability to construct the most accurate models. In other
cases though it may be that the limiting factor to construct an accurate model is instead
due to the intrinsic description or construction of the model itself. The next technique to
be discussed places some restrictions upon the electric or magnetic field; these restrictions
can provide advantages and a framework for reasoning about the fields themselves. The
Chapter 3. Physics Theory 22
technique involves the generation of a set of functions known as generalised gradients
that model the fields in an accelerator component [31].
For magnetic fields with high order which may impact on the beam dynamics of an
accelerator, it may be necessary to construct a transfer map that is an accurate model of
the high order impact from the component. High order transfer maps will require high
order derivatives; unfortunately a direct approach of iterating through each derivative
by calculating each numerically from field data is very sensitive to noise. Factors like
truncation, round-off, or error on the field measurements can have too large an impact
on numerically calculated high order derivatives. Instead of a direct numeric approach,
the generalised gradients technique uses the field data to generate a set of functions that
satisfy Maxwells equations and can be differentiated analytically to calculate higher order
terms. The field described by the generalised gradients must differ from the field used to
generate it, but it also has a property known as numeric error smoothing. The smoothing
means the errors on the field description becomes smaller the closer to the central axis
of the model. It is important to note that the errors on the field description grow
larger when calculating fields radially outside of the cylinder. Therefore the generalised
gradients should not be used to extrapole fields outside of the original cylinder used to
create it 1.
There are several methods for calculating generalised gradients. These involve the use
of field data situated on circular, elliptical, or rectangular cylinders. They can also be
found using potential data on a circular cylinder. The data from an experimental or
theoretical model does not have to lie on these cylinders required for the generalised
gradients. Instead the data required at points on the surface of the cylinder can be
calculated via interpolation.
In this study generalised gradients were calculated using the normal component of the
magnetic field on the surface of a circular cylinder, B (R,, z). The first step is to
perform Fourier transforms on the surface data along  and z [31, eq 17.3.1 & 17.3.2] 2:
B (R,m, z) =
d exp (im)B (R,, z) , (3.32)
B (R,m, k) =
dz exp (ikz) B (R,m, z) . (3.33)
The Fourier transforms can be performed in either order to get the following result [31,
eq 17.3.3]:
1The inner triplet quadrupoles studied in this work are designed to be placed at parts of the lattice
where the beam is far from the magnetic axis. As will be seen in section 4.1, the cylinder cross section
chosen to calculate the generalised gradients is much larger than the maximum extent of the particles in
the inner triplet of the HL-LHC.
2Unless otherwise stated i is the imaginary unit i =
23 Chapter 3. Physics Theory
B (R,m, k) = [1/2]2
dz exp (ikz)
d exp (im)B (R,, z) . (3.34)
The normal component of the magnetic field is related to the scalar potential of the field
by [31, eq 17.3.4]:
B (R,, z) = [ (, , z)]=R . (3.35)
This equation is equivalent to the expression from eq. (3.18), but for the case of the
normal component on cylindrical geometry. Dragt derives a general scalar potential, ,
in cylindrical coordinates that satisfies Laplaces equation [31, eq. 15.3.7]. Substituting
that expression of the scalar potential in to eq. (3.35) gives [31, eq 17.3.5]:
B (R,, z) =
dkGm (k) exp (ikz) exp (im) kIm (kR) , (3.36)
where Im (kR) are the modified Bessel functions, and Gm (k) are arbitrary functions.
Dragt has derived an expression of the generalised gradients, C [n]m (z), in terms of the
arbitrary functions, Gm (k), from the general scalar potential solution [31, eq. 15.3.15].
Dragt shows that by substituting eq. (3.36) into eq. (3.34), that the generalised gradients
can now be stated in terms of the Fourier transformed field, B [31, eq 17.3.8]:
C [n]m (z) = i
n (1/2)|m| (1/|m|)
kn+|m|1/Im (kR)
B (R,m, k) exp (ikz) .
(3.37)
The exponential smoothing mentioned earlier is a result [31, eq 17.3.9]:
|Im (kR) |  exp (|k|R) /
2|k|R as |k|   . (3.38)
As Im (kR) is in the denominator of eq. (3.37) it means that the contributions from high
order noise are exponentially reduced.
Whilst deriving a general solution to Laplaces equation, Dragt let the scalar potential, ,
take a complex form. Dragt derives a result in terms of a scalar potential, , that is real;
this result has expressions of the generalised gradients that are decomposed into cosine
and sine harmonics [31, eq. 15.3.33]. A similar approach is taken by Dragt to decompose
the generalised gradients in eq. (3.37) in to cosine and sine components [31, eq 17.3.23]:
Chapter 3. Physics Theory 24
C [n]m, (z) = i
n (1/2)m (1/m)
kn+m1/Im (kR)
B (R,m, k) exp (ikz) , (3.39)
where m > 0, and C [n]m, is either the cosine or sine generalised gradient,   (c, s). B is
given by [31, eq 17.3.21]:
Bc (R,m = 0, k) =
dz exp (ikz) Bc (R,m = 0, z) , (3.40)
where [31, eq 17.3.22]:
Bc (R,m = 0, z) = B (R,m = 0, z) =
dB (R,, z) . (3.41)
It should be noted that m corresponds to the multipole harmonic over . Equation (3.39)
provides the generalised gradients for fields with m > 0, the monopole (solenoid) fields
are given by [31, eq 17.3.24 & 17.3.25]:
m=0,s (z) = 0 , (3.42)
m=0,c (z) = C
0 (z) = i
kn1/I0 (kR)
Bc (R,m = 0, k) exp (ikz) . (3.43)
Although Dragt does offer an alternative to generating monopole generalised gradients
using the normal component of the cylindrical surface data (eqs. (3.42) and (3.43)), and
instead suggests the longitudinal component[31].
It has been established how to generate generalised gradients from cylindrical surface
data. The generalised gradients are a generalisation of the multipole description (for
which fields are constant in s) to fields that have s-dependence. Therefore the generalised
gradients offer a description of a field that is decomposed into its multipole harmonics,
as well as its longitudinal harmonics.
Dragt provides expressions of the vector potential in the azimuthal-free gauge [31,
eq. 15.4.2]:
A = 0 . (3.44)
25 Chapter 3. Physics Theory
The azimuthal-free gauge is a gauge transformation for which the azimuthal component is
chosen to be 0. Dragt provides the following results for the vector potential [31, eq.15.4.21
- 15.4.26]:
Am,cx = (1/m)x Im[(x+ iy)
(1)l
22ll(l +m)
C [2l+1]m,c (z)(x
2 + y2)l , (3.45)
Am,cy = (1/m)y Im[(x+ iy)
(1)l
22ll(l +m)
C [2l+1]m,c (z)(x
2 + y2)l , (3.46)
Am,cz = (1/m) Im[(x+ iy)
(1)l
(2l +m)m
22ll(l +m)
C [2l]m,c(z)(x
2 + y2)l , (3.47)
Am,sx = (1/m)xRe[(x+ iy)
(1)l
22ll(l +m)
C [2l+1]m,s (z)(x
2 + y2)l , (3.48)
Am,sy = (1/m)yRe[(x+ iy)
(1)l
22ll(l +m)
C [2l+1]m,s (z)(x
2 + y2)l , (3.49)
Am,sz = (1/m) Re[(x+ iy)
(1)l
(2l +m)m
22ll(l +m)
C [2l]m,s(z)(x
2 + y2)l . (3.50)
The generalised gradients can be used to describe the fringe field of HL-LHC inner triplet
by using a sample of the magnetic field on the surface of a cylinder. It has the property
of smoothing such that noise is exponentially damped when reconstructing fields inside
the cylinder. The generalised gradients will then allow vector potentials to be calculated
for arbitrary points along s. The vector potential can then be used in various integrators
to provide transfer maps of the fringe field.
3.1.7 Electromagnetic fields with s-dependence
Fringe fields are not the only fields to exhibit s-dependence. For example, free electron
lasers (FELs) make use of repeating configurations of magnets to produce an oscillating
path through the magnets for a given particle [3]. This magnet configuration is known
as an undulator or a wiggler depending on the wiggler strength K [3].
K = CKB0p , (3.51)
where the magnetic field B0 is in Teslas and p is in centimetres. CK is a constant:
2mc2
= 0.934 T1cm1 . (3.52)
As an aside, a wiggler is for a configuration where K  1.
Chapter 3. Physics Theory 26
Figure 3.7: The normal component of a demonstrative wiggler magnetic field on a
circular cylindrical surface.
In fig. 3.7 the s-dependence of the wiggler can be seen. The field is changing with z
direction which is collinear with s due to it being a straight line element. Figure 3.7
shows the normal component of the magnetic field on a circular cylinder centred on the
longitudinal axis of the accelerator component. The normal component of the field on a
cylinder is the first step towards generating generalised gradients. A similar technique is
used for the inner triplet HL-LHC magnets in the method chapter (section 4.1.3).
This shows that the generalised gradient method can be used for other fields with
s-dependence and not just for quadrupole fringe fields.
3.2 Particle dynamics discussion
In this section the different methods to describe the dynamical nature of particles within
an accelerator are presented.
3.2.1 Newtonian mechanics
The method of Newtonian mechanics relies on the Newtonian equation where the force,
F , is defined as the change in momentum, p, over time, eq. (3.53), whilst the forces
27 Chapter 3. Physics Theory
applied are described by the Lorentz Force in eq. (3.1).
(3.53)
FEM = q (E + v B) (3.1 revisited)
Solving eq. (3.53) involves integrating with respect to time. This is inconvenient as the
positions of electric and magnetic fields in the accelerator are better parametrised in
terms of position, instead of time.
The Lagrangian and Hamiltonian can be parametrised with respect to position and
therefore each have an advantage over Newtonian formulations.
3.2.2 Lagrangian mechanics
There exists a set of equations known as the Euler-Lagrange equations [3, eq. 1.63 - 1.65]:
= 0 , (3.54)
where the Lagrangian, L = L(qi, qi; t), can be any function where qi and qi are the
canonical variables of position and velocity and t is the independent variable time. For
the case of the Euler-Lagrange equations the action over a path of motion between two
points (t1 and t2) is a minimum point.
S = 
L(t)dt = 0 . (3.55)
Where  represents the change resulting from a change in path between the t1 and t2,
and S is the action.
The Lagrangian can be chosen to suit the problem being solved. For example the simple
case of a non-relativistic system without dissipative forces can be represented by [32]:
L = T  V , (3.56)
where T is the kinetic energy of the system and V is the potential energy of the system.
The choice of Lagrangian is not unique to the problem; any choice of Lagrangian is valid
if it is a solution to the Euler-Lagrange equations. Wiedemann derives the following
Lagrangian [3, eq. 1.86]:
Chapter 3. Physics Theory 28
L = mc
c2  x2  y2  h2z2 + e (xAx + yAy + hzAz) e , (3.57)
where [3, eq. 1.85]:
h = 1 + xx+ yy , (3.58)
and x, y, z and x, y, z are the coordinates and velocities using a Frenet-Serret coordinate
system. Ax,y,z are components of the vector potential of the magnetic field. The Frenet-
Serret coordinates are curvilinear. xx represents the curvature of the reference trajectory
of the particles. The Lagrangian in eq. (3.57) can be used to describe the motion of a
charged particle within an electromagnetic field. Wiedemann derives equations of motion
from this Lagrangian [3, eqs 2.42 a & b]:
x  xh (1 )
hBy  yBz
, (3.59)
y  yh+ (1 )
hBx  xBz
, (3.60)
where p0 is the reference momentum of a particle, and  is the momentum deviation
from the reference momentum. Ex,y,z and Bx,y,z are the electric and magnetic field
respectively. These equations of motions are not symplectic and therefore not suitable for
long term tracking. Symplecticity is a guarantee that areas of phase space are conserved
when applying a transfer map. If a transfer map is not symplectic then small errors
affecting phase space area can grow and lead to incorrect results (see section 3.2.6) [3].
3.2.3 Hamiltonian mechanics
The Hamiltonian can be derived in terms of a suitable Lagrangian:
H (qi, pi) =
qiPi  L (qi, qi) , (3.61)
where the Hamiltonian is a function H(x, p; t), and x and p are the canonical variables
of position and canonical momentum, and t is the independent variable time. Canonical
momentum can also be represented in terms of the Lagrangian:
, (3.62)
29 Chapter 3. Physics Theory
which is to be distinguished from the mechanical momentum mv.
The equations of motions for the Hamiltonian, or Hamiltons equations, are:
, (3.63)
. (3.64)
Compared to the set of second order differential Euler-Lagrange equations, the first order
differential Hamiltons equations are less complex to work with and so the Hamiltonian
is preferable in that regard [10].
3.2.4 Dynamical variables from a Hamiltonian
The derivation of dynamical variables from a Hamiltonian is given below, as described
by Wolski [32]. The Hamiltonian can take the form:
H = T + V , (3.65)
where similar to the Lagrangian, T is the kinetic energy and V is the potential energy of
the system. Substituting in expressions for the kinetic energy and potential energy into
eq. (3.65) gives:
(p qA)2 c2 +m2c4 + q , (3.66)
where A and  are the vector and scalar potentials of the magnetic field respectively.
The electric charge of a test charge inside the field is given by q, and its mass is given by
m. The charge travels in the field with a momentum p.
It is useful to use the path length along the accelerator, s, as the independent variable
instead of the time, t. This is because magnetic fields and other structures are placed
along the lattice at certain path lengths. Therefore it is easier to describe when a particle
reaches certain components in terms of path length, s, as opposed to the time, t. Using
the principle of least action (eq. (3.55), Wolski derives a choice of canonical variables that
provides a description of the motion in terms of path length; these canonical variables
are (x, px), (y, py), (t,H). Rearranging eq. (3.66) in terms of pz gives:
(E  q)2
m2c2  (px  qAx)2  (py  qAy)2 + qAz . (3.67)
Chapter 3. Physics Theory 30
H1 can then be substituted for pz to give:
H1 = 
(E  q)2
m2c2  (px  qAx)2  (py  qAy)2  qAz . (3.68)
Wolski recommends normalising the momenta with respect to the reference momentum
e.g. pi/P0. Such a normalisation will also require normalisation of the Hamiltonian
too, H = H1/P0. This will result in the following Hamiltonian represented in terms
normalised momenta:
H = 
(E  q)2
P 20 c
 (px  ax)2  (py  ay)2  az , (3.69)
where the normalised vector potential is given by:
a = q
. (3.70)
Wolski applies a further translation to change the longitudinal momentum, E/P0, into
the energy deviation, . An energy deviation,  = 0, represents a particle that has
momentum equal to the reference momentum. The energy deviation is a more convenient
description than the longitudinal momentum, which would be close to the speed of light
for each particle E/P0 = c. The Hamiltonian in the new coordinates is [32, Lecture 2 eq.
+  
 (px  ax)2  (py  ay)2 
 az . (3.71)
eq. (3.71) describes the motion along a straight reference trajectory, i.e. for straight
elements. Bending magnets, e.g. dipoles, have a curved reference trajectory. Wolski
derives a Hamiltonian for elements with a curved reference trajectory:
H =  (1 + hx)
+  
 (px  ax)2  (py  ay)2 
(1 + hx) as+
(3.72)
where curvature is defined as:
. (3.73)
31 Chapter 3. Physics Theory
Hamiltons equations can also be written in terms of s as the independent variable:
, (3.74)
. (3.75)
The Hamiltonian (for straight and curved elements) can now be used to produce symplectic
maps. This is will be done by expanding the Hamiltonian to second order in terms of
the dynamical variables.
3.2.5 Transfer maps for beamline elements
A transfer map describes how the phase space variables change between an initial point,
s0, and final point, s1, along a path length, s. A transfer map can be found using a
suitable Hamiltonian and Hamiltons equations. Arbitrary electromagnetic geometries
can then be investigated by using the scalar and vector potentials,  and a, of the
field with an appropriate Hamiltonian. The following derivations follow those given by
Wolski [32].
As an example, applying the field free case,  = 0 and a = 0 to the Hamiltonian in
eq. (3.71) gives:
 (px)2  (py)2 
. (3.76)
The Hamiltonian above has no dependence on position, xi; therefore by Hamiltons
equations (eq. (3.75)) there should be no change in the momenta, i.e.:
px = 0 , (3.77)
py = 0 , (3.78)
 = 0 . (3.79)
There is however a dependence on the canonical momenta, pi. Performing the necessary
differentiation to the Hamiltonian results in:
Chapter 3. Physics Theory 32
 p2x  p2y 
, (3.80)
 p2x  p2y 
, (3.81)
+ (
 p2x  p2y 
. (3.82)
A Taylor expansion can be applied to the expressions in eqs. (3.80) to (3.82) as long
as the canonical momenta is small [32]. Applying the Taylor expansion means that the
expressions can then be represented by a matrix, R. The phase space coordinates, ~xs1 , at
the end of the transfer map, with length L, can be determined by the initial coordinates,
~xs0 :
~xs1 = R  ~xs0 , (3.83)
where ~x is the column vector of coordinates (x, px, y, py, z, ).
The transfer maps given below can also be found in [10]. The transfer map, R, of the
drift (after performing a Taylor expansion) is:
Rdrift =

1 L 0 0 0 0
0 1 0 0 0 0
0 0 1 L 0 0
0 0 0 1 0 0
0 0 0 0 1 L
0 0 0 0 0 1

. (3.84)
Equation (3.85) represents the transfer matrix for a dipole:
Rdipole =

cosL sinL
0 0 0 1cosL
 sinL cosL 0 0 0 sinL
0 0 1 L 0 0
0 0 0 1 0 0
 sinL
1cosL
0 0 1 L
 LsinL
0 0 0 0 0 1

, (3.85)
where,
33 Chapter 3. Physics Theory
hk0 , (3.86)
and h is the curvature, h = 1/, and k0 is the normalised dipole field strength.
Looking at the first row of eq. (3.87) the change in horizontal position is bounded and will
decrease by a factor of cosL. Although when considering row three it is evident that
the vertical position is unbounded and will increase by a factor of coshL. Therefore
the transfer matrix represented in eq. (3.87) is of a horizontally focusing quadrupole.
Figure 3.3 shows how a quadrupole is focusing in one dimension and then diverging in
the other:
Rquadrupole =

cosL sinL
0 0 0 0
 sinL cosL 0 0 0 0
0 0 cosL sinhL
0 0  sinhL coshL 0 0
0 0 0 0 1 L
0 0 0 0 0 1

. (3.87)
The skew quadrupole transfer matrix is represented by:
Rskew quadrupole =

2 (C+)
2 (S+)
2 (C)
2 (S) 0 0
2 (S)
2 (C+) 
2 (S+)
2 (C) 0 0
2 (C)
2 (S)
2 (C+)
2 (S+) 0 0
2 (S+)
2 (C) 
2 (S)
2 (C+) 0 0
0 0 0 0 1 L
0 0 0 0 0 1

, (3.88)
where
k1s , (3.89)
C = cosL coshL , (3.90)
S = sinL sinhL . (3.91)
Chapter 3. Physics Theory 34
As can be seen in eq. (3.88), the horizontal phase space is affected by both the ini-
tial horizontal phase space coordinates but also the vertical phase space coordinates.
This is known as coupling, which means that the horizontal and vertical motion are
interdependent.
In the theory of chromaticity section (section 3.2.9), equations of motion in the horizontal
phase space of a quadrupole with chromaticity is taken into account is given.
3.2.6 Symplecticity
Hamiltonian systems are symplectic. That is to say that a transfer map, S, between any
two points are symplectic if [32]:
JTSJ = S , (3.92)
where J is the Jacobian matrix. The physical importance of a symplectic transformation
is that phase space area is conserved under the transformation.
3.2.7 The FODO lattice
A FODO lattice is a periodic lattice which produces strong focusing of the beam. This
section will show how the FODO exhibits strong focusing, which is the focusing of the
beam in both transverse planes. Many accelerators require a beam to be constrained,
and therefore make use of the FODO lattice. First the details of the FODO lattice will
be introduced, and then the dynamics of the lattice will be discussed.
The FODO lattice is so called due to its construction and elements. The unit cell consists
of a focusing (F) quadrupole, a defocusing (D) quadrupole, and two drifts (O) that
separate the quadrupoles.
The linear matrices for quadrupoles and drifts have already been shown in eq. (3.87) and
eq. (3.84). It is common to analyse the FODO in the thin-lens approximation due to the
simplification it offers whilst maintaining the dynamical properties of the FODO [3]. As
part of the thin-lens approximation, the finite length of the quadrupoles is taken in the
limit to zero:
L 0 . (3.93)
In addition, the product of the length of the quadrupole and the gradient of the quadrupole
has a finite limit:
35 Chapter 3. Physics Theory
, (3.94)
where k is the normalised gradient, and L is the drift length.
These limits result in the following transfer matrix for the focusing (F) quadrupole:

1 0 0 0 0 0
1/f 1 0 0 0 0
0 0 1 0 0 0
0 0 1/f 1 0 0
0 0 0 0 1 0
0 0 0 0 0 1

. (3.95)
The defocusing (D) thin lens quadrupole is defined similarly in the limit to eq. (3.95),
but the focal length f is negated, e.g. f = fF.
The transfer matrix for the FODO can then be computed by composition of the transfer
matrices of the individual elements. There is a choice of unit cell, which commonly is
defined from the middle of the focusing quadrupole or from the edge entering the focusing
quadrupole. Using the transfer matrix for the drift from eq. (3.84), which will be referred
to here as RO, will give the following transfer matrix for unit cell with a boundary at
the start of the focusing quadrupole,
RFODO = RORDRORF . (3.96)
For the unit cell with a boundary in the middle of the focusing quadrupole a transfer
function representing traversal through half the quadrupole can be represented by RF/2,
with focal length f = fF/2. The transfer matrix of this FODO is represented by:
RFODO = RF/2RORDRORF/2 . (3.97)
As there is no coupling in the transfer matrices, the matrix composition can be evaluated
in the horizontal, vertical, and longitudinal dynamics separately.
In the case for the FODO beginning at the entrance of the focusing quadrupole [10, Eq
4.10 - 4.12]:
Rhorizontal =
1 Lf  L2f2 2L+ L2f
1 + L
 . (3.98)
Chapter 3. Physics Theory 36
Rvertical =
1 + Lf  L2f2 2L L2f
 . (3.99)
Rlongitundinal =
1 2L0202
 . (3.100)
Whereas in the case for the FODO with the unit cell starting halfway through the
focusing quadrupole [32, Lecture 6, eq 7]:
Rhorizontal =
 1 L22f02 Lf0 (L+ 2f0)
(L 2f0) 1 L
 . (3.101)
Rvertical =
 1 L22f02  Lf0 (L 2f0)
 L4f03 (L+ 2f0) 1
 . (3.102)
As can be seen in eqs. (3.98) and (3.99) the transfer matrix is focusing in both horizontal
and vertical planes. This focusing in both planes is also known as strong focusing.
If a particle is given a horizontal deviation from the closed orbit (which for the FODO is
the magnet longitudinal axis) and then simulated traversing the FODO multiple times
whilst recording the variables of the particle at each complete traversal of the FODO
unit cell, then it would result in fig. 3.8.
The particle when tracked through complete iterations of the unit cell, traces out an
ellipse in phase space. An ellipse would be impossible if there was energy lost to friction,
instead a spiral would be produced in that case. This shows that in the model of the
FODO developed here is frictionless. Furthermore this is another confirmation that the
matrices described to track through a FODO lattice are symplectic.
3.2.8 Courant-Snyder parameters
The derivation of the Courant-Snyder parameters shown below is based on [10] and [32].
When the transfer matrices are solutions to Hamiltons equations, then they are symplectic.
A combination of symplectic matrices are also symplectic. The symplecticity condition
(eq. (3.92)) has a general solution; the portion of an uncoupled symplectic matrix for
horizontal motion, R2, can be described as:
R2 = I2 cosx + S2 Ax sinx , (3.103)
37 Chapter 3. Physics Theory
-2 -1.5 -1 -0.5 0 0.5 1 1.5 2
x [m] 10 -3
Figure 3.8: The phase space results of tracking a particle, with a horizontal deviation
from the closed orbit, through a FODO cell. The coordinates at each pass through the
FODO cell are plotted.
where I2 is the 2 x 2 identity matrix,  is a parameter, and Ax is a 2 x 2 symmetric
matrix. S2 is the antisymmetric matrix:
. (3.104)
As Ax is 2 x 2 symmetric matrix, it is therefore defined in terms of three unique parameters.
These parameters are given in eq. (3.105):
x x
x x
, (3.105)
where x, x, and x are known as the Courant-Snyder parameters (or also the Twiss
parameters). The subscript denotes that they are properties associated with horizontal
phase space, and a similar set can be derived for vertical phase space.
From eqs. (3.103) and (3.105) it is possible to write Rx as:
Chapter 3. Physics Theory 38
cosx + x sinx x sinx
x sinx cosx  x sinx
. (3.106)
The Courant-Snyder parameters and the phase advance can be determined by the four
parameters of the transfer matrix Rx [10, page 134]. From eq. (3.106) the parameter x
(the phase advance) can be obtained from the trace of the Rx matrix.
TrRx = 2 cosx . (3.107)
Firstly it is important to observe that the transfer map RF of the FODO is dependent
on the starting position within the FODO, eqs. (3.98) and (3.101). Therefore the choice
of starting position will also influence the Courant-Snyder parameters.
It has been established already that the FODO matrix is symplectic. The symplectic
condition, eq. (3.92), results in:
RT2  S2 R2 = S2 . (3.108)
Equation (3.108) is only valid when:
xx  2x = 1 . (3.109)
If the transfer matrix is considered from a different starting point within the FODO,
such as after the focusing quadrupole, this point will be called s1 to distinguish it from
conventional starting point s0, this would result in the following expression:
R (s1) = RFRORDRO = RFR (s0)R1F . (3.110)
For now it is assumed that the parameter x is constant with respect to the starting
position chosen. Whether this is a reasonable assumption will become evident later. If
x is constant then the change in Rx is determined by S2 and Ax, therefore:
S2Ax (s1) = RFxS2Ax (s0)R1Fx , (3.111)
The result is:
Ax (s1) = S12 RFxS2Ax (s0)R
Fx , (3.112)
39 Chapter 3. Physics Theory
where RFx is the horizontally focusing part of the transfer matrix of a FODO focusing
quadrupole RF. It should be noted that RFx is also symplectic given that the focusing
quadrupole is symplectic and its transfer matrix is block diagonal [32]. Therefore using
eq. (3.108):
S12 R
FxS2 = R
Fx . (3.113)
Using the rules for transposing matrices, ATBT = (BA)T, as well as the result that S2
is a skew-symmetric matrix and therefore also an orthogonal matrix and so ST2 = S
then:
S12 RFxS2 =
. (3.114)
Using this result in eq. (3.112) gives:
Ax (s1) =
Ax (s0)R1Fx . (3.115)
The Courant-Snyder parameters at different points in a lattice can be calculated if there
are respective transfer matrices to those different points. This is due to the following
result:
Ax (s1)1 = Rx (s1, s0)Ax (s0)1Rx (s1, s0)T , (3.116)
where Ax (s1)1 and Ax (s0)1 are the inverse Ax matrices at points s0 and s1. Rx (s1, s0)
is a transfer matrix describing the motion from s0 to s1. Like Ax, A1x is also given in
terms of the Courant-Snyder parameters - therefore if the Courant-Snyder parameters
are known at some starting position s0, and transfer matrices to some other point s1 are
known then it is possible to calculate the Courant-Snyder parameters at that point.
Using eq. (3.115), an invariant to application of transfer matrix, R, can be constructed:
. (3.117)
Ax changes as shown in eq. (3.115), and the phase space coordinates evolve like:
. (3.118)
Chapter 3. Physics Theory 40
Wolski shows that eq. (3.117) results in the following:
2 + 2xxpx + xp2x
. (3.119)
The invariant is known as the action of a particle, J , and is defined by the Courant-
Snyder parameters. It is invariant under transport along the beam line. The Courant-
Snyder parameters are determined by a periodic cell of a beamline, and therefore are
representative of the beamline rather than of a single particle [32]. The phase space
coordinates in eq. (3.119) can be the phase space coordinates of a particle within the
lattice. The action can then be calculated for that particle. Plotting eq. (3.119) gives
fig. 3.9.
2xJx
2xJx
px = xx
x = x
Figure 3.9: A horizontal phase space ellipse for a given action Jx, and its features in
relation to Courant-Snyder parameters x, x, and x.
Figure 3.9 shows the dimensions of a phase space ellipse for a given action. The area
of the ellipse is 2Jx. Notice that the tracking through the FODO also resulted in an
ellipse fig. 3.8. It is now clear why this should be the case for the FODO. Every traversal
of the FODO represents a new set of phase space coordinates, and due to them sharing
the same action, they must lie on points traced by the ellipse.
To describe a set of phase space coordinates of a given action, it can be determined by
 the angle made between the position on the ellipse and the positive horizontal axis.
41 Chapter 3. Physics Theory
This angle is in fact defined in terms of Courant-Snyder parameters and phase space
coordinates:
tanx = x
 x . (3.120)
Equations (3.119) and (3.120) provide the following expression for the horizontal phase
coordinates.
2xJx cosx , (3.121)
px =
(sinx + x cosx) . (3.122)
From eq. (3.121) it can be seen that the position depends on both the action and angle,
but crucially also the  function. This is significant because the action is constant so
 determines the extent of amplitude of a particle with a given action. Additionally
it is important to note that the position is also dependent on the angle, but crucially
the possible amplitude is set by the  function and as the Courant-Snyder parameters
describe the lattice, this means that the amplitude of the particle is periodic with the
lattice [32]. The angle increases around the lattice as dx
The Courant-Snyder parameters for a FODO cell are given in [10, eqs. 4.68 - 4.70]. These
can be plotted in fig. 3.10.
0 0.5 1 1.5 2
s [m]
Figure 3.10: The beta function calculated when tracking through a FODO cell, with
drift length, L = 1 m and focusing strength f =
The  functions in a FODO (fig. 3.10) alternate between: reaching their smallest extent
at the defocusing magnet, and reaching their largest extent at the focusing magnet.
Chapter 3. Physics Theory 42
Despite the fact that quadrupole focus and defocus in different planes, the FODO is able
to keep both planes bounded.
A particles action is invariant (eq. (3.119)); therefore at points in the lattice with smaller
beam sizes (small ), the particle must have a larger transverse momentum. This concept
is important to consider when thinking about the small  values that are required within
the HL-LHC to achieve the luminosities at the collision points.
3.2.9 Chromaticity
Chromaticity is the change of tune with respect to the energy of a particle. It is due to
differences in focusing strength with respect to the energy of a particle. A transfer matrix
for a quadrupole has already been discussed in section 3.2.5, but there the treatment
was made using a paraxial approximation of the Hamiltonian. This resulted in the loss
of terms higher than second order, such as the chromatic effect, which is an important
nonlinear effect.
Wolski gives the equations of the transverse phase space coordinates after transport in a
quadrupole, taking into account chromaticity [10]. This is achieved by considering the
transverse phase space separately from the longitudinal phase space. The equations are
as follows:
x(L) = cos(L)x(0) +
sin(L)
px(0) , (3.123)
px(L) = D sin(L)x(0) + cos(L)px(0) , (3.124)
y(L) = cosh(L)y(0) +
sinh(L)
py(0) , (3.125)
py(L) =D sinh(L)x(0) + cosh(L)py(0) , (3.126)
where
+ 2 , (3.127)
. (3.128)
43 Chapter 3. Physics Theory
Chromaticity of a FODO
The treatment of the FODO lattice can also be extended to consider chromaticity. This
is useful because the FODO lattice is used across lattice designs due to its property
of strong focusing. The horizontal chromaticity, x of a FODO depends on the phase
advance over the lattice x:
x = 
. (3.129)
Chromaticity in a storage ring
Quadrupoles and dipoles introduce negative chromaticity to a storage ring. Wolski
states that for storage rings with high currents it can be necessary for beam stability
to maintain a zero or even slightly positive chromaticity [10]. Therefore to keep the
chromaticity as close to zero as possible, it is sometimes desirable to reduce beta functions
and quadrupole strengths as required. This option is not compatible with the design
requirements of colliders, such as the HL-LHC, which require high strength quadrupoles
placed at areas of the ring with large beta functions.
On the other hand, sextupoles can be used to correct the chromaticity without having a
large impact on the linear dynamics, such as the closed orbit, the beta functions, and
dispersion [10]. The Hamiltonian for a sextupole is defined below:
+  
 (px  ax)2  (py  ay)2 
x3  3xy2
(3.130)
where
0, 0,
x3  3xy2
, (3.131)
a, is the vector potential of the sextupole with the magnetic axis along x = y = 0.
Sextupoles are used to add positive contributions to the chromaticity. But sextupoles are
also constrained to have inverse effects on the horizontal and vertical chromaticities. For
example, a sextupole that increases the horizontal chromaticity must also decrease the
vertical chromaticity. It is possible overall to add positive chromaticity in both planes
by placing sextupoles in locations where their positive contribution in one dimension
outweighs the negative contribution in the other. For example, sextupoles with positive
strength at locations where x > y can be combined with sextupoles with negatives
Chapter 3. Physics Theory 44
strengths at locations where y > x (assuming there is also positive horizontal dispersion,
Chromaticity is tuned to zero or close to zero so that the range of tunes of particles in a
bunch is minimised. There is also a term known as the head tail instability which means
that a positive chromaticity is needed for beam stability in a storage ring running above
transition [10].
Sextupoles have nonlinear effects on the beam which can be undesirable for beam stability.
For example, sextupoles have geometric effects and chromatic effects. This means that
they affect the particles with zero and non-zero energy deviations respectively. Wolski
notes that the geometric effects can be effectively cancelled by pairing sextupoles that are
separated by a distance corresponding with a I transformation. When the sextupoles
are separated in this way it results in a better dynamic aperture [10].
3.2.10 Tracking with many particles
In the Courant-Snyder parameter section only single particles were considered. Acceler-
ators usually contain many particles, such at the HL-LHC which is designed to have up
to 2.2 1011 particles per bunch.
How might it be possible to describe the dynamics of such a large amount of particles in
a bunch? It is easier to consider the averages of phase space coordinates. For example
x is the average horizontal position for all the particles in the bunch. These averages
when performed on the six dynamical variables (x, px, y, py, z, ) are known as first order
moments of the bunch distribution. The collection of first order moments are known as
the bunch centroid. The tracking of many particles is considered below as described by
Wolski [32] [10].
As stated in the Courant-Snyder section (section 3.2.8) they are a property of the
beamline and not the beam. Restating another concept established in that section, the
Courant-Snyder parameters can be found at the point representing the beginning of
a periodic transfer matrix. Not all beamlines are periodic and so it follows that this
technique does not apply for all beamlines. It is possible to choose the parameters
arbitrarily but the  and  functions will not exhibit the same periodicity as the lattice
unless the previous technique is used.
There is a technique to generate the Courant-Snyder parameters from the beam itself.
Specifically the many particle distributions in position and momentum-space can used to
determine the parameters.
For example the first order moment of the x2 parameter, using eq. (3.121), is:
45 Chapter 3. Physics Theory
x2 = 2xJx cos2 x . (3.132)
If it can be assumed that the angle variables of the particles are equally distributed, then
eq. (3.132) can be simplified to:
x2 = xJx . (3.133)
This leads to the definition of a useful property of the bunch, the horizontal emittance x:
x = Jx . (3.134)
It then follows that eq. (3.133) becomes:
x2 = xx . (3.135)
Using eqs. (3.121) and (3.122) similar results can be found for other averages to second
order:
xpx = xx , (3.136)
p2x = xx . (3.137)
Each of these averages to second order are in terms of the Courant-Snyder parameters.
Using these results in combination with eq. (3.109) it follows that:
x2p2x  xpx2 . (3.138)
Equation (3.138) is an important result because it means that if the beam distribution is
well known at some point in the lattice, then the emittance can be computed. Other
Courant-Snyder parameters can be calculated if the emittance is known. The Courant-
Snyder parameters can then be calculated at different points around the beamline by
applying symplectic transfer matrices to those points (as seen in section 3.2.8). As the
transfer matrices are symplectic, then the action will be an invariant and therefore so
will the emittance. Therefore the Courant-Snyder parameters describe the properties
of the beam. It is only if the Courant-Snyder parameters are chosen to be equal to the
values derived from a periodic cell of the lattice, that the Courant-Snyder parameters
will exhibit the same periodicity as the lattice. This result is known as beam matching.
Chapter 3. Physics Theory 46
If the Courant-Snyder parameters are different from the values from a periodic cell, then
this results in a beam oscillating with a different periodicity to that of the beamline.
Such behaviour is known as beta-beating [10].
The second order moments describe the size of the bunch.
ij = (xi  xi) (xj  xj) = xixj  xixj (3.139)
Swapping the i and j parameters in ij will result in the same result. Therefore ij can
be represented as a symmetric matrix, . The components lying along the diagonal of
the matrix, i.e. i = j, are the variances of the dynamical variables for all particles in a
bunch:
11 = x2  x2 = 2x (3.140)
When working with a single particle approach for the Courant-Snyder variables, it was
seen that an invariant, the action J , could be constructed to simplify the description of
the amplitude of the oscillation of the particles. Furthermore, because the action was
invariant under symplectic transport, it led to assumptions to do with phase space area.
A similar approach can be taken when it comes to the second order moments. It turns
out this invariant description gives the eigenvalues of S. This can be shown by putting
the invariant description through symplectic transport R(s0, s1) between s0 and s1:
S 7 RRTS = RSR1 . (3.141)
For eq. (3.141) the result of the second order moments under symplectic transport, R, is
needed:
(xixj  xixj)s1 =
i,j=1
RiiRjj
xixj  xixj
, (3.142)
which when written in matrix form is:
(s1) = R(s0)RT . (3.143)
Looking back to eq. (3.141), S maps to RSR1. Why is this result important? Wolski
makes the observation that "for any matrices M and N , the eigenvalues of NMN1 are
the same as the eigenvalues of M" [32, Lecture 8 p. 10]. Thus it is clear that from this
result it must be that the eigenvalues of S are invariant under symplectic transport.
47 Chapter 3. Physics Theory
The horizontal emittance represented by the eigenvalues of horizontal portion of the
uncoupled S are conserved. The vertical and longitudinal emittances are similarly
conserved. These emittances k and eigenvalues are related as follows:
 = ik , (3.144)
where k  x, y,  to represent the horizontal, vertical, and longitudinal degrees of freedom
respectively.
3.2.11 Coupled optics
A bunch distribution is uncoupled if it has no non-zero second order moments mixing
variables from different degrees of freedom. An uncoupled bunch distribution will remain
uncoupled under uncoupled transport. However Wolski states that the effect of coupling
in a beamline will introduce coupling into a previously uncoupled bunch distribution [32,
Lecture 8 pg. 8]. A coupled bunch distribution will have non-zero off-diagonal elements
in the  describing its second order moments.
Coupled optics are relevant to this work because SAMM uses coupled optics formalisms3
to calculate the Courant-Snyder parameters of a lattice. To do this, a transfer matrix
for one periodic cell is needed. This can be generated by applying each transfer matrix
of a HL-LHC component in turn to the identity matrix multiplied by a small value to
keep the transport mostly dominated by linear effects. If the closed orbit does not lie
along the coordinate axis, then the identity matrix in fact has the starting closed orbit
variables added to each column. The matched distribution can be found as described in
Wolski [32]. If both the transfer matrix and the matched distribution are known, then
the eigenvalues and eigenvectors of the transfer matrix can be found. The eigenvalues,
exp(ik), are the phase advances across a single periodic cell in each degree of freedom
k. From Wolski, "The eigenvectors may be used to construct coupled lattice functions Bk
for coupled optics, which relate the sigma matrix directly to the bunch emittances" [32,
Lecture 9 pg. 36]. In SAMM, the Courant-Snyder variables are taken from the coupled
lattice functions Bk.
3.2.12 Tune shift with amplitude and frequency map analysis
Tune shift with amplitude is an example of a technique that can be used to analyse the
behaviour of particles in a complicated beamline environment. It is so named because it
is the change in tune for particles with some amplitude away from the closed orbit.
3Using the ComputeMatchedTwiss function.
Chapter 3. Physics Theory 48
Tune shift with amplitude is a nonlinear effect, which can be produced by sextupoles
and higher order multipole magnets. Dipoles and quadrupoles can have field errors that
would result in higher order fields; therefore these magnets can also contribute to the
tune shift with amplitude [10].
Tune shift with amplitude can be explained by starting with an simple model. Beginning
with the Hamiltonian represented in terms of action as:
H = aJ + bJ2 , (3.145)
where a and b are constants. The equations of motion in terms of action and angle give
the following result [10, eq. 11.28]:
= a+ 2bJ . (3.146)
Such a result shows that the phase advance would increase depending on the b factor.
As the tune is the phase advance over one complete turn, it shows how the tune can be
dependent on the action of a particle, J .
If the Hamiltonian was dependent on higher order terms in action, e.g. J3, J4, etc, then
the tune shift with amplitude will have a more complicated relationship to the action.
Betatron tune shift with amplitude can be approximated using perturbation theory or
normal form analysis. Both techniques aim to transform the Hamiltonian into a simpler
form so that it is possible to estimate the tune shift with amplitude from the simplified
Hamiltonian.
An example of how perturbation theory is used to calculate the tune shift with amplitude
due to a sextupole is given by Wolski[10, eq. 11.174].
Extending eq. (3.146) to the x-y plane gives:
H = axJx + ayJy + bxxJ2x + bxyJxJy + byyJy
2 , (3.147)
where ax,y and bx,y are constants.
= ax + 2bxxJx + bxyJy , (3.148)
= ay + 2byyJy + bxyJx . (3.149)
49 Chapter 3. Physics Theory
Frequency map analysis is based on a two dimensional tune shift with amplitude. When
the particles with different amplitudes are plotted in tune space, the particles are observed
to be spread across the tune grid according to their tune shift. One corner of the plot
in tune space is represented by particles close to the closed orbit, and the rest of the
particles are spread out. The shape and size of the particles spread over tune space is
dependent on the tune shift with amplitude and therefore the constants in eq. (3.146).
A Hamiltonian that depends on action as well as angle will have terms that drive
resonances. Resonances can have different effects, some of which can be complicated.
For example, particles close to a resonance can experience chaotic or unstable motion,
which can lead to the loss of the particle in the accelerator. These effects can be studied
using perturbation theory or normal form analysis.
The nominal working point of the accelerator, the tune of particles on the closed orbit,
might be chosen so that it does not cross the stronger resonances due to their potentially
detrimental effects. But tune shift with amplitude can mean that some particles will
have their tunes close to a resonance. A resonance can then have the effect of drawing
the particle onto the resonance (by changing the tune of the particle). This can be seen
in frequency map analysis plots with particles lying on or close to resonance lines.
As stated before, octupoles can also affect the tune shift with amplitude. In particular
they can be used to make sure that certain problematic resonances are avoided by
modifying the tune shift with amplitude accordingly.
But using this method is not trivial. Optimising the dynamic aperture by changing the
tune shift of octupoles and other components is an iterative process, which can take time.
This is because the components can drive resonances themselves.
3.2.13 Dynamic aperture
Particles beyond a limit, known as the dynamic aperture, are usually lost - which is to
say that they are no longer bound. The dynamic aperture is related to the nonlinear
properties of a lattice. This is because the amplitudes reached when modelling linear
motion are usually smaller than nonlinear motion.
The dynamic aperture calculation is carried using long term turn-by-turn tracking.
Therefore it is important to use symplectic maps to do this tracking.
3.3 Numeric integration methods
In this section the theory behind the two integration methods, Wu-Forest-Robin and
Implicit Runge-Kutta methods, used for the study will be discussed.
Chapter 3. Physics Theory 50
A key property of an integration method, that is important in long-term tracking
studies in particular, is whether the transfer maps produced are symplectic. As seen in
section 3.2.8, the action is invariant under symplectic transport. This is not the case for
a non symplectic map. Therefore a non symplectic map can see the growth or damping
of betatron oscillations due to the growth or damping of the action variable.
For the Wu-Forest-Robin integration, one powerful technique involves the use of Lie
transformations. They are useful for algebraic manipulation and analysis, but they do
not allow for convenient evaluation. A more convenient way to evaluate is to use a
transfer map expressed as a power series; this evaluation is also computationally fast
to calculate. The power series formulation is explicit, which means that the map does
not require an an iterative solution to be performed based on the dynamical variables
of the particle. Although the representation of a real accelerator component requires
an infinite number of terms. Therefore the map must be truncated at some point and
the resulting truncated power series will not be symplectic. Another property that will
be seen of Wu-Forest-Robin integration is that it requires the paraxial approximation
(|px|, |py|  1).
The Runge-Kutta methods as an integration scheme can be either implicit or explicit.
Explicit Runge-Kutta schemes are not symplectic [10, p. 327]. There is a simple scheme
known as the implicit midpoint method which is symplectic. Being implicit requires
algebraic manipulation at each integration step and is therefore computationally slow.
The Runge-Kutta does not require the paraxial approximation and therefore might be
a useful scheme for modelling particles that have high transverse momentums. The
HL-LHC inner triplet focusing quadrupole sections are an interesting benchmark to test
this assumption.
3.3.1 Wu-Forest-Robin
An integration technique devised by Wu, Forest, and Robin [33] allows for symplectic
integration of s-dependent fields. This description of the Wu-Forest-Robin in this chapter
is based on the following citations: [10] [34] [33]. The integration is explicit, meaning
that the map can be applied to dynamical variables without first manipulating them.
It was seen in section 3.2.3 that it is possible to construct a Hamiltonian for straight line
elements:
+  
 (px  ax)2  (py  ay)2 
 az . (3.71 revisited)
If the Hamiltonian in eq. (3.71) is independent between 0 and s, then a transfer map can
be expressed in terms of Lie transformations:
51 Chapter 3. Physics Theory
f(s) = es:H:f(0) , (3.150)
where : H : is the Lie operator applied to the Hamiltonian. The Lie operator : g : for an
arbitrary function g(xi, pi), depending on phase space coordinates xi, pi with degrees of
freedom i = 1   n, is given by:
: g :=
. (3.151)
Unfortunately, if the Hamiltonian is dependent on s because for example as is calculated
from an s-dependent field like a fringe field (for more information see section 3.1.7), then
the eq. (3.150) is no longer applicable.
There is a way to describe the map using Lie transformations for maps that have s-
dependent Hamiltonians between their initial and final values. To do this the phase
space is extended, by introducing an independent variable  and transforming s into a
new dynamical variable. With the new independent variable is an associated canonical
momentum ps. The extended Hamiltonian becomes:
+  
 (px  ax)2  (py  ay)2 
 as + ps . (3.152)
As  is independent when the Hamiltonian is integrated between s = 0 and s = L, then
the transfer map can be written in terms of Lie transformations in terms of :
f() = e:H:f(0) . (3.153)
The extended Hamiltonian, in eq. (3.152) can be split into integrable terms [34]. With an
appropriate gauge transform the horizontal vector potential ax becomes 0. The paraxial
approximation is also taken, to restate |px|, |py|  1. Therefore the splitting of the
Hamiltonian becomes:
H  H1 +H2 +H3 . (3.154)
With H1:
H1 = 
22020
) + ps , (3.155)
Chapter 3. Physics Theory 52
and H3:
H3 = as , (3.156)
and H2:
(py  ay)2
, (3.157)
and where D is:
+ 2 . (3.158)
H1 and H3 are integrable, but as H2 depends on both coordinates and momentum, a
different technique is required. Wolski shows how H2 can be represented as the generator
of a Lie transformation, and that it can then be further composed into Lie transformations
with integrable generators [10, p. 322].
Here is the Lie transformation which can be later composed of other transforms:
e:H2: = e:Iy : exp
e:Iy : , (3.159)
which is only valid as long as:
e:Iy :py = py  ay . (3.160)
Iy above is given by:
Iy = 
ay(x, y, s)dy . (3.161)
Wolski shows that e:H2: can be used to now decompose e:H: into the following
integrable Lie transformations:
e:H:  e:H1+H2+H3: ,
2 :H1+H3:e:H2:e
2 :H1+H3: ,
4 :H1:e
2 :H3:e
4 :H1:e:H2:e
4 :H1:e
2 :H3:e
4 :H1: .
(3.162)
53 Chapter 3. Physics Theory
Equation (3.162) shows that the Lie transformation can be decomposed into smaller
integrable Lie transformations. Wolski shows formulae for the smaller Lie transformations
applied to the dynamical variables, and skips the results that are effectively identity
transformations [10, p. 323]. This important result provides an explicit symplectic
integrator for s-dependent fields, where the integration is over a step from 0 to 0 + .
It can be seen that in the Lie transformation:
4 :H1:s = s+
, (3.163)
which represents a change in the variable s during the integration. This is possible due to
the extension of the phase space and treating (s, ps) as dynamical variables. The physical
significance of this is that the vector potential ay(x, y, s) in eq. (3.161) is effectively
sampled at different points of the integration step due to the change in s. Had the phase
space not been extended then s would be fixed at the initial value of the integration.
3.3.2 Implicit Runge-Kutta
The Wu-Forest-Robin integrator discussed in section 3.3.1 required the paraxial approx-
imation to integrate the split Hamiltonian terms of eq. (3.154).
The Runge-Kutta methods do not require the paraxial approximation. As spoken about
already in the HL-LHC section (see section 3.1.3) the regions around the interaction
regions with the smallest  must reach some large  inside the focusing inner triplet
quadrupoles. These inner triplet quadrupoles must also have high strength fields to
produce the required focusing to achieve the design . A high strength focusing will
result in greater transverse momenta. Therefore the paraxial approximation may not be
a good approximation in these focusing regions. Therefore it is suitable to investigate
the Runge-Kutta as an option for the fringe fields of the inner triplet.
The discussion of Runge-Kutta methods given below are drawn from [10]. The Runge-
Kutta methods are symplectic under certain conditions. Unfortunately these same
conditions mean that the Runge-Kutta methods are therefore implicit, meaning that an
algebraic solution must be found at each step of integration. The additional algebraic
solution needed at each step increases the computational cost of the integration. Therefore,
one downside of a symplectic Runge-Kutta is that the integration scheme is more difficult
to calculate and slower to calculate than the Wu-Forest-Robin.
Next the theory behind the Runge-Kutta will be detailed. Let the solution to the ordinary
differential equation be:
= f(x, s) , (3.164)
Chapter 3. Physics Theory 54
where x(s) with an initial condition of x(s0) = x0, and f is an arbitrary function.
Runge-Kutta methods make it possible to integrate the ordinary differential equation in
eq. (3.164):
x(sn + s) = x(sn) +
bii . (3.165)
bi represent constant coefficients, the choice of which is specific to a choice of Runge-Kutta
scheme. i is calculated using:
i = sf(x(i)n , s
n ) , (3.166)
where x(i)n and s
n are intermediate values. These intermediate values are themselves
calculated using:
x(i)n =xn +
aijij , (3.167)
s(i)n =sn + cis . (3.168)
aij and ci also represent constant coefficients, and like bi are specific to the choice of
Runge-Kutta scheme. Together aij , bi, and ci can be displayed in what is known as a
Butcher tableau:
c1 a11 a12    a1m
c2 a21 a22    a2m
. . .
cm am1 am2    amm
b1 b2    bm
. (3.169)
It is also required that:
aij . (3.170)
The implicit midpoint rule is a scheme with the following Butcher tableau:
. (3.171)
55 Chapter 3. Physics Theory
This scheme is symplectic because it agrees with the following constraint:
biaij + bjaji = bibj . (3.172)
The next step is to apply the implicit midpoint rule to the Hamiltonian system, which is
more relevant to the requirements of this study. If x is chosen to be the vector of the
dynamical variables of the Hamiltonian system ~x = (x, px, y, py, z, ), then the ordinary
differential equation in eq. (3.164) has to be generalised to include the other coordinates.
This can be done by using derivatives of the Hamiltonian:
= S~xH(~x, s) , (3.173)
where S is the antisymmetric matrix, and:
~x =
, (3.174)
is the differential operator. For this choice of f , then eq. (3.166) becomes:
i = sS~xH(~x(i)n , s
n ) . (3.175)
The integration step of eq. (3.165) becomes:
x(sn + s) =x(sn) + s
x=x(1)n ,px=p
, (3.176)
px(sn + s) =px(sn) + s
x=x(1)n ,px=p
. (3.177)
The intermediate values of eqs. (3.167) and (3.168) becomes:
x(1)n =x(sn) +
x=x(1)n ,px=p
, (3.178)
p(1)xn =px(sn) +
x=x(1)n ,px=p
. (3.179)
Wolski shows that for the case of a Hamiltonian representing a relativistic particle within
a sextupole field, exact solutions of the integral steps (eqs. (3.176) and (3.177)) can be
written in terms of x(sn) and px(sn).
Chapter 3. Physics Theory 56
There are a family of implicit Runge-Kutta integrators known as Gauss methods or
Gauss-Legendre methods of which the implicit midpoint rule (eq. (3.171)) is just one.
In this study the implicit midpoint integrator is used as the Runge-Kutta integrator
of choice. Whilst it is less performant than the Wu-Forest-Robin integrator due to
its increased computational cost, it provides an interesting comparison as unlike the
Wu-Forest-Robin it does not require the paraxial approximation. It is also a symplectic
integrator, which the truncated Wu-Forest-Robin is not.
Chapter 4
Method
In this chapter, the techniques employed to produce the results (chapter 5) are discussed.
Two magnetic field models are used to describe the inner triplet quadrupole fringe field.
These are the numeric field and Enge field. These fields are processed so that they can be
described using generalised gradients. The generalised gradients are also used to produce
transfer maps via integrators that use the vector potential as a parameter. The transfer
maps can then be used to perform particle tracking studies. Particle tracking was used
in several studies to find: the transfer functions of the transfer maps, the chromaticity
exhibited by the HL-LHC lattice, and the tune shift with amplitude exhibited the HL-
LHC lattice. Finally, frequency map analysis was used to analyse the stability of the
HL-LHC beam.
In the first part of this chapter, the techniques concerning the magnetic field data are
described. This includes the initial simulation of the HL-LHC inner triplet magnetic field
and its construction into a full 3-dimensional field. There are two magnetic field models
of the inner triplet that are discussed: the numeric field and the Enge field. The numeric
field refers to descriptions that derive from the magnetic field generated from simulation
by S. Bermudez [35]}. The Enge field refers to the analytic description described by
Muratori et al. [5].
The generation of generalised gradients for both numeric and Enge fields is then described.
The generalised gradients construction requires a description of the magnetic field data
lying on a cylindrical surface, which is achieved via cubic spline interpolation. Afterwards,
how the generalised gradients are generated from this cylindrical magnetic field is outlined.
In the second part of the chapter the key steps which are necessary to construct the
HL-LHC lattice model used in the results are described. The first step was to generate a
lattice description for use in SAMM from a pre-existing MAD lattice file. The next step
was to modify the lattice description in the relevant points to allow the addition of a
fringe field. The addition of a fringe field can modify the linear dynamics of the lattice,
and so the method to restore the chromaticity to a desired value is also described.
Chapter 4. Method 58
In the final part of the chapter, the techniques which are used to investigate the effect of
the fringe field in the HL-LHC are described in detail. The results of these techniques
will later form the basis of the results chapter (chapter 5).
4.1 Magnetic field descriptions of the inner triplet
4.1.1 Simulating the numeric field
The inner triplet magnets have been modelled and the resultant magnetic field data
that would be generated by the magnetic geometry was simulated by S. Bermudez [35].
The field data itself has been simulated in two partitions along the longitudinal axis;
for z  [300, 700] mm and z  [700, 1100] mm, in steps of 5 mm. There is a regular grid
in the transverse plane for each point in z. The gridpoints are from 0 mm to 75 mm,
in 3 mm steps, for both x and y coordinates. This data forms a 3-D grid in the first
Cartesian quadrant, when the partitions are combined, is spaced 0.8 m in length along
the magnetic axis. The Cartesian components of magnetic field data, B = (Bx, By, Bz),
have been calculated at each grid point.
Both partitions of data share an x-y grid at the z = 700 mm point. There can be different
ways of combining the partitions. The method that was chosen for the numeric grid data
was to take the average of both 700 mm points.
300 400 500 600 700 800 900 1000 1100
z [mm]
y = 12mm
y = 27mm
y = 42mm
Figure 4.1: The magnetic field data of an HL-LHC inner triplet quadrupole magnet
produced via simulation using an electromagnetic code. The horizontal component is
shown, Bx, at x = 0 mm and for different y values. The field spans the region, along
the z axis, between full field in the body of the magnet and vacuum.
To generate a full 3-D field that includes values for negative x and y, the relevant
symmetry operations, as necessary for a quadrupole field (see fig. 3.1c), were performed.
59 Chapter 4. Method
The resultant field will therefore be on a grid x, y  [75, 75] mm in 3 mm steps, and
z  [0, 800] mm in 5 mm steps.
4.1.2 Fitting the Enge field
Techniques have been developed by Muratori et al. [5] to produce analytical descriptions
of a fringe field. These techniques will be used to contrast the numeric field data provided
in section 4.1.1. The analytic descriptions derived by Muratori et al. are general and
can therefore be applied to different fringe field models. Enge fringe fields, introduced in
section 3.1.5, have the advantage of being a model that can approximate a multipole
fringe field. The analytical descriptions used in this thesis are the same as the the
analytical descriptions derived by Muratori et al. in [5] and are therefore based on an
Enge model.
The Enge model is required to be fit to the numeric model given in section 4.1.1. The
first step of the fitting process is to rescale the field and offset it appropriately, using
eqs. (4.1) to (4.3), so that the resultant field shape can be fitted appropriately by the
analytic field description outlined by Muratori et al. [5].
x = scale  x , (4.1)
y = scale  y , (4.2)
z = scale  (z  offset) , (4.3)
where scale and offset are scaling and offsets respectively [5]. In conjunction with two
other free parameters used for fitting, b and bscale, the Enge field can then be calculated
using [5]:
Bx = bscale
2 (1 b2)
1 + e
2z+ih
1 + e
2zih
1 + e
2zih
1 + e
2z+ih
(4.4)
By = bscale
2 (1 + b2)
1 + e
2z+ih
1 + e
2zih
1 + e
2zih
1 + e
2z+ih
(4.5)
Chapter 4. Method 60
Bz = bscale
2 (1 b4)
1 + e
2z+ih
1 + e
2zih
1 + e
2zih
1 + e
2z+ih
(4.6)
where h, h are functions defined as follows:
y , (4.7)
y . (4.8)
The b parameter controls how the off-axis fringe field decays longitudinally. The fringe
field on axis is not affected by the b parameter [5].
The Enge field was fit to the numeric field data to provide the best agreement. The
fitting was performed by A. Wolski [36]. The same numeric field data was used for the
fit as in section 4.1.1 , and the same symmetry reconstruction was used to generate the
full 3-D field. One crucial difference in this case was that the field data was reflected
in z = 0. Thus the result this would represent a fringe field that begins as field-free to
full strength with increasing z. Another difference in this case was that the grid data
files were combined differently compared to section 4.1.1. The z = 700 mm point is
common to both longitudinal partitions of the grid data, 300 mm to 700 mm and 700 mm
to 1100 mm. In this case the field data which the Enge field was fit against, used the
700 mm data values from the 300 mm to 700 mm partition. This is in contrast to the
numeric field merging which took an average of these points (see section 4.1.1).
The results of the Enge fit are presented in table 4.1.
b scale offset bscale
1.5 -19.2 -0.6 7.3
Table 4.1: The values of the free parameters used to fit the analytic Enge field model
to the simulated numeric field data.
As evidenced by fig. 4.2, the Enge field is in agreement with the numeric field. The
numeric field exhibits an asymmetry that is not modelled by the Enge field; this is
apparent in the longitudinal component in fig. 4.2c. For a static magnetic field, Gausss
law of magnetism and Ampres circuital law (see eqs. (3.3) and (3.5)) can be simplified
 B = B = 0 . (4.9)
61 Chapter 4. Method
-1.1 -1 -0.9 -0.8 -0.7 -0.6 -0.5 -0.4 -0.3
z (m)
 against z
Numeric
-1.1 -1 -0.9 -0.8 -0.7 -0.6 -0.5 -0.4 -0.3
z (m)
 against z
Numeric
-1.1 -1 -0.9 -0.8 -0.7 -0.6 -0.5 -0.4 -0.3
z (m)
-0.09
-0.08
-0.07
-0.06
-0.05
-0.04
-0.03
-0.02
-0.01
 against z
Numeric
Figure 4.2: A comparison between a simulated field of the HL-LHC fringe region, and
an analytic Enge field model which has been fit to the simulated field. A) The horizontal
magnetic field Bx component at x=0, y=1mm, along the field axis. B) The vertical
magnetic field component By at x=1mm, y=0 along the field axis. C) The longitudinal
magnetic field Bz component at x=1mm, y=1mm along the field axis. [36]
Muratori et al. derives relationships between the transverse components and the longitud-
inal component that satisfy Maxwells equations for a static field (given by eq. (4.9)) [5].
A change in coordinates is performed to make this easier [5]:
(x+ iy) , (4.10)
(x iy) , (4.11)
2z . (4.12)
Chapter 4. Method 62
The magnetic field components in the new coordinates can be expressed in terms of the
old as [5]:
(Bx + iBy) , (4.13)
(Bx  iBy) , (4.14)
Bz . (4.15)
Then, the relationships between the magnetic field components in the new coordinates
can be written as [5]:
uBu + B = 0 , (4.16)
vBv + B = 0 , (4.17)
Bu  vB = 0 , (4.18)
Bv  uB = 0 . (4.19)
From these relationships it is clear that for a fringe field, i.e. when there is a longitudinal
rate of change of Bu or Bv or Bu,v 6= 0, then B cannot be constant (u,vB 6= 0).
Therefore one reason for differences seen in the numeric field compared to the analytic
Enge field in fig. 4.2c (the numeric field exhibits an asymmetry that the analytic Enge
field does not) could be due to the fact that the longitudinal Bz is dependent on the
longitudinal rate of change of Bx and By. The numeric field has a different longitudinal
behaviour in Bx and By and therefore it can be expected to have a different behaviour
in Bz compared to the Enge field.
4.1.3 Generating the generalised gradients
The generalised gradients were produced from surface data. The surface data describes
the normal component of the magnetic field on a circular cylindrical grid. The theory
behind the generalised gradients can be found in section 3.1.6.
In this subsection the surface data production is covered first, followed by the generalised
gradient generation from the surface data.
63 Chapter 4. Method
Cylindrical surface data creation
The creation of cylindrical surface data required for the generalised gradients required
different methods for the numeric field and the analytic Enge field.
First the process of creating the cylindrical surface data for the numeric field is described.
For the numeric field the magnetic grid data described one Cartesian quadrant across
two longitudinal partitions of 300 mm to 700 mm and 700 mm to 1100 mm. The number
of data points in a single partition was (nx, ny, nz) = (26, 26, 81). When the two files
are joined the number of points in z is 161, this is due to the z = 700 mm being shared
across partitions. The combined partition data is representative of the magnetic field
in one Cartesian quadrant. Reflecting the quadrant along the x and y axes result in a
51 51 161 grid. Note that there are grid points lying on both axes of reflection: the
x and y axes. Finally the data is reflected in z which produced a 51 51 321 grid.
In the case of the numeric field data, the grid data is interpolated using cubic splines to
construct the surface data. The normal component of the magnetic field on a cylindrical
surface was calculated for a grid of points, where n = 64 and nz = 400, spanning the
curved surface of the cylinder. The cylinder has a radius of 60 mm. As the axis of the
cylinder is parallel to the z-axis, the normal magnetic field component can be calculated
with the horizontal and vertical field components using B = Bx cos+By sin.
In section 3.1.6 it was mentioned that errors on the field descriptions generated using
generalised gradients get smaller when approaching the cylindrical axis. There is also
the inverse effect, that errors grow for field descriptions outside the cylinder. As it has
already been mentioned, the cylinder radius chosen for this study was 60 mm.
An estimation can be used when considering the cylinder radius in terms of the amplitudes
of the particles from the closed orbit. In later sections the HL-LHCv1.0 lattice will be
detailed, but some key properties are needed for the discussion here. The maximum
value of x across the lattice is x = 20.894 103 m, the x-coordinate of the closed orbit
at that point is xco = 1.646 102 m, and the emittance is x = 3.35 1010 m rad.
Using the ellipse in fig. 3.9, a simple estimation can be calculated:
xmax =
2xJx = 3.74 103 m , (4.20)
where xmax is an estimation of the maximum x offset from the closed orbit, and the
action, Jx, was chosen to be equal to the emittance (the average of all actions in a bunch).
In the frequency map analysis results, particles up to 20 beam sizes from the closed orbit
will be tracked. When taking into account the closed orbit the result becomes:
Chapter 4. Method 64
xco + 20 xmax =5.84 102 m , (4.21)
xco  20 xmax =9.13 102 m . (4.22)
Therefore these estimations suggest that the particles with the greatest initial amplitudes
may be at risk of experiencing fields greater than the radius of the cylinder and would
therefore experience larger errors.
David Newtons BlitzDA code was used to do the spline interpolation. More information
about the program is given in the method section, section 4.4, and examples of its usage
with other studies is summarised in section 2.4. Spline fitting is useful because it can
be applied to arbitrary functions. Cubic splines exhibit C2 continuity, which means
the spline is a twice differentiable function that is continuous as well as its first and
second derivatives. Splines also have the advantage of local fitting, and are therefore not
constrained to globally fit an entire range like a polynomial fit.
As mentioned previously, the process to create the cylindrical surface data for the Enge
field differs from the numeric field. The Enge field can be reconstructed at any point by
using the fitting parameters and eqs. (4.4) to (4.6). This is an advantage over the surface
data construction of a numeric field that relies on interpolation to calculate intermediate
data. The Enge field was calculated on the grid of points on the surface of the cylinder
with a radius of 60 mm, and the same number of points as the numeric field were used,
n = 64 and nz = 400.
For consistency, across both sets of surface data, the z values were transformed to start
from z = 0 m. The surface data is also reflected about z = 0.8 m so the data is periodic
in z as is required in the generalised gradient construction.
The surface data constructed from the numeric field can be seen in fig. 4.3, and the
surface data for the Enge field can be seen in fig. 4.4. Figure 4.5 shows the difference
between the surface data produced from both the numeric field and the Enge field.
The surface data plotted in figs. 4.3 to 4.5 exhibit four fold reflectional symmetry in
the x and y axes, and a reflection at the midpoint of the longitudinal axis z = 0.8 m.
The reflections in z are to be expected given the construction of the surface data. The
four fold reflection symmetry in the case of the numeric field can be expected due to its
construction, and the Enge field inherits this symmetry due to it having been fit to the
numeric field.
The analytic Enge surface data appears to be asymmetric in each quadrant which is
different from the numeric field surface data. This could be due to the fact that the
analytic Enge solution was based on a non-symmetrised model and therefore does not
respect the symmetry constraint imposed on a quadrupole (see eq. (3.25)). To restate
65 Chapter 4. Method
0 1 2 3 4 5 6
Angle (rad)
1.596
Figure 4.3: A contour plot of the numeric field component normal to the curved
surface of a circular cylinder, with an axis along the magnetic axis.
0 1 2 3 4 5 6
Angle (rad)
1.596
Figure 4.4: A contour plot of the analytic Enge field component normal to the curved
surface of a circular cylinder, with an axis along the magnetic axis.
Chapter 4. Method 66
0 1 2 3 4 5 6
Angle (rad)
1.596
Figure 4.5: A contour plot of the difference in the magnetic field component normal to
the curved surface of a circular cylinder between the numeric and analytic Enge fields.
The cylinder axis lies along the magnetic axis.
the symmetry constraint: for a quadrupole, where n = 2, a rotation of the field by /n
should result in a field that is equal to the unrotated field but with an opposite sign (as
discussed already in section 3.1.1).
Using the numeric fringe field data plotted in fig. 4.1, it appears that the region of the
fringe field is approximately contained within the region between 400 mm to 800 mm.
Converting this approximate fringe field region to the scale of the surface data results in
two fringe field regions (due to reflection in z): 0.3 m to 0.7 m and 0.9 m to 1.3 m.
It can be seen that the major differences, in fig. 4.5, between the surface data constructed
using the numeric field and the analytic Enge field is also confined to this region.
Differences in the longitudinal fall-off of the fringe field could be expected due to the
numeric field and analytic field being different models. The fact that the differences are
not centred and symmetric about the expected quadrupole poles, /4, 3/4,    , is due
to the asymmetry exhibited by the Enge surface data.
The differences between the surface data should be taken note of, and if there is evidence
that the differences are too large for the analytic Enge field to be used in place of the
numeric field, then work can be done to reduce those differences. This could be achieved
by using a symmetrised model of the analytic Enge field to eliminate the asymmetry
seen in the current Enge surface data. Also a different fringe field model could be chosen
that better replicates the longitudinal fall-off of the numeric field.
67 Chapter 4. Method
Constructing generalised gradients from surface data
The generalised gradients are produced using a two-dimensional Fourier transform of the
cylindrical surface data. This two-dimensional Fourier transform is shown in eq. (3.34) [31,
eq 17.3.3] 1:
B (R,m, k) = [1/2]2
dz exp (ikz)
d exp (im)B (R,, z) ,
(3.34 revisited)
where B (R,, z) is the normal magnetic field component on the cylindrical surface, and
B (R,m, k) is the Fourier transformed field. How the generalised gradients, C
m , are
explicitly generated from Fourier transform results is shown in eq. (3.37) [31, eq 17.3.8]:
C [n]m (z) = i
n (1/2)|m| (1/|m|)
kn+|m|1/Im (kR)
B (R,m, k) exp (ikz) ,
(3.37 revisited)
where m is the multipole order, n is the index of the generalised gradient function of a
given multipole, and Im (kR) is the modified Bessel function.
The wavenumber was calculated using eq. (4.23).
k[iz ]z = iz 2/(zmax  zmin) , (4.23)
where iz the indexed z position, iz  [0, nz], and nz is the total number of points in z.
The equivalent wavenumber in , k, was sampled between [0, 2) and so the resulting
wavenumber binning in  corresponds with integer cycles over 2. The number of points
in z, number of points in , is determined from the surface data file chosen.
The Fourier transform of the numeric data, as can be seen in fig. 4.6, show that the
Fourier magnitudes are larger when k is even. Furthermore every fourth bin in k has
a smaller magnitude than the other even bins that do not meet that criteria. This is
in agreement with the allowed symmetries of a quadrupole, i.e. m = 2, 6, 10,    . The
Fourier transform of the analytic Enge data also show larger Fourier magnitudes for even
k bins rather than odd bins. But the Enge case does not show the same disparity as
the numeric case between even k bins not divisible by 4, and even bins divisible by 4.
In fact in fig. 4.7 it can be seen that the k bins divisible by 4 have larger magnitudes,
particularly for small kz values.
There is a cut in the data performed in the Fourier transform results; the wavenumber
results kz  400 m1 are ignored. This is because the Fourier data becomes smaller as
1Unless otherwise stated i is the imaginary unit i =
Chapter 4. Method 68
0 5 10 15 20 25 30
Figure 4.6: The magnitude of the 2-D Fourier transform of the numeric surface data.
Fourier transforms were performed in  and z. The Fourier transform is shown across
the  and z wavenumbers.
kz increases. Therefore to reduce the influence of noise, the higher frequency components
were removed.
There is a separation in the Fourier magnitudes between the even and odd bins (see
figs. 4.6 and 4.7), with the odd bins being many orders of magnitude less than the even.
The Fourier results with very small magnitudes were interpreted as adding unwanted noise.
Therefore it was decided to cut the Fourier results for all values less than 1010 T m rad,
with the cut values set to zero.
In producing the Taylor maps for the HL-LHC, a test proton with energy 7 TeV was used.
To produce a map describing an opposite magnetic field an anti-proton was used instead.
An entrance fringe field, zero field to full field, can then be created by integrating for a
proton travelling through the field between the bounds of 0 to 0.8 m. Similarly an exit
field could be produced from 0.8 to 1.6 m.
For the numeric field data the generalised gradients were calculated for 0  m, l 
7. The generalised gradients for the solenoid terms, m = 0, were set equal to zero.
This was because the solenoid term should not have a large contribution to the field,
69 Chapter 4. Method
0 5 10 15 20 25 30
Figure 4.7: The magnitude of the 2-D Fourier transform of the analytic Enge surface
data. Fourier transforms were performed in  and z. The Fourier transform is shown
across the  and z wavenumbers.
and additionally Dragt recommends that the solenoid terms should not be used when
generating generalised gradients from cylindrical surface field data [31]. The generalised
gradients were calculated up to order m = 7 because the use of the differentiated vector
potential, A, in the Wu-Forest-Robin integration means that the vector potential has
to be one order higher than the magnetic multipole being considered. The generalised
gradients are then used to produce an analytic description of the magnetic vector potential
A [31, eq.15.4.21 - 15.4.26].
Chapter 4. Method 70
Am,cx = (1/m)x Im[(x+ iy)
(1)l
22ll(l +m)
C [2l+1]m,c (z)(x
2 + y2)l ,
(3.45 revisited)
Am,cy = (1/m)y Im[(x+ iy)
(1)l
22ll(l +m)
C [2l+1]m,c (z)(x
2 + y2)l ,
(3.46 revisited)
Am,cz = (1/m) Im[(x+ iy)
(1)l
(2l +m)m
22ll(l +m)
C [2l]m,c(z)(x
2 + y2)l ,
(3.47 revisited)
Am,sx = (1/m)xRe[(x+ iy)
(1)l
22ll(l +m)
C [2l+1]m,s (z)(x
2 + y2)l ,
(3.48 revisited)
Am,sy = (1/m)yRe[(x+ iy)
(1)l
22ll(l +m)
C [2l+1]m,s (z)(x
2 + y2)l ,
(3.49 revisited)
Am,sz = (1/m) Re[(x+ iy)
(1)l
(2l +m)m
22ll(l +m)
C [2l]m,s(z)(x
2 + y2)l .
(3.50 revisited)
The magnetic vector potential can then be used with a Wu-Forest-Robin integrator to
produce a Taylor series describing a transfer map through the field. This series has to be
truncated at some finite order; this truncation means that despite using a symplectic
integrator, the transfer map is non-symplectic.
The Runge-Kutta process was different to the Wu-Forest-Robin Taylor map process.
The generalised gradients were only produced for the m = 2, 6 cases, because these
are the main multipole components allowed for a quadrupole for m  7. The vector
potential, Ax, Ay, was then calculated from the generalised gradients. The first and
second derivatives of the vector potential were calculated and used for the calculation of
H and 2H.
Once the generalised gradients have been constructed for the numeric and Enge fields,
and transfer maps generated from them - the next step is to put the transfer maps into
the HL-LHC lattice.
71 Chapter 4. Method
4.2 Construction of the HL-LHC in the simulation
4.2.1 Importing a MAD lattice into SAMM
The HL-LHC model lattice used in the particle tracking studies is the conversion of
a MAD [7] lattice description into SAMM [14], (for more information on SAMM see
section 4.5). The following steps were used to generate the MAD lattice and import into
SAMM.
1. The lattice in MAD form was produced from a MAD-X script 2.
2. The script was designed to calculate the Twiss parameters for a lattice, and was
run on a thin lens HL-LHC lattice sequence file3.
3. The script is also designed to generate a file of the appropriate magnetic field errors
for a given random seed and lattice description. The random seed used was set to
4. The file of magnetic error files was parsed by a SAMM file4. The file of Twiss
parameters was parsed by a SAMM file5. Both parser files were provided by
A. Wolski [37].
5. The Error file parser was run first. It would iterate the MAD-X error table of the
HL-LHC and store the multipole field errors into an array.
6. The Twiss file parser was run after the Error file parser. It was used to iterate
over the HL-LHC sequence and convert the MAD elements in SAMM equivalents,
whilst maintaining their order and copying their relevant properties. The elements
that the parser was able to convert were: Marker, Drift, Kicker, Multipole, and
RF-Cavity. The Twiss parser would then apply the multipole field errors, converted
using the Error file parser, and apply them to the multipole in the SAMM lattice.
4.2.2 Adding fringe fields to the HL-LHC lattice
To add fringe fields it is necessary to also add additional components. For an entrance
field the following is added:
 A negative drift.
 A retuning element.
2The script was job-tracking.mask from CERNs servers.
3The sequence file was hllhc_thin.seq, for HL-LHCv1.0.
4The file was ParseMADXFieldErrors.m.
5The file was ParseMADXTwiss.m.
Chapter 4. Method 72
 The fringe field.
 A positive drift.
Figure 4.8: A schematic showing how drifts and a retuning element are added in
combination with the fringe fields on either side of the inner triplet which is decomposed
into thin lenses. NB: The length of the full magnet is for a HL-LHCv1.0 Q1 or Q3 class
inner triplet magnet, whereas a Q2 class has a length 6.792 m
The negative and positive drifts are required to place the fringe fields in the correct
location within the lattice. The retuning element is a linear inverse of the fringe field and
is intended to remove the contribution of the fringe field to the linear dynamics of the
lattice (primarily in the form of additional focusing). For an exit field, the components
are added in the opposite order as can be seen in fig. 4.8. It should be clarified that
in fig. 4.8 the retuning element actually has infinitesimal length. This is because the
SAMM tracking code (see section 4.5) applies the linear inverse to the linear dynamics
but does not treat it as having length. It is shown as a thicker orange element attached
to the fringe field length to make it distinguishable on the schematic.
4.2.3 Restoring the desired chromaticity of the HL-LHC lattice
Adding fringe fields to the lattice has an effect on the chromaticity of the ring, even after
the retuning element has been added.
Once the fringe fields are added the tunes and chromaticity of the lattice is calculated.
The magnetic field strengths of the sextupoles around the lattice are then readjusted by
the same factor to change the chromaticity to the desired value. The chromaticity stated
in the MAD files is used for reference.
The chromaticity is calculated using turn by turn tracking and then using a NAFF
algorithm to find the tune. See section 4.3.2 for more information about the NAFF
algorithm.
73 Chapter 4. Method
The chromaticity restoration algorithm used in this thesis makes use of Matlabs fzero root
finding algorithm [38], also known as Brents method [39]. The chromaticity restoration
algorithm calculates the chromaticity of a lattice. The function passed to the root finding
algorithm was: the difference between the horizontal chromaticity calculated by SAMM
and the chromaticity determined by MAD-X (each for the HL-LHCv1.0 lattice). The
independent variable of Brents method was the rescaling factor to be applied to the
sextupoles. Each of the sextupoles in the HL-LHC ring was then scaled by this factor.
Therefore the chromaticity restoration algorithm, by using Brents method, would try
to find the rescaling factor that results in (or as close to) a zero difference between the
desired MAD chromaticity and the chromaticity calculated using NAFF.
4.3 Techniques used to produce results
4.3.1 Transfer functions
The transfer function is produced by tracking particles through a map with a range
of initial displacements, and then comparing these displacements against the resultant
change in momentum through the map. Transfer functions can also be known as trace
space plots [40]. This method should reveal the magnitude of a focusing or defocusing
effect.
Any non linearities in the focusing can be examined by fitting a straight line to the fit
and then plotting the data minus the linear fit. This technique will be referred to later
as the nonlinear transfer function
4.3.2 Numerical analysis of fundamental frequencies (NAFF)
Laskar [26] describes an algorithm called Numerical Analysis of Fundamental Frequencies
(NAFF) which can be used to find the fundamental frequencies of quasi periodic motion
of a Hamiltonian system. It is useful because NAFF gives a better estimation of the
largest peak of Fourier-transformed data by several orders of magnitude compared to a
plain Fourier transform.
First, a Fourier transform is applied to a sampling of the quasi periodic motion over
a certain period of time. The Fourier transform results in an approximation of the
frequency space of the motion being considered. A window function is applied to the
data, usually in the form of a Hanning window [41]. The effect of the window is to reduce
the side-lobes peaks neighbouring the fundamental frequency peaks; this is useful because
peaks that are close by can distort each other and lead to a less accurate determination
of the fundamental frequency. After applying the window, an iterative process is used to
determine each fundamental frequency:
Chapter 4. Method 74
1. Find the maximum value of the Fourier transform.
2. Use quadratic interpolation for a better determination of the peak, j , where j is
the number of the frequency.
3. Remove this frequency component, ei1t, from the transform and repeat from Step
1, until as many frequencies as required have been identified.
4.3.3 Chromaticity investigations
The chromaticity can be determined in two ways: numerically or using a one turn map.
In the numeric method, the particles can be set up with a range of initial energy deviations
from the reference energy. The particles are also given the same displacement from
the closed orbit. This displacement is necessary as the tunes of the particles are then
calculated by particle tracking and then computed using the NAFF algorithm; for very
small displacements the tune computation was not accurate (see section 4.3.2). Once the
turns are computed for each particle, it is then a matter of determining the gradient of
the tune against energy deviation at zero energy deviation. This can be done by fitting
to a polynomial, and then using the fit values to compute the chromaticity. Imagine a
hypothetical case where that energy deviation against tune is well approximated by a
quadratic fit like in eq. (4.24):
 = p12 + p2 + p3 , (4.24)
where  is the energy deviation and  is the tune. It is easy to see by differentiation that
the linear parameter p2 is the gradient of the tune against energy deviation for  = 0.
In the one turn map method, the tune, , of particles with different momentum, dp, is
investigated. Crucially these particles are also tracked in a lattice where the RF cavity
frequency has been changed from reference frequency. The chromaticity is then calculated
as the gradient of tune against dp.
4.3.4 Tune shift with amplitude
The tune shift with amplitude shows the change in tune of a particle for different
displacements from the closed orbit.
The particles are set up to have a range of initial displacements from the closed orbit.
The tune of each particle is calculated from turn-by-turn data produced by tracking
simulations. More specifically the tune is found using a NAFF algorithm (more detail
can be found in section 4.3.2) which gives a better determination of the peak position in
the turn-by-turn Fourier power spectrum.
75 Chapter 4. Method
4.3.5 Frequency map analysis
In Laskar [24] a technique called Frequency Map Analysis (FMA) is discussed. It is
used to describe how the tune of a particle changes, for an array of particles of different
actions.
Particles with a tune that varies more are more likely to be unstable, in comparison to
particles with a consistent tune. The change in tune is measured by:
2[T1,T2] + 
[T2,T3] , (4.25)
where [T1,T2] is the tune calculated by the NAFF algorithm between turn number T1
and T2. The amount of turns to sample for NAFF is in the order of thousands of turns.
Therefore frequency map analysis can provide an estimate of dynamic aperture, but
without the computationally expensive long-term tracking required of other techniques
like survival plots. Frequency map analysis can also reveal changes in the general
stability over phase space for different changes in lattice, particularly when errors and
nonlinearities are introduced.
The frequency maps can be shown in action (analogous to coordinate space for fixed
momenta), as well as in tune space. In tune space it can reveal which resonances have
an impact on the beam. The geometry of the frequency map in tune space can also be
important. Frequency maps can exhibit one or more folds, which could imply unstable
fast escape regions [24]; therefore the stability of the folds are important to consider.
4.3.6 Processing the tracking results
The tracking data can produce values known as not-a-number (NaN) which represent
floating point numbers that are undefined, e.g. the result due a division by 0. The
particles which have NaNs in their coordinates after tracking are omitted.
NaNs are unordered, which means they cannot be less than, greater than, or equal to
other floating point values. Therefore it is crucial to test for NaNs separately, because
they will not test positive if they are outside the aperture limits. Also NaNs propagate
in the sense that any floating point operations with a NaN as an operand will produce a
NaN. Therefore NaNs could not be used in a tune calculation, for example, because the
NaNs would propagate via the algorithm resulting in a NaN as the value calculated for
the tune [42].
Also any particles with distance flag equal to zero, which represents them reaching an
extent greater than a limit, are considered lost. These particles are also removed.
Chapter 4. Method 76
4.4 BlitzDA differential algebra code
The BlitzDA differential algebra code is a program that was developed by D. Newton.
It has been used in various studies requiring accurate descriptions of electromagnetic
fields [18, 21, 19, 20]. It is a C++ program that is designed for quick numerical processing
of differential algebra objects, such as the expansion of a Taylor series. The code has
functionality to do basic maths (add, multiply, etc.) to the series as well as performing
operations such as differentiation. This code was used in this work to compute generalised
gradients from surface data. The generalised gradients were then used to describe the
vector potential as a power series. The vector potential was then integrated to produce a
transfer map in the form of a truncated Taylor series.
The code is composed of several modules, at the core is a Differential Algebra module.
The spline interpolation within BlitzDA is performed by a Fortran library designed by
Wolfgang Schadow [43]. The library is simply referred to as B-spline library, and BlitzDA
uses version 2.2. The library comes in Fortran 77 and Fortran 90 versions, of which the
BlitzDA code uses the Fortran 90 version. The Fortran code is designed to be similar
to an implementation in the IMSL library released by Rogue Wave Software [44]. The
spline functions themselves are based on work by Carl de Boor [45]. The steps taken to
perform the spline interpolation is as follows:
 dbsnak - Computes the not-a-knot spline knot sequence. [44]
 dbs3in - Computes a three-dimensional tensor-product spline interpolant, returning
the tensor-product B-spline coefficients. [44]
 dbs3vl - This function evaluates a three-dimensional tensor-product spline, given
its tensor-product B-spline representation. [44]
The routines used were set to generate cubic splines. The advantage of b-splines for
fitting an arbitrary function is that they are piecewise polynomial descriptions, and so
can fit complicated curves/surfaces with several points of inflection. The b-splines also
offer the ability to interpolate. This is how the field was calculated for the points on the
cylindrical surface.
4.5 SAMM particle tracking code
The SAMM particle tracking code is a particle tracking program developed by A. Wol-
ski [14]. It is developed first as a MATLAB teaching tool, and so has a clear structure
and is easy to extend and interface with the code. The code has extensions written in
77 Chapter 4. Method
the programming languages C and CUDA which are more performant numerically and
so allow for results to be produced faster.
In this work, SAMM has been used extensively to describe beams of protons, as well as
the HL-LHC lattice. SAMM has classes to define an accelerator beam and an accelerator
beamline. The beamline itself can be made up of the following components such as the
marker, drift space, solenoid, orbit corrector, dipole, quadrupole, sextupole, a generic
multipole, RF cavity, RF accelerating structure, master oscillator, and beam position
monitor. In this study the multipole component was used to model the magnets imported
from the MAD-X thin lens HL-LHCv1.0 lattice. This method is further described in
section 4.2. The multipole component can model upto an arbitrary number of multipoles.
SAMM can also compute the transfer matrix by using the results of tracking particles
with a small change from the reference trajectory. Furthermore SAMM can calculate
the closed orbit in a looped accelerator or storage ring. The dispersion can be computed
indirectly by changes to the master oscillator. The Courant-Snyder parameters along the
ring can also be calculated using SAMM.
Chapter 5
Results
The stability of the beam is critical to the successful operation of the HL-LHC. As
established in earlier chapters, fringe fields have the potential to reduce the beam
stability due to their nonlinear effects. In this chapter, the effect of fringe field models on
the stability of the beam is compared with the no fringe lattice. This was investigated
primarily with frequency map analysis.
The results from other techniques, namely generalised gradients, transfer functions,
chromaticity, and tune shift with amplitude, were used to characterise the beam and
lattice.
5.1 Generalised gradients
The generalised gradients produced from two field models are compared in this section.
The numeric field model is generated via a magnetic field program which models the
HL-LHC inner triplet magnet. The Enge field model is an analytic model, which is
fitted against the numeric model. The construction of these field models is covered in
sections 4.1.1 and 4.1.2 for the numeric and Enge models respectively.
Generalised gradients are a technique used to describe s-dependent fields decomposed
into sets of multipole fields, indexed by parameter m, and the differentials of those fields,
which are indexed by parameter l. The parameters chosen for producing the generalised
gradients are shown in section 4.1.3 and the theoretical background is covered more
extensively in section 3.1.6.
Generalised gradients for the comparison in this section were calculated for both fields
where m = 0, 1, . . . , 7 and where l = 0, 1, . . . , 7.
It should be noted that the generalised gradients produced are subject to a couple of cuts,
setting generalised gradients that met certain conditions equal to zero, e.g. C(z) = 0 ,z.
Chapter 5. Results 80
The first cut to consider is the cut on higher wavenumbers; wavenumbers for which
kz  400 m1 are ignored. To summarise the explanation set out in section 4.1.3, this
was to reduce the effects of noise on the construction of the generalised gradients. Any
extra noise in the generalised gradients could affect the calculation of the vector potential,
which would also influence the generation of transfer maps, and ultimately the tracking.
The second cut to note is the cut during the Fourier transform calculation in the general-
ised gradient calculation. There is a cut for all Fourier values less than 1010 T m rad.
This again was to reduce the effect of noise during the creation of the generalised
gradients.
The generalised gradients produced from the numeric field are non-zero for m = 2, 6.
This is consistent with the expected multipoles allowed by symmetries as discussed in
section 3.1.1. In the case of the analytic Enge field it also has a non-zero octupole
term, m = 4. This is due to choice of equations used for the Enge field here. In
Muratori et al. the equations that describe the Enge field can be either symmetrised or
non-symmetrised [5].
The choice in this study was to use the non-symmetrised solutions, as it is a simpler
model. The non-symmetrised solutions are non-symmetric for the four-fold case, and
therefore the analytic fringe fields do not have the four-fold symmetry expected by a true
quadrupole [5]. In other words when transposing the coordinates, x y, the magnetic
field is not symmetric when transposing Bx  By. The octupole term, m = 4, is likely
to feature more prominently due to there being no symmetric constraints. This can be
seen in the m = 4 results in (fig. 5.2).
The magnetic symmetric constraint is described by eq. (3.25) and accompanying text in
section 3.1.1. Furthermore an octupole field, m = 4, can be seen in fig. 3.2a.
It is possible to use a symmetrised solution for the Enge field, but according to Muratori
et al. it requires the superposition of two quadrupole solutions [5]. If a symmetrised
solution is used for the Enge field it is possible that this could lead to agreement in the
octupole components between the numeric field and the Enge field.
The generalised gradients are even functions when l = 0 which corresponds with their
construction by reflecting the fringe field in the z-axis (for more information see sec-
tion 4.1.3). It is a property of the generalised gradients that a generalised gradient with
order l + 1, C [l+1]m , represents a derivative in z of the lower-order generalised gradient
with order l, C [l]m . As such it can be noted that in figs. 5.1 to 5.3 that each function
alternates between an odd and an even function with increasing l. This is expected due
to the differentiation of an even function producing an odd function and vice versa.
As can be seen in the m = 2 graphs (fig. 5.1), there is good agreement between the two
field models for small l.
81 Chapter 5. Results
Figures 5.1 to 5.3 also exhibit oscillatory behaviour as l increases. This can be attributed
to the continued differentiation of an analytic function, f(t), over some region in t-space,
which can produce oscillations that grow larger in t-space [46].
As l gets larger the higher-order derivative behaviour between the models diverge. The
Enge field exhibits less oscillations and smaller amplitudes, whereas in comparison the
numeric field data exhibits oscillatory behaviour that exhibits more oscillations and
greater amplitude for each step in l.
Section 4.1.2 details the fitting process of the Enge field to the numeric field. Similar
discrepancies discussed in section 4.1.2 which can be seen in fig. 4.2 are also exhibited in
the fig. 5.1. In particular the asymmetries visible in the Bz component of the Enge field
(fig. 4.2c) are similar to those of the C [1]2 generalised gradient plotted in fig. 5.1b. This
similarity can be attributed to the relationship between the partial derivatives of the
magnetic field components for a magneto-static field. These relationships derives from
Maxwells magneto-static equations eqs. (4.16) to (4.19).
As can be seen by the m = 6 graphs (fig. 5.3), the generalised gradient C [0]6 which
corresponds directly to the dodecapole field, shows that the numeric field exhibits a
much larger amplitude than the Enge field. The shape of the graphs are the same for
low orders of l. For the higher orders of l the rapid differentiation leads to differences
in shape. The higher l-order generalised gradients also show much greater amplitudes
for the numeric field compared with the Enge field which corresponds with the m = 2
graphs (fig. 5.1).
Chapter 5. Results 82
0 0.5 1 1.5
z (m)
Numeric
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
-10000
-5000
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
Figure 5.1: A comparison of the generalised gradients, for multipole m = 2 and orders
from l = 0 up to 7, of the analytic Enge field and the numeric field.
83 Chapter 5. Results
0 0.5 1 1.5
z (m)
Numeric
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
Figure 5.2: A comparison of the generalised gradients, for multipole m = 4 and orders
from l = 0 upto 7, of the analytic Enge field and the numeric field.
Chapter 5. Results 84
0 0.5 1 1.5
z (m)
Numeric
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
0 0.5 1 1.5
z (m)
Figure 5.3: A comparison of the generalised gradients, for multipole m = 6 and orders
from l = 0 up to 7, of the analytic Enge field and the numeric field.
85 Chapter 5. Results
5.2 Transfer functions
Transfer functions show the change in momentum for a given initial coordinate dis-
placement. The results are obtained by tracking particles with these displacements, xi,
through different field models and calculating their change in momentum, px. Thus this
technique is useful in examining the focusing dynamics of accelerator components such as
a quadrupole magnet. More information and theory behind transfer functions is covered
in section 4.3.1. In this section linear and nonlinear transfer functions for both the Enge
and numeric fields using the Taylor map or Runge-Kutta methods are presented.
Figures 5.4 to 5.7 show the transfer functions for the Enge and numeric fields, and for
both integration methods: Taylor map and Runge-Kutta. On each subplot within the
figures there are two axes; the left axis corresponds with the transfer function results
unmodified, and the right axis corresponds with the nonlinear transfer function. As
the fields are quadrupoles, the transfer functions are linear in shape. If a fifth order
polynomial is fit to this linear transfer function, then the linear part (conventionally
f = ax+ b) can be removed from the data. The remainder after removing the linear part
is referred to here as the nonlinear transfer function. The nonlinear transfer function
shows the non-linearity of the transfer functions, which is otherwise difficult to see given
their predominantly linear behaviour.
As stated previously the transfer functions cover the four fringe field models. The models
are based either on a numeric (N) or Enge (E) field, and additionally a choice of numeric
integration in the form of a Wu-Forest-Robin Taylor map (TM) or implicit Runge-Kutta
(RK) integrator. The model with no fringe field is not included here because by definition
there would be nothing to integrate over. Each case can be split into two: those for the
entrance fringe (from no field into full field) and exit fringe (from full field to no field).
Each of the former cases can be further split into results for the horizontal phase space
and those in the vertical phase space. Lastly the transfer functions can be calculated for
focusing and defocusing cases.
The transfer functions were fit using a fifth order polynomial (also known as a quintic
polynomial); the equation of the polynomial fit is shown in eq. (5.1). The results of the
fitting across the different dimensions is shown in tables 5.1 to 5.4. The column headings
correspond with the parameters shown in eq. (5.1).
f = p1x5 + p2x4 + p3x3 + p4x2 + p5x+ p6 . (5.1)
Several patterns are observed in these fits. The fifth order polynomials fit matches exactly
the data in each case as shown in figs. 5.4 to 5.7. To confirm this agreement it is also
observed in the nonlinear transfer functions, where the linear fit is subtracted from the
data and plotted against a nonlinear fit. The nonlinear fit is represented by:
Chapter 5. Results 86
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-10D Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-11D Exit
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-10F Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-9F Exit
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-10D Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-9D Exit
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-10F Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-11F Exit
Figure 5.4: The transfer functions of the Enge field Runge-Kutta model. (Top four)
Horizontal phase space. (Bottom four) Vertical phase space. (Blue plot/Left axis)
Linear transfer function. (Red plot/Right axis) Nonlinear transfer function
87 Chapter 5. Results
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-9D Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-9D Exit
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-10F Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-10F Exit
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-9D Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-9D Exit
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-9F Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-9F Exit
Figure 5.5: The transfer functions of the Enge field Taylor map model. (Top four)
Horizontal phase space. (Bottom four) Vertical phase space. (Blue plot/Left axis)
Linear transfer function. (Red plot/Right axis) Nonlinear transfer function
Chapter 5. Results 88
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-7D Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-7D Exit
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-7F Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-7F Exit
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-7D Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-7D Exit
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-7F Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-7F Exit
Figure 5.6: The transfer functions of the numeric field Runge-Kutta model. (Top
four) Horizontal phase space. (Bottom four) Vertical phase space. (Blue plot/Left axis)
Linear transfer function. (Red plot/Right axis) Nonlinear transfer function
89 Chapter 5. Results
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-9D Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-9D Exit
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-10F Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
x (m)
10-10F Exit
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-9D Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-9D Exit
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-9F Entrance
-0.06 -0.04 -0.02 0 0.02 0.04
y (m)
10-9F Exit
Figure 5.7: The transfer functions of the numeric field Taylor map model. (Top
four) Horizontal phase space. (Bottom four) Vertical phase space. (Blue plot/Left axis)
Linear transfer function. (Red plot/Right axis) Nonlinear transfer function
Chapter 5. Results 90
Magnet model and integrator
and other properties p1 p2 p3 p4 p5 p6
E-RK-D-Entrance-Horizontal 3.951E-05 -1.111E-14 1.443E-06 1.960E-17 1.813E-03 -5.748E-21
E-RK-D-Entrance-Vertical -5.698E-05 1.231E-14 -2.371E-06 -3.524E-17 -1.813E-03 1.004E-22
E-RK-D-Exit-Horizontal 3.933E-05 -6.658E-15 -3.728E-07 3.579E-18 1.813E-03 -1.129E-21
E-RK-D-Exit-Vertical -5.717E-05 1.067E-14 -4.183E-06 -3.724E-17 -1.813E-03 7.028E-22
E-RK-F-Entrance-Horizontal -5.698E-05 5.869E-15 -2.371E-06 -1.623E-18 -1.813E-03 5.723E-21
E-RK-F-Entrance-Vertical 3.951E-05 -1.277E-14 1.443E-06 4.043E-17 1.813E-03 -1.732E-21
E-RK-F-Exit-Horizontal -5.717E-05 9.012E-15 -4.183E-06 -1.248E-17 -1.813E-03 3.112E-21
E-RK-F-Exit-Vertical 3.933E-05 -7.415E-15 -3.728E-07 2.790E-17 1.813E-03 4.493E-21
Table 5.1: The transfer function polynomial fit coefficients for the Enge field Runge-
Kutta.
Magnet model and integrator
and other properties p1 p2 p3 p4 p5 p6
E-TM-D-Entrance-Horizontal 6.958E-05 -7.010E-15 -5.391E-06 8.418E-18 1.801E-03 -4.392E-21
E-TM-D-Entrance-Vertical -1.576E-04 4.363E-15 -5.986E-06 -2.233E-18 -1.801E-03 4.819E-21
E-TM-D-Exit-Horizontal 6.930E-05 -7.244E-15 -9.620E-06 8.882E-18 1.801E-03 -3.539E-21
E-TM-D-Exit-Vertical -1.581E-04 1.092E-14 -1.256E-05 -1.535E-17 -1.801E-03 3.690E-21
E-TM-F-Entrance-Horizontal -1.287E-04 3.854E-15 3.226E-06 -3.760E-18 -1.801E-03 7.705E-21
E-TM-F-Entrance-Vertical 4.067E-05 -9.757E-15 2.632E-06 1.644E-17 1.801E-03 -3.137E-21
E-TM-F-Exit-Horizontal -1.290E-04 5.638E-15 -9.949E-07 -7.524E-18 -1.801E-03 3.790E-21
E-TM-F-Exit-Vertical 4.015E-05 -7.470E-15 -3.953E-06 1.421E-17 1.801E-03 -6.626E-21
Table 5.2: The transfer function polynomial fit coefficients for the Enge field Taylor
Magnet model and integrator
and other properties p1 p2 p3 p4 p5 p6
N-RK-D-Entrance-Horizontal -1.938E-01 -6.024E-15 -1.671E-07 1.000E-17 1.774E-03 -4.744E-21
N-RK-D-Entrance-Vertical 1.936E-01 5.906E-15 -8.668E-07 -2.026E-17 -1.774E-03 -4.392E-21
N-RK-D-Exit-Horizontal -1.942E-01 -3.815E-15 -1.938E-06 5.756E-19 1.774E-03 -3.564E-21
N-RK-D-Exit-Vertical 1.931E-01 1.354E-14 -2.635E-06 -4.421E-17 -1.774E-03 8.785E-22
N-RK-F-Entrance-Horizontal 1.936E-01 3.824E-15 -8.668E-07 -9.064E-19 -1.774E-03 3.639E-21
N-RK-F-Entrance-Vertical -1.938E-01 -1.259E-14 -1.671E-07 4.332E-17 1.774E-03 -3.263E-22
N-RK-F-Exit-Horizontal 1.931E-01 7.522E-15 -2.635E-06 -4.357E-18 -1.774E-03 1.682E-21
N-RK-F-Exit-Vertical -1.942E-01 -5.227E-15 -1.938E-06 1.725E-17 1.774E-03 3.664E-21
Table 5.3: The transfer function polynomial fit coefficients for the numeric field
Runge-Kutta.
Magnet model and integrator
and other properties p1 p2 p3 p4 p5 p6
N-TM-D-Entrance-Horizontal 6.930E-05 -7.244E-15 -9.620E-06 8.882E-18 1.801E-03 -3.539E-21
N-TM-D-Entrance-Vertical -1.581E-04 1.092E-14 -1.256E-05 -1.535E-17 -1.801E-03 3.690E-21
N-TM-D-Exit-Horizontal 6.930E-05 -7.244E-15 -9.620E-06 8.882E-18 1.801E-03 -3.539E-21
N-TM-D-Exit-Vertical -1.581E-04 1.092E-14 -1.256E-05 -1.535E-17 -1.801E-03 3.690E-21
N-TM-F-Entrance-Horizontal -1.290E-04 5.638E-15 -9.949E-07 -7.524E-18 -1.801E-03 3.790E-21
N-TM-F-Entrance-Vertical 4.015E-05 -7.470E-15 -3.953E-06 1.421E-17 1.801E-03 -6.626E-21
N-TM-F-Exit-Horizontal -1.290E-04 5.638E-15 -9.949E-07 -7.524E-18 -1.801E-03 3.790E-21
N-TM-F-Exit-Vertical 4.015E-05 -7.470E-15 -3.953E-06 1.421E-17 1.801E-03 -6.626E-21
Table 5.4: The transfer function polynomial fit coefficients for the numeric field Taylor
91 Chapter 5. Results
f = p1x5 + p2x4 + p3x3 + p4x2 . (5.2)
In the case of the Taylor maps, the linear term, corresponding to p5 in eq. (5.1), is in
agreement between numeric and Enge. However the Enge Runge-Kutta has a larger
magnitude whereas the numeric Runge-Kutta has a smaller magnitude. Broadly speaking
the focusing strength taken from p5 is similar across all cases. It also exhibits symmetry as
expected between focusing/defocusing, horizontal/vertical cases. The focusing horizontal
quadrupole fields result produce a negative change to the momentum and therefore and
a negative p5 as expected.
One noticeable feature of the results shown in table 5.3 is that the numeric field Runge-
Kutta has much larger quintic p1 coefficients than the other cases. The numeric field
Runge-Kutta also has a quintic coefficient that is opposite in sign to the other cases
when comparing for Entrance/Exit, Focusing/Defocusing, Horizontal/Vertical. It is
expected that the defocusing maps have gradients with a similar magnitude but opposite
sign. This is due to fact that the defocusing maps were created using the same method
as the focusing maps with one crucial difference. During the integration of the maps,
the particle used for focusing maps is a proton, but for the defocusing maps it is an
antiproton.
The entrance and exit results have quintic (5th) orders of similar magnitude across all
transfer function results. The cubic orders do not exhibit this behaviour in general; the
only one to keep this is the numeric Taylor map. Therefore it seems that the focusing
does not depend on the direction of integration of the fringe field.
The biggest coefficients are in the odd orders (linear, cubic, quintic) and the zeroth,
second, and fourth orders are comparatively much smaller. This could be explained by
the observation that a transfer function is expected to be an odd function and therefore
the odd polynomials should dominate. The lower order polynomial terms are useful for
fitting real data that is not perfectly aligned at the origin.
It should be noted that there are several features of the fit results that may require
further probing to explain their cause. For instance, although the quintic coefficients of
the numeric field and Enge field Taylor map cases are in good agreement, the magnitude
of the quintic coefficients of the Runge-Kutta cases are not in agreement with the Taylor
map cases or each other.
Additionally, in the Runge-Kutta cases there appears to be a symmetry in the fifth
(p1) and third (p3) order polynomial coefficients when interchanging the focusing type,
F  D, and interchanging the horizontal and vertical phase space, (x, px) (y, py).
Furthermore, the numeric Runge-Kutta is the only case for which the quintic orders
are of similar magnitude between the F-Entrance-Horizontal and F-Entrance-Vertical.
Chapter 5. Results 92
For all other cases the F-Entrance-Horizontal is greater than the F-Entrance-Vertical.
Finally, the numeric Taylor map is the only case for which the cubic coefficients have
a smaller magnitude for the F-Entrance-Horizontal than the F-Exit-Horizontal. The
reason for these discrepancies is unclear.
93 Chapter 5. Results
5.3 Chromaticity
The chromaticity of a lattice is a property that defines the change in tune depending
on the change in the energy deviation from the reference momentum of a test particle 1.
The change in tune  is due to the difference in focusing strength for particles with
differences in energy deviation with respect to the reference momentum. The result is
that particles of different energies are focused by differing amounts as they traverse a
quadrupole field. Chromaticity is so called because this effect is analogous to visible light
being split into different frequencies of light by a prism.
The chromaticity can be measured by taking into account either the change in horizontal
or vertical tune of the particles to produce what is referred to here as the horizontal
chromaticity or vertical chromaticity.
The chromaticity investigation was conducted using the four fringe field models, numeric
(N) or Enge (E) field using either a Taylor map (TM) or Runge-Kutta (RK) integration.
In addition to these four fringe field models (abbreviated as NTM, ETM, NRK, ERK) is
the nominal case which has no fringe fields.
The fringe fields are added to the entrance and exit of each of the inner triplet quadrupoles
around the interaction points IP1 and IP5 in the HL-LHC lattice. Every fringe field model
inserted into the lattice is accompanied by a transfer map representing the inverse of the
linear part of the fringe field. This is done to remove additional focusing contributions
from the quadrupole fringe field. The fringe field is also accompanied by drift spaces
which are needed to position the fringe field at the end of the hard edge model. More
information about the method of adding fringe fields to the lattice can be seen in
section 4.2.2.
The addition of fringe fields modifies the chromaticity of the lattice. This change in
chromaticity is still seen even if the fringe field is accompanied by a retuning element.
Therefore, it is necessary to correct the chromaticity. The details of the chromaticity
restoration technique used for these results are described in section 4.2.3. In short, a
root finding algorithm was chosen to minimise the difference between the horizontal
chromaticity of a modified HL-LHC lattice, (with or without fringe fields) calculated by
SAMM, and the horizontal chromaticity of the HL-LHC v1.0 as calculated by MAD-X.
The difference in the chromaticities was used to scale the field strength of each sextupole
in the lattice.
To produce the results shown below, the tune, , was calculated numerically by tracking
particles over 1024 turns and then computing the tune using a NAFF algorithm (see
section 4.3.2). The number of turns was chosen based on how other studies calculate the
1Remember that the energy deviation  is a property that is related to the reference momentum of
the particle, and is more convenient to work with than the longitudinal momentum itself. See 3.2.4 for
more details.
Chapter 5. Results 94
Magnet model and integrator p1 p2 p3 R2 Difference from MAD Percent
Chromaticity from MAD - 2.038E+00 - - 0.000E+00 0.00
No fringe case 2.131E+03 1.993E+00 3.095E-01 1.000E+00 -4.581E-02 -2.30
Numeric Taylor map 2.512E+03 1.987E+00 3.096E-01 1.000E+00 -5.158E-02 -2.60
Numeric Runge-Kutta 2.359E+03 2.141E+00 3.089E-01 1.000E+00 1.026E-01 4.79
Enge Taylor map 2.572E+03 2.096E+00 3.100E-01 1.000E+00 5.777E-02 2.76
Enge Runge-Kutta 2.525E+03 2.087E+00 3.095E-01 1.000E+00 4.831E-02 2.32
Table 5.5: Table of fit coefficients for the horizontal chromaticity results. The MAD
chromaticity result is included to provide a comparison.
tune for frequency map analysis. In frequency map analysis the tune is calculated for
two equally sized partitions of turns. For example in other literature, turn numbers of
the order of 1000 turns are used [23]. It is therefore expected that 1024 turns will be
sufficient for a precise tune calculation. Figure 5.8a shows the horizontal chromaticity of
the four fringe field models: numeric field Taylor map, Enge field Taylor map, numeric
field Runge-Kutta, Enge field Runge-Kutta, as well as the no fringe case. Figure 5.8b
shows similar plots but for the vertical chromaticity.
The numeric field Runge-Kutta and Enge field Taylor map cases exhibit the largest tune
shifts at zero. In both the horizontal and vertical cases two of the results are in closer
agreement with the no fringe model: these are the numeric field Taylor map (NTM)
and the Enge field Runge-Kutta (ERK). The other two fringe field models, the numeric
field Runge-Kutta (NRK) and the Enge field Taylor map (ETM), have bigger tune shifts
at  = 0 compared to the no fringe model. The tune shift therefore is not correlated
based on the choice of integration method, Runge-Kutta or Taylor map, or the choice
of fringe field model, numeric field or Enge field. This supports the idea that the tune
shift is introduced independent to the field model or integrator. How this tune shift is
introduced requires further investigation.
The table of fit coefficients can be seen in tables 5.5 and 5.6. The pi coefficients correspond
with the coefficients of the quadratic fit (eq. (5.3)), and R2 is the R-squared statistic.
The R-squared returned is used as an indicator of goodness of fit. A value of R-squared
closer to one might suggest that the fit is a good predictor the data that it has been fit
against. R-squared was calculated using Matlabs fit function [47].
As can be seen from the the R2 values in table 5.5 the horizontal chromaticity results
are approximated very well by the quadratic polynomial fit.
To recap, the first order chromaticity, Q, is defined as the change in tune for a change
in energy deviation at an energy deviation of zero. This is the gradient at  = 0 of the
plots in figs. 5.8a and 5.8b. The gradients can be found numerically using the following
quadratic fit:
f = p1x2 + p2x+ p3 . (5.3)
95 Chapter 5. Results
-1 -0.5 0 0.5 1
Energy deviation, 10-3
0.308
0.309
0.311
0.312
0.313
0.314
0.315
No fringe case
Enge ImplicitRK
Enge TaylorMaps
NumField ImplicitRK
NumField TaylorMaps
-1 -0.5 0 0.5 1
Energy deviation, 10-3
0.319
0.321
0.322
0.323
0.324
0.325
No fringe case
Enge ImplicitRK
Enge TaylorMaps
NumField ImplicitRK
NumField TaylorMaps
Figure 5.8: The tune of a particle with respect to its deviation from the reference
energy (chromaticity), for different fringe field models, in the: (a) horizontal and (b)
vertical phase space. The different fringe field models are for the Taylor maps/implicit
Runge-Kutta integrators using the analytic/numeric fields, as well as the case of no
fringe field.
Chapter 5. Results 96
Magnet model and integrator p1 p2 p3 p4 p5 R2 Difference Percent
Chromaticity from MAD - - - 2.004E+00 - - 0.000E+00 0.00
No fringe case 1.831E+07 -5.007E+05 1.406E+03 2.122E+00 3.206E-01 1.000E+00 1.180E-01 5.56
Numeric Taylor map 3.742E+07 -6.071E+05 1.692E+03 1.956E+00 3.205E-01 1.000E+00 -4.738E-02 -2.42
Numeric Runge-Kutta 3.694E+07 -6.129E+05 1.752E+03 1.285E+00 3.201E-01 1.000E+00 -7.186E-01 -55.92
Enge Taylor map 3.732E+07 -6.086E+05 1.693E+03 2.213E+00 3.216E-01 1.000E+00 2.098E-01 9.48
Enge Runge-Kutta 3.645E+07 -6.069E+05 1.712E+03 1.749E+00 3.207E-01 1.000E+00 -2.549E-01 -14.58
Table 5.6: Table of fit coefficients for the vertical chromaticity results determined by
SAMM for different lattice configurations. The chromaticity result calculated using
MAD is included to provide a comparison.
As with the horizontal chromaticity, the same method was applied for the vertical phase
space. The vertical chromaticity, Qy, is therefore the change in vertical tune, y, for a
given change in energy deviation, .
The results of the fits applied in the vertical case are shown in table 5.6. There is
one key difference between the horizontal and vertical cases in terms of calculating
the chromaticities. It was found that for the vertical case a quadratic polynomial was
underfitting the data. The next step was to increase the polynomial to the next even
order of fourth. The fourth order polynomial was observed to be a better approximation
of the results. The R2 values from the vertical chromaticity fit show that the fourth
order fit does indeed approximate the tracking result data well. The equation of fit for
the vertical chromaticity as follows:
f = p1x4 + p2x3 + p3x2 + p4x+ p5 . (5.4)
The HL-LHC lattice model used in this study was the HLLHCV1.0 lattice. The
chromaticity values calculated by MAD-X for this lattice are Qx = 2.038324162 and
Qy = 2.003656081. The horizontal p2 values from the fit show that the chromatic restor-
ation technique by retuning sextupoles has brought the chromaticity values to within 5%
of the MAD chromaticity values. In fact most of the horizontal chromaticity values are
within 3% of the MAD value. The numeric field Runge-Kutta has the largest difference to
MAD (at 5%). It is not clear why the numeric field Runge-Kutta has a larger discrepancy
in the horizontal chromaticity compared to the other fields and integrator models. The
discrepancies in the horizontal chromaticity show that the method of sextupole retuning
is limited.
Table 5.7 shows the retuning values for each of the fringe field models. The first MS
lattice sextupole in the lattice was chosen and its sextupole field component was compared
between the HL-LHC lattice that had not undergone the chromaticity restoration proced-
ure, against the lattice with different fringe field models that had chromaticity restoration
applied. The chromaticity calculated for the no fringe field case was in good agreement
between the MAD and SAMM values. It can be expected that the chromaticity values
will not be the same because both codes model the magnetic elements, and chromaticity
finding algorithms using independent implementations. Therefore as can be expected
97 Chapter 5. Results
Magnet model and integrator Retuning factor
Sextupole field coefficient
of MS.11R3.B1 (Tm2)
No fringe case (no correction) 1.0000 631.655
No fringe case 1.0003 631.827
Numeric Taylor map 1.0831 684.127
Numeric Runge-Kutta 1.0849 685.275
Enge Taylor map 1.0855 685.688
Enge Runge-Kutta 1.0863 686.151
Table 5.7: The retuning factor values for each fringe field case.
the change in sextupole strength, needed to restore the chromaticity, is small. The other
fringe field cases have an average retuning factor of 1.0849 with a standard deviation
of 0.0014. There is no major discrepancy in the chromaticity retuning values when the
fringe fields, using any model, are inserted into the HL-LHC.
The vertical p4 values from the fit show that the chromaticity restoration is significantly
less effective at bringing the vertical chromaticity towards the MAD value. Only one
model, the numeric field Runge-Kutta, is within 5% of the MAD value, most of the
cases are within 15% of the MAD value. Meanwhile the numeric field Runge-Kutta has
a 55.9% difference to the MAD value. As the chromatic restoration algorithm is only
concerned with bringing the horizontal chromaticity closer to the MAD value, it could
be expected that the vertical cases would exhibit larger differences compared with the
horizontal cases.
Because the chromatic restoration works by minimizing the difference in horizontal chro-
maticity, possibly a better chromatic restoration scheme would minimise the differences of
the calculated horizontal and vertical chromaticities with the MAD values in quadrature.
This method would no longer be a root finding method and would have the disadvantages
of minimisation algorithms. For example, the minimisation algorithm might find local
minima instead of global minima, and the algorithm could take a longer amount of
calculation time to find its solution due to having a bigger problem space.
Two or more sextupole families are required to correct both the calculated horizontal and
vertical chromaticities [3]. The current restoration takes advantage of the families already
in the HL-LHC. There are 4 families of the MS lattice sextupoles [1]. The MS sextupoles
are used to correct chromaticity changes introduced from the inner triplet magnets [1].
In the chromaticity correction used in this study, for simplicity the sextupole strength of
every sextupole, no matter the family, is modified by the same magnitude.
The LHC design report [1] recommends that the change in chromaticity during collision
must be within 1 unit, i.e. |Q| < 1. It should be noted that the results in this study
were within 1 unit, and the largest difference of 0.7186 was for the vertical chromaticity
in the numeric field Runge-Kutta case.
Chapter 5. Results 98
5.4 Tune shift with amplitude
As discussed in the theory section (section 3.1.7) quadrupole fringe fields introduce
nonlinear effects on beams transported through the field. One notable nonlinear effect
is the change in betatron oscillation depending on the transverse offset from the closed
orbit. This effect is also known as tune shift with amplitude [48, Lecture 7].
The tune shift with amplitude investigation was done for the four fringe field models,
numeric or Enge field using a Taylor map or Runge-Kutta integration. These four fringe
field models are compared to the nominal case which has no fringe fields.
The fringe field were added to the lattice using the same method as for the chromaticity
results (see section 5.3). To recap, fringe fields are added to entrance and exit of each of
the inner triplet quadrupoles around the interaction points IP1 and IP5 in the HL-LHC
lattice. The fringe fields are accompanied by a linear inverse map component to remove
linear dynamic effects as well as drift spaces for positioning (see section 4.2.2).
There was a chromatic restoration applied to each lattice to bring the chromaticity
closer to the value calculated by MAD. This chromatic restoration method was also
implemented in the same way for the chromaticity results.
The tune, , is calculated numerically by tracking particles over 1000 turns and then
computing the tune using a NAFF algorithm. The total number of turns was chosen, as
for the argument given in the chromaticity results, because other studies use a similar
number of turns using NAFF to calculate the tune.
Figure 5.9a shows the results for the four field models plus no fringe case for horizontal
offsets from the closed orbit. It is evident that there is good agreement between the
cases, apart from the numeric field Runge-Kutta which needs further investigation. The
sharply changing notches on the tune line (seen on the left of the graph) are where the
particles cross a resonance in tune space. This effect is more clearly visualised in the
latter Frequency Map Analysis section, where the tune space plots show the distortion of
the particle spread near resonant tune lines.
The numeric field Runge-Kutta has an opposite tune shift with amplitude compared
to the other cases. This could be a result of the transfer function for the numeric field
Runge-Kutta having an opposite sign for the fifth order polynomials contrary to the
other cases. If the nonlinearity for the numeric field Runge-Kutta is opposite to that of
the other cases, it is possible that this would translate into an opposite tune shift with
amplitude. Another possibility is that the chromatic restoration method is producing
different outcomes for the numeric field Runge-Kutta.
The numeric field Runge-Kutta and Enge field Taylor map have the largest tune shifts at
zero.
99 Chapter 5. Results
-20 -15 -10 -5 0 5 10 15 20
Initial x coordinate offset, sqrt(2J
0.285
0.295
0.305
0.315
No fringe case
Enge ImplicitRK
Enge TaylorMaps
NumField ImplicitRK
NumField TaylorMaps
-20 -15 -10 -5 0 5 10 15 20
Initial y coordinate offset, sqrt(2J
0.314
0.316
0.318
0.322
0.324
0.326
0.328
No fringe case
Enge ImplicitRK
Enge TaylorMaps
NumField ImplicitRK
NumField TaylorMaps
Figure 5.9: The tune of a particle with respect to its deviation from the closed orbit,
for different fringe field models, in the: (top) horizontal and (bottom) vertical phase
space. The different fringe field models are for the Taylor maps/implicit Runge-Kutta
integrators using the analytic/numeric fields, as well as the case of no fringe field.
Chapter 5. Results 100
Field model and integrator p1 p2 p3 p4 p5 R2 Difference Percent
Tune from MAD - - - - 3.100E-01 - 0.000E+00 0.00
No fringe case -3.120E-09 9.470E-08 1.310E-05 -5.130E-06 3.094E-01 9.975E-01 -5.890E-04 -0.19
NumField TaylorMaps -1.680E-10 8.760E-08 1.380E-05 -1.230E-06 3.096E-01 9.630E-01 -3.854E-04 -0.12
NumField ImplicitRK -1.070E-07 7.080E-07 -1.030E-05 -5.950E-05 3.089E-01 9.981E-01 -1.120E-03 -0.36
Enge TaylorMaps -2.130E-08 3.670E-08 2.490E-05 1.190E-05 3.100E-01 8.829E-01 -7.961E-06 0.00
Enge ImplicitRK -4.340E-09 8.760E-08 1.430E-05 -3.110E-06 3.095E-01 9.189E-01 -5.228E-04 -0.17
Table 5.8: Table of fit coefficients for the horizontal tune shift with amplitude results.
The MAD tune result is included to provide a comparison.
Field model and integrator p1 p2 p3 p4 p5 R2 Difference Percent
Tune from MAD - - - - 3.200E-01 - 0.000E+00 0.00
No fringe case 4.340E-08 -2.360E-07 4.190E-06 2.040E-05 3.206E-01 9.847E-01 5.422E-04 0.17
NumField TaylorMaps 4.890E-08 -2.430E-07 3.210E-06 1.990E-05 3.206E-01 9.902E-01 5.418E-04 0.17
NumField ImplicitRK -1.330E-09 -6.380E-08 -1.480E-05 -5.140E-06 3.202E-01 9.906E-01 2.283E-04 0.07
Enge TaylorMaps 7.070E-08 -6.810E-07 1.580E-05 3.030E-05 3.216E-01 9.897E-01 1.547E-03 0.48
Enge ImplicitRK 4.870E-08 -3.390E-07 5.740E-06 2.730E-05 3.207E-01 9.807E-01 7.126E-04 0.22
Table 5.9: Table of fit coefficients for the vertical tune shift with amplitude results.
The MAD tune result is included to provide a comparison.
The tune shift with amplitude for the Enge field with the octupole (m = 4) field results
in points of inflection compared to the field without the m = 4 term.
The tuneshift with amplitude can be described the following simple model:
(J) = 0 + 1  J + 2  J2 + 3  J3 . . . , (5.5)
where  is the tune, J is the action of a particle (related to its amplitude), and n=0,1,2,3,...
are the coefficients on the tune of the different orders of action. This simple model has
the form of a polynomial. The coefficient terms n=0,1,2,3,... are related to the quadrupole
term, octupole term and so on.
As the simplified model dictates, the octupole has a significant effect through 1. It is
also likely that the higher order terms (m = 8 and m = 10) would also have an effect
and could possibly bring the Enge field Runge-Kutta back into agreement.
The tune shift results can be fitted and this data can be seen in tables 5.8 and 5.9.
101 Chapter 5. Results
5.5 Frequency map analysis
Frequency map analysis, as previously discussed in the section 4.3.5, is a method to
identify potentially unstable regions of the beam in both frequency space (also known as
tune space) or amplitude space. To recap, one particular advantage of this technique is
that the beam is simulated for a comparatively smaller amount of time as compared to
survival studies involving orders of magnitude more beam time [24]. Survival studies
require upwards of 1 106 turns [49]. In this study the frequency map analysis is
calculated over 2000 turns for 10000 (1002) particles per model.
One key difference between each model used in the frequency map analysis, is that the
initial coordinate offset from the closed orbit is dependent on the particles emittance,
, because of
(2Jx,y/). The emittance is calculated independently for each model.
Furthermore the closed orbit is also calculated independently. Therefore for a given offset
(a multiple of beam size), the initial coordinates of the particles is model dependent,
because the beam size is also model dependent.
Frequency map analysis uses the Numerical Analysis of Fundamental Frequencies al-
gorithm (NAFF) to calculate the tune of each particle. The tracking data is partitioned
into two, and the tune of both halves is calculated. The tune diffusion rate is a quantity
that characterises the change of the tunes. The tune diffusion is calculated using [25]:
D = [T1,T2]  [T2,T3] , (4.25 revisited)
where [T1,T2] is a two-dimensional vector of the horizontal and vertical tunes calculated
by NAFF between turn number T1 and T2. Particles that are more stable are thought to
have a smaller tune diffusion [25].
The set of frequency maps, in amplitude and tune space, for the four different fringe
field models as well as the case of no fringe field model is shown in figs. 5.10 to 5.19.
Particles have an initial position in a grid spaced across x and y up to a multiple of
twenty beam sizes away from the closed orbit. As with the tune shift with amplitude
results (section 5.4), the notation used here is
(2Jx,y/) for either the horizontal x or
vertical y offset.
The theory behind the tune shift with amplitude and resonances, which are fundamental
components of frequency map analysis, was described previously in section 3.2.12. To
restate, lattices can be designed in such a way that the working point of the lattice
(the tune for a particle on the closed orbit) is chosen to be far away from problematic
resonances. This is because particles that have a tune close to a resonance can become
unstable, and thus the particle can be lost.
Chapter 5. Results 102
Model Energy deviation Amplitude estimateat 0
Amplitude estimate
at 90
None Neg 17.8 18.2
None Zero 16.6 18.0
None Pos 15.4 17.6
Enge RK Neg 17.0 17.2
Enge RK Zero 16.4 17.8
Enge RK Pos 14.6 17.0
Enge TM Neg 16.2 15.6
Enge TM Zero 15.0 15.8
Enge TM Pos 13.7 15.4
Simulated RK Neg 20.0 20.0
Simulated RK Zero 20.0 18.6
Simulated RK Pos 19.6 20.0
Simulated TM Neg 17.4 18.2
Simulated TM Zero 16.4 18.2
Simulated TM Pos 15.0 17.8
Table 5.10: An estimate of the dynamic aperture for each of the frequency map
analysis results, of a given model and energy deviation. The estimate is of the greatest
amplitude for which particles on the x-axis or y-axis.
Despite the choice of a working point far away from resonances, the tune shift with
amplitude can result in particles having a tune close to resonances. Frequency map
analysis offers a way to estimate the strength of a resonance by observing how the smooth
grid of particles is disrupted by a resonance. Frequency map analysis also allows the tune
shift with amplitude to be visualised in a two dimensional tune space. By comparing
tune space plots between different results one can see how the tune shift with amplitude
differs by looking at the differences in shape and size of the spread of particles.
Looking at the tune space plots it can be seen that the working point is in good agreement
across the results. The shape and size of the particle distribution in phase space for
the numeric field Runge-Kutta case indicates that it has an tune shift with amplitude
of opposite sign to the other results. This is in agreement with what was seen for the
numeric field Runge-Kutta result from the tune shift with amplitude results (section 5.4)
as expected.
Table 5.10 shows an estimate of the amplitudes of the particles, furthest from the closed
orbit, that have survived for each of the frequency map results. The estimates are given
for each of the fringe field models, and for each of the initial energy deviations. These
results were taken by visually selecting points with the largest deviations from the closed
orbit for y = 0 and for x = 0. Points were also selected based on their continuity with
the rest of the data. For example, the no fringe field case with positive energy deviation
has a singular point on the y-axis separated from the main body of data. In this case
the plotting software gave the coordinates of extreme points to two decimal points, but
the results were rounded to one decimal point as the method is only an estimate.
103 Chapter 5. Results
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
) No fringe - Negative energy
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
) No fringe - On energy
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
) No fringe - Positive energy
Figure 5.10: Frequency maps in amplitude space for the lattice without a fringe field.
The tune diffusion rate is shown in relationship to particles different amplitudes from the
closed orbit. The particles have different energy deviations from the reference energy;
(a) negative energy deviation, (b) on reference energy, and (c) positive energy deviation.
Chapter 5. Results 104
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
No fringe - Negative energy
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
No fringe - On energy
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
No fringe - Positive energy
Figure 5.11: Frequency maps in tune space for the lattice without a fringe field model.
The tune diffusion rate is shown in relationship to particles different amplitudes from the
closed orbit. The particles have different energy deviations from the reference energy;
(a) negative energy deviation, (b) on reference energy, and (c) positive energy deviation.
105 Chapter 5. Results
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
)Analytic Runge-Kutta - Negative energy
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
) Analytic Runge-Kutta - On energy
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
) Analytic Runge-Kutta - Positive energy
Figure 5.12: Frequency maps in amplitude space for the lattice with the analytic
Runge-Kutta fringe field model. The tune diffusion rate is shown in relationship to
particles different amplitudes from the closed orbit. The particles have different energy
deviations from the reference energy; (a) negative energy deviation, (b) on reference
energy, and (c) positive energy deviation.
Chapter 5. Results 106
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
Analytic Runge-Kutta - Negative energy
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
Analytic Runge-Kutta - On energy
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
Analytic Runge-Kutta - Positive energy
Figure 5.13: Frequency maps in tune space for the lattice with the analytic Runge-
Kutta fringe field model. The tune diffusion rate is shown in relationship to particles
different amplitudes from the closed orbit. The particles have different energy deviations
from the reference energy; (a) negative energy deviation, (b) on reference energy, and
(c) positive energy deviation.
107 Chapter 5. Results
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
) Analytic Taylor map - Negative energy
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
) Analytic Taylor map - On energy
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
) Analytic Taylor map - Positive energy
Figure 5.14: Frequency maps in amplitude space for the lattice with the analytic
Taylor map fringe field model. The tune diffusion rate is shown in relationship to
particles different amplitudes from the closed orbit. The particles have different energy
deviations from the reference energy; (a) negative energy deviation, (b) on reference
energy, and (c) positive energy deviation.
Chapter 5. Results 108
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
Analytic Taylor map - Negative energy
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
Analytic Taylor map - On energy
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
Analytic Taylor map - Positive energy
Figure 5.15: Frequency maps in tune space for the lattice with the analytic Taylor
map fringe field model. The tune diffusion rate is shown in relationship to particles
different amplitudes from the closed orbit. The particles have different energy deviations
from the reference energy; (a) negative energy deviation, (b) on reference energy, and
(c) positive energy deviation.
109 Chapter 5. Results
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
)Simulated Runge-Kutta - Negative energy
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
) Simulated Runge-Kutta - On energy
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
)Simulated Runge-Kutta - Positive energy
Figure 5.16: Frequency maps in amplitude space for the lattice with the simulated
Runge-Kutta fringe field model. The tune diffusion rate is shown in relationship to
particles different amplitudes from the closed orbit. The particles have different energy
deviations from the reference energy; (a) negative energy deviation, (b) on reference
energy, and (c) positive energy deviation.
Chapter 5. Results 110
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
Simulated Runge-Kutta - Negative energy
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
Simulated Runge-Kutta - On energy
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
Simulated Runge-Kutta - Positive energy
Figure 5.17: Frequency maps in tune space for the lattice with the simulated Runge-
Kutta fringe field model. The tune diffusion rate is shown in relationship to particles
different amplitudes from the closed orbit. The particles have different energy deviations
from the reference energy; (a) negative energy deviation, (b) on reference energy, and
(c) positive energy deviation.
111 Chapter 5. Results
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
)Simulated Taylor map - Negative energy
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
) Simulated Taylor map - On energy
0 5 10 15 20
Initial x coordinate offset, sqrt(2J
)Simulated Taylor map - Positive energy
Figure 5.18: Frequency maps in amplitude space for the lattice with the simulated
Taylor map fringe field model. The tune diffusion rate is shown in relationship to
particles different amplitudes from the closed orbit. The particles have different energy
deviations from the reference energy; (a) negative energy deviation, (b) on reference
energy, and (c) positive energy deviation.
Chapter 5. Results 112
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
Simulated Taylor map - Negative energy
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
Simulated Taylor map - On energy
0.3 0.32 0.34 0.36
Fractional horizontal tune, 
Simulated Taylor map - Positive energy
Figure 5.19: Frequency maps in tune space for the lattice with the simulated Taylor
map fringe field model. The tune diffusion rate is shown in relationship to particles
different amplitudes from the closed orbit. The particles have different energy deviations
from the reference energy; (a) negative energy deviation, (b) on reference energy, and
(c) positive energy deviation.
113 Chapter 5. Results
The characterisation of the estimate could be improved by using an algorithmic technique
to find the contiguous limits of the phase space maps. A naive method for finding these
results could be to test for contiguous points along y = 0, x = 0 lines and reporting the
largest result. Such a method could be extended to look for contiguous points along a
diagonal such as x = y. This method may be vulnerable to missing runs of particles
along a line, and ignoring latter points that are in fact contiguous when considering the
two-dimensional shape. A more advanced method may be to fit a boundary along the
extremity of the continuous data. Any method that would try to determine the boundary
would have to be robust to the sporadicly populated border region (seen in the upper
right of Enge field Runge-Kutta plots fig. 5.12), as well as other features like islands
(seen in numeric field Runge-Kutta plots fig. 5.16).
Instead of estimating the border between lost particles (those unbounded particles that
travel outside some limit) and tracked particles, it might be of more use to find the
dynamic aperture border. The dynamic aperture is the region of the beam in phase
space for which particles are expected to have stable motion; particles outside this region
might become lost due to chaotic motion [23]. More can be read about dynamic aperture
(DA) in section 3.2.13.
There is an appearance of "fingers" of higher tune diffusion in the phase space plots.
These fingers correspond with the particles that cross a resonance line as can be seen
in the tune space plots. Some points get pulled on to the main linear resonance. This
is also seen in other works, such as Laskar [24]. This means that the HL-LHC working
point is in the neighbourhood of problematic resonances. As shown by the variety of
different shapes and sizes of the particle distributions in tune space across the results, it
is important to understand and control the contributions to tune shift with amplitude.
This is because resonances experienced by particles is largely dictated by the tune shift
with amplitude.
From the plots and from the estimates in table 5.10 it appears that there is the greatest
dynamic aperture at a negative energy deviation. It gets smaller for zero energy deviation
and then smaller again for positive energy deviation.
The plots and the estimates in table 5.10 also show that the particles appear to have
a bigger limit of stability in the y-direction than the x-direction. That is to say that
generally the edge of the limit is greater for X  Y angle at 90 (y-axis) compared to 0.
The HL-LHC preliminary design report found that the dynamic aperture was greater for
X  Y angles at 0 and that it reduced with greater angle [2, Figure 2.5]. It should be
noted that the preliminary design report result was found by plotting both the minimum
and average dynamic apertures over X  Y angle. It is possible that a similar result to
the design report could be found if another set of magnetic field errors were applied to
the lattice. It is also a possibility that the dynamic aperture does not correlate well with
the limit of the amplitude space plots.
Chapter 6
Conclusions
6.1 Summary and conclusions
The main aim of this work was to identify if the fringe fields from the new inner
triplet magnets would have a detrimental effect on the stability of the HL-LHC beam.
Additional objectives were: to compare the Runge-Kutta and Wu-Forest-Robin Taylor
map integration models against each other, to see in what circumstances the Enge field
could be used in place of a numeric field and how they otherwise compare, and to perform
a full frequency analysis in a timely manner on a single desktop computer by leveraging
GPU computing.
In this study a comparison of four fringe field implementations using a choice of integration
schemes (Wu-Forest-Robin truncated Taylor map or Runge-Kutta integrator), and a
choice of fringe field models (numeric or Enge field) was conducted.
The magnetic field descriptions between the Enge field and the simulated numeric field
agree closely, as can be seen in the plots of magnetic field (fig. 4.2), and in the plots of
the generalised gradients generated from the field (figs. 5.1 to 5.3). This was expected
following the results of the inner triplet magnet shown by Muratori et al. [5].
The generalised gradients start to differ due to high oscillatory behaviour for higher
orders of l. This is likely due to the effect of repeated differentiation, as this is what each
higher order of l represents [46]. The BlitzDA differential algebra code is only capable
of generating generalised gradients with m < 9 and l < 9; if a higher order multipole
or derivative term would impact the tracking results, then it would not be seen in this
experimental setup.
The tune shift with amplitude has different results between the 5 fringe field models
(including the no fringe model). Two of the models agree closely with the no fringe
model: the numeric field Taylor map and the Enge field Runge-Kutta. The other two:
Chapter 6. Conclusions 116
the numeric field Runge-Kutta and the Enge field Taylor map, diverge from the no
fringe model. Whether a model agrees or diverges from the no fringe model does not
correlate with either the field type (Enge or simulated numeric) or the integrator type
(Runge-Kutta or Taylor map), but rather it suggests that there is an independent factor
driving the tune shift with amplitude. Looking at the plots (fig. 5.9), it might be the
case that the tune shift with amplitude is driven by the tune approaching zero amplitude
deviation from the closed orbit.
From the chromaticity plots (fig. 5.8), it is clear that the chromaticity retuning has
successfully brought the chromaticities into agreement with the no fringe field case.
The stability of the frequency map analysis appears to be most influenced by the tune
shift with amplitude of the underlying model. It appears that the fringe field models
can have a large impact on the stability of the beam; but as the results suggest, if the
frequency map analysis is influenced by tune shift with amplitude (which could itself
be influenced by an unknown independent variable) then more work needs to be done
before a definitive conclusion can be made about the impact of the inner triplet fringe
fields on beam stability in the HL-LHC.
The production of the results show that frequency map analysis can be performed on
desktop computer hardware in a reasonable time with the assistance of GPU computation.
The SAMM code is capable of being extended with new capabilities to track over
interesting field models with bespoke integration routines. SAMM is also capable of being
extended to perform additional processes such as chromaticity retuning. Additionally
the BlitzDA code is capable of producing generalised gradients for the HL-LHC inner
triplet quadrupole field.
6.2 Recommendations for further work
Further investigations to assess the difference in tune shift with amplitude between the
four fringe field models are recommended. Whilst the Enge field Taylor map model
has the largest reduction in the stable region of the beam (compared to the no fringe
case), the simulated numeric field Runge-Kutta model has a marked increase in stability
(compared to the no fringe case). Both of these models are the two that diverge the most,
in terms of their tune shift with amplitude, from the others. It is likely that it is this
difference in tune shift with amplitude that is driving the difference observed in stability.
Because the tune shift with amplitude is independent of the underlying magnetic field
model or integration routine - there is likely an independent factor which is governing the
tune shift with amplitude and therefore likely having the biggest impact on differences
in stability in the frequency maps between models.
117 Chapter 6. Conclusions
The chromaticity retuning scheme could also be improved. Currently all the strengths of
the sextupoles around the lattice are modified by the same factor to reach the chromaticity
desired. The sextupoles in the HL-LHC are divided into families [1] and it is possible
that the chromaticity could be brought more closely into line by tuning each of these
families independently.
The generalised gradient description of the fields could be extended beyond the limits of
multipole order m < 9 and l-order l < 9 that restrained this study. Higher orders would
provide a more accurate description of the underlying field and could suggest if high
order features in the magnetic field have an impact on the tracking results.
The Fourier transform used in the production of the generalised gradients could be
replaced with a spline Fourier transform. A spline Fourier transform could offer a more
accurate transform than the Fourier transform used when generating the generalised
gradients [31].
The HL-LHC lattice has since been updated to a version known as HL-LHCv1.4 [50].
There have been incremental updates (v1.1, v1.2, v1.3) from the version used in this
study HL-LHCv1.0 to v1.4 [28, 51, 52]. To best model what the effect of the fringe-fields
would mean repeating this study on the latest lattice optics.
The simulated fringe field maps [35] could also be improved. The simulations could
be performed to a higher resolution. The model of the magnet used to produce the
simulation may have been refined since the production of the simulated data used in this
study. Lastly the simulated data was restricted to one quadrant; this may have been
desirable to reduce the simulation complexity. Although the one quadrant simulated
data has to be reflected and transformed appropriately to generate a complete field, this
has the effect of repeating noise with a 4-fold symmetry. This could mean that in the
generalised gradient description which relies on multipoles, that noise would feature more
prominently in lower multipoles. As the whole goal of using generalised gradients is to
have a field description that is highly accurate, this repeated noise could be a feature that
is reducing the accuracy. Therefore simulated fringe field data spanning four quadrants
may offer more accurate results.
The fringe fields have been positioned at each end of the hard-edge model. When
comparing a hard edge model with the true field, the hard-edge model would extend past
where the true field starts to taper. This means that in order for the fringe fields to be
positioned accurately, they should be placed in line with where the real field would taper.
This position could be calculated by using an accurate integration of the quadrupole
field strength of the fringe field, and then using that strength to place the fringe field
more accurately using drifts.
Chapter 6. Conclusions 118
6.3 Closing remarks
This work has shown that the inner triplet quadrupole fringe field models could potentially
have a detrimental impact on the stability of the HL-LHC beam as evidenced by the
reduction in the extent of the surviving particles in the Enge field Taylor map case
compared with the no fringe case.
This study does not allow a definitive conclusion to be drawn on whether the fringe
fields would have a detrimental impact on the stability of the beam. This is due to the
fact that the four fringe field models differ largely in their tune shift with amplitude
independent of the magnetic field model or integration routine.
Therefore further work is recommended to determine the cause of the different tune shift
results between the different fringe field models.
List of Publications
1. S. Jones, D. Newton, and A. Wolski. Initial Estimate of Fringe Field Effects in HL-
LHC Using Frequency Map Analysis. International Particle Accelerator Conference
(IPAC14), Dresden, Germany, June 2014. JACOW, Geneva, Switzerland 2014.
http://jacow.org/IPAC2014/papers/tupro025.pdf
2. A. T. Herrod, S. Jones, A. Wolski et al. Modelling of Curvilinear Electrostatic
Multipoles in the Fermilab Muon g-2 Storage Ring. International Particle Acceler-
ator Conference (IPAC17), Copenhagen, Denmark, May 2017. JACOW, Geneva,
Switzerland 2017.
http://accelconf.web.cern.ch/AccelConf/ipac2017/papers/thpab055.pdf
http://jacow.org/IPAC2014/papers/tupro025.pdf
http://accelconf.web.cern.ch/AccelConf/ipac2017/papers/thpab055.pdf
Bibliography
[1] L. Evans and P. Bryant. LHC Machine. In: Journal of Instrumentation 3.8
(2008), S08001. issn: 17480221. doi: 10.1088/1748-0221/3/08/S08001. url:
http://stacks.iop.org/1748-0221/3/i=08/a=S08001.
[2] The HiLumi LHC Collaboration. HL-LHC Preliminary Design Report. Tech. rep.
CERN, 2014. url: http://hilumilhc.web.cern.ch.
[3] H. Wiedemann. Particle accelerator physics: Third edition. Berlin, Heidelberg:
Springer, 2007, pp. 1948. isbn: 9783540490432. doi: 10.1007/978-3-540-49045-
6. url: http://link.springer.com/10.1007/978-3-540-49045-6.
[4] C. E. Mitchell and A. J. Dragt. Accurate transfer maps for realistic beam-line
elements: Straight elements. In: Physical Review Special Topics - Accelerators and
Beams 13.6 (2010), p. 064001. issn: 10984402. doi: 10.1103/PhysRevSTAB.13.
064001. url: http://link.aps.org/doi/10.1103/PhysRevSTAB.13.064001.
[5] B. D. Muratori, J. K. Jones and A. Wolski. Analytical expressions for fringe fields
in multipole magnets. In: Physical Review Special Topics - Accelerators and Beams
18.6 (2015), p. 064001. issn: 10984402. doi: 10.1103/PhysRevSTAB.18.064001.
arXiv: 1404.1762. url: http://link.aps.org/doi/10.1103/PhysRevSTAB.18.
064001.
[6] S. Kelly et al. Study of the Impact of Fringe Fields of the Large Aperture Triplets
on the Linear Optics of the HL-LHC. In: Proceedings of IPAC2013 1 (2013),
pp. 26422644. url: http://accelconf.web.cern.ch/AccelConf/IPAC2013/
papers/wepea059.pdf.
[7] CERN - BE/ABP Accelerator Beam Physics Group. MAD-X - Methodical Ac-
celerator Design. url: https://madx.web.cern.ch/madx/ (Accessed: 28 Feb.
2019).
[8] S. Fartoukh and R. D. Maria. Optics and Layout Solutions for Hl-Lhc With
Large Aperture Nb3Sn and Nb-Ti Inner Triplets *. In: Proceedings of IPAC2012.
2012, pp. 46. isbn: 9783954501151. url: https://accelconf.web.cern.ch/
accelconf/IPAC2012/papers/moppc011.pdf.
https://doi.org/10.1088/1748-0221/3/08/S08001
http://stacks.iop.org/1748-0221/3/i=08/a=S08001
http://hilumilhc.web.cern.ch
https://doi.org/10.1007/978-3-540-49045-6
https://doi.org/10.1007/978-3-540-49045-6
http://link.springer.com/10.1007/978-3-540-49045-6
https://doi.org/10.1103/PhysRevSTAB.13.064001
https://doi.org/10.1103/PhysRevSTAB.13.064001
http://link.aps.org/doi/10.1103/PhysRevSTAB.13.064001
https://doi.org/10.1103/PhysRevSTAB.18.064001
https://arxiv.org/abs/1404.1762
http://link.aps.org/doi/10.1103/PhysRevSTAB.18.064001
http://link.aps.org/doi/10.1103/PhysRevSTAB.18.064001
http://accelconf.web.cern.ch/AccelConf/IPAC2013/papers/wepea059.pdf
http://accelconf.web.cern.ch/AccelConf/IPAC2013/papers/wepea059.pdf
https://madx.web.cern.ch/madx/
https://accelconf.web.cern.ch/accelconf/IPAC2012/papers/moppc011.pdf
https://accelconf.web.cern.ch/accelconf/IPAC2012/papers/moppc011.pdf
Bibliography 122
[9] R. de Maria, S. Fartoukh and A. Bogomyagkov. HLLHCV1.0: HL-LHC Layout
and Optics Models for 150 MM NB3SN Triplets and Local Crab-Cavities. In:
Proceedings of IPAC2013. 2013. isbn: 9783954501229. url: https://cds.cern.
ch/record/1581701.
[10] A. Wolski. Beam Dynamics in High Energy Particle Accelerators. Imperial College
Press, 2014, p. 606. isbn: 978-1-78326-277-9. doi: 10.1142/p899. url: http:
//www.worldscientific.com/worldscibooks/10.1142/p899.
[11] B. Dalena et al. Fringe Fields Modeling for the High Luminosity Lhc Large
Aperture Quadrupoles. In: Proceedings of IPAC2014. 284404. 2014, pp. 993996.
isbn: 9783954501328.
[12] A. Bogomyagkov et al. Analysis of the Non-Linear Fringe Effects of Large Aperture
Triplets for the HL-LHC Project. In: Proceedings of IPAC2013. 2013, pp. 13. isbn:
9783954501229. url: http://cds.cern.ch/record/1591597.
[13] R. de Maria et al. Dynamic Aperture Studies for the Lhc High Luminosity Lattice
*. In: Proceedings of IPAC2015. 2015. isbn: 9783954501687.
[14] A. Wolski. Website of SAMM Tracking Code. url: http://pcwww.liv.ac.uk/
~awolski/main_links_computercodes.htm (Accessed: 28 Feb. 2019).
[15] K. M. Hock, A. Wolski and R. B. Appleby. Applying the "Simple Accelerator
Modelling in Matlab" (SAMM) Code To High Luminosity LHC Upgrade. In:
Proceedings of IPAC2013. 2013, pp. 26902692. isbn: 9783954501229.
[16] E. Forest, F. Schmidt and E. McIntosh. Introduction to the Polymorphic Tracking
Code. Tech. rep. CERN, 2002. url: https://cds.cern.ch/record/573082/
files/sl-2002-044.pdf.
[17] N. Phinney. ILC Reference Design Report-Accelerator Executive Summary. Tech.
rep. SLAC. url: http://tesla.desy.de..
[18] S. Jones, D. Newton and A. Wolski. Initial Estimate of Fringe Field Effects in
HL-LHC Using Frequency Map Analysis. In: Proceedings of IPAC2014. 2014,
pp. 10671070. isbn: 9783954501328. url: http://jacow.org/IPAC2014/papers/
tupro025.pdf.
[19] O. Karamyshev, D. Newton and C. Welsch. Optimization of Low Energy Elec-
trostatic Beamlines. In: Proceedings of IPAC2014. 2014, pp. 12021204. isbn:
9783954501328.
[20] J. Resta-Lpez et al. Beam Life Time and Stability Studies for Elena. In: Pro-
ceedings of IPAC2014. 2014, pp. 154156. isbn: 9783954501328.
[21] A. T. Herrod et al. Modelling of Curvilinear Electrostatic Multipoles in the
Fermilab Muon g-2 Storage Ring. In: Proceedings of IPAC2017. 2017. url: http:
//accelconf.web.cern.ch/AccelConf/ipac2017/papers/thpab055.pdf.
https://cds.cern.ch/record/1581701
https://cds.cern.ch/record/1581701
https://doi.org/10.1142/p899
http://www.worldscientific.com/worldscibooks/10.1142/p899
http://www.worldscientific.com/worldscibooks/10.1142/p899
http://cds.cern.ch/record/1591597
http://pcwww.liv.ac.uk/~awolski/main_links_computercodes.htm
http://pcwww.liv.ac.uk/~awolski/main_links_computercodes.htm
https://cds.cern.ch/record/573082/files/sl-2002-044.pdf
https://cds.cern.ch/record/573082/files/sl-2002-044.pdf
http://tesla.desy.de.
http://jacow.org/IPAC2014/papers/tupro025.pdf
http://jacow.org/IPAC2014/papers/tupro025.pdf
http://accelconf.web.cern.ch/AccelConf/ipac2017/papers/thpab055.pdf
http://accelconf.web.cern.ch/AccelConf/ipac2017/papers/thpab055.pdf
123 Bibliography
[22] R. Edgecock et al. EMMA -The Worlds first non-scaling FFAG. In: Proceedings
of EPAC2008. 2008, pp. 33803382. url: https://accelconf.web.cern.ch/
AccelConf/e08/papers/thpp004.pdf.
[23] Y. Papaphilippou. Detecting chaos in particle accelerators through the frequency
map analysis method. In: Chaos: An Interdisciplinary Journal of Nonlinear Science
24.2 (June 2014), p. 024412. issn: 1054-1500. doi: 10.1063/1.4884495. arXiv:
1406.1545v1. url: http://aip.scitation.org/doi/10.1063/1.4884495%
20https://arxiv.org/pdf/1406.1545.pdf.
[24] J. Laskar. Frequency map analysis and particle accelerators. In: Proceedings of
PAC2003. Vol. 1. 2. 2003. isbn: 0-7803-7738-9. doi: 10.1109/PAC.2003.1288929.
arXiv: 0305364 [math]. url: http://arxiv.org/abs/math/0305364.
[25] Y. Papaphilippou. Frequency maps of LHC models. In: Proceedings of PAC1999.
New York, 2003, pp. 15541556. doi: 10.1109/pac.1999.794171. url: https:
//inspirehep.net/record/499744/files/TUP35.PDF.
[26] J. Laskar, C. Froeschl and A. Celletti. The measure of chaos by the numerical
analysis of the fundamental frequencies. Application to the standard mapping. In:
Physica D: Nonlinear Phenomena 56.2-3 (1992), pp. 253269. issn: 01672789. doi:
10.1016/0167-2789(92)90028-L.
[27] J.-P. Koutchouk and G. Sterbini. An Early Beam Separation Scheme for the LHC
Luminosity Upgrade. In: Proceedings of EPAC2006. Edinburgh, 2006, pp. 2134
2136. url: https : / / accelconf . web . cern . ch / accelconf / e06 / PAPERS /
WEPCH094.PDF.
[28] R. de Maria, S. Fartoukh and M. Fitterer. HLLHCV1.1: Optics Version for the
HL-LHC Upgrade. In: Proceedings of IPAC2015. 2015. isbn: 9783954501687. url:
https://cds.cern.ch/record/2112237.
[29] M. Berz, B. Erdlyi and K. Makino. Fringe field effects in small rings of large
acceptance. In: Physical Review 3 (2000), pp. 111. issn: 1098-4402. doi: 10.
1103/PhysRevSTAB.3.124001. url: http://www.bt.pa.msu.edu/pub/papers/
fringeprstab/fringeprstab.pdf.
[30] H. A. Enge. Focusing of Charged Particles. In: Deflecting Magnets 2 (1967),
pp. 203264.
[31] A. J. Dragt. Lie Methods for Nonlinear Dynamics with Applications to Accel-
erator Physics. December. 2017. url: http://www.physics.umd.edu/dsat/
dsatliemethods.html.
[32] A. Wolski. Linear Dynamics in Particle Accelerators. 2012. url: http://pcwww.
liv.ac.uk/~awolski/.
https://accelconf.web.cern.ch/AccelConf/e08/papers/thpp004.pdf
https://accelconf.web.cern.ch/AccelConf/e08/papers/thpp004.pdf
https://doi.org/10.1063/1.4884495
https://arxiv.org/abs/1406.1545v1
http://aip.scitation.org/doi/10.1063/1.4884495%20https://arxiv.org/pdf/1406.1545.pdf
http://aip.scitation.org/doi/10.1063/1.4884495%20https://arxiv.org/pdf/1406.1545.pdf
https://doi.org/10.1109/PAC.2003.1288929
https://arxiv.org/abs/0305364
http://arxiv.org/abs/math/0305364
https://doi.org/10.1109/pac.1999.794171
https://inspirehep.net/record/499744/files/TUP35.PDF
https://inspirehep.net/record/499744/files/TUP35.PDF
https://doi.org/10.1016/0167-2789(92)90028-L
https://accelconf.web.cern.ch/accelconf/e06/PAPERS/WEPCH094.PDF
https://accelconf.web.cern.ch/accelconf/e06/PAPERS/WEPCH094.PDF
https://cds.cern.ch/record/2112237
https://doi.org/10.1103/PhysRevSTAB.3.124001
https://doi.org/10.1103/PhysRevSTAB.3.124001
http://www.bt.pa.msu.edu/pub/papers/fringeprstab/fringeprstab.pdf
http://www.bt.pa.msu.edu/pub/papers/fringeprstab/fringeprstab.pdf
http://www.physics.umd.edu/dsat/dsatliemethods.html
http://www.physics.umd.edu/dsat/dsatliemethods.html
http://pcwww.liv.ac.uk/~awolski/
http://pcwww.liv.ac.uk/~awolski/
Bibliography 124
[33] Y. K. Wu, E. Forest and D. S. Robin. Explicit symplectic integrator for s-dependent
static magnetic field. In: Physical Review E - Statistical Physics, Plasmas, Fluids,
and Related Interdisciplinary Topics 68.4 (2003). issn: 1063651X. doi: 10.1103/
PhysRevE.68.046502.
[34] A. Wolski. Nonlinear Dynamics for Particle Accelerators. 2006. url: http://
pcwww.liv.ac.uk/~awolski/.
[35] S. I. Bermudez. "Production of numeric fringe field grid data". Personal communic-
ation. 15th Feb. 2013.
[36] A. Wolski. "Fitting of the Enge field to the numeric field". Personal communication.
[37] A. Wolski. "Providing parsers for importing MAD to SAMM". Personal communic-
ation.
[38] MathWorks. MATLAB Documentation - fzero - Root of nonlinear function. url:
https://uk.mathworks.com/help/matlab/ref/fzero.html (Accessed: 28 May
2019).
[39] R. P. Brent. Algorithms for Minimization without Derivatives. Prentice-Hall, Engle-
wood Cliffs, NJ, 1973. isbn: 0-13-022335-2.
[40] A. Szczepkowicz. Application of transfer matrix and transfer function analysis
to grating-type dielectric laser accelerators: Ponderomotive focusing of electrons.
In: Physical Review Accelerators and Beams 20.8 (2017). issn: 24699888. doi:
10.1103/PhysRevAccelBeams.20.081302. url: https://journals.aps.org/
prab/pdf/10.1103/PhysRevAccelBeams.20.081302.
[41] A. V. Oppenheim. Discrete-time signal processing. Pearson Education India, 1999.
[42] GNU Project. "The GNU C Library documentation". url: https://www.gnu.org/
software/libc/manual/html_node/Infinity-and-NaN.html (Accessed: 21 Dec.
2019).
[43] W. Schadow. "B-Spline Library". Code is published online. url: http://www.
wolfgangschadow.com/software/ (Accessed: 16 Feb. 2019).
[44] Rogue Wave Software. "IMSL Maths Library". "There is also https://docs.
roguewave.com/imsl/fortran/6.0/math/default.htm?turl=bs3in.htm and
https://docs.roguewave.com/imsl/fortran/6.0/math/default.htm?turl=
bs3vl.htm". url: https://docs.roguewave.com/imsl/fortran/6.0/math/
default.htm?turl=bsnak.htm (Accessed: 17 Feb. 2019).
[45] C. De Boor et al. A practical guide to splines. Vol. 27. springer-verlag New York,
1978.
https://doi.org/10.1103/PhysRevE.68.046502
https://doi.org/10.1103/PhysRevE.68.046502
http://pcwww.liv.ac.uk/~awolski/
http://pcwww.liv.ac.uk/~awolski/
https://uk.mathworks.com/help/matlab/ref/fzero.html
https://doi.org/10.1103/PhysRevAccelBeams.20.081302
https://journals.aps.org/prab/pdf/10.1103/PhysRevAccelBeams.20.081302
https://journals.aps.org/prab/pdf/10.1103/PhysRevAccelBeams.20.081302
https://www.gnu.org/software/libc/manual/html_node/Infinity-and-NaN.html
https://www.gnu.org/software/libc/manual/html_node/Infinity-and-NaN.html
http://www.wolfgangschadow.com/software/
http://www.wolfgangschadow.com/software/
https://docs.roguewave.com/imsl/fortran/6.0/math/default.htm?turl=bs3in.htm
https://docs.roguewave.com/imsl/fortran/6.0/math/default.htm?turl=bs3in.htm
 https://docs.roguewave.com/imsl/fortran/6.0/math/default.htm?turl=bs3vl.htm"
 https://docs.roguewave.com/imsl/fortran/6.0/math/default.htm?turl=bs3vl.htm"
https://docs.roguewave.com/imsl/fortran/6.0/math/default.htm?turl=bsnak.htm
https://docs.roguewave.com/imsl/fortran/6.0/math/default.htm?turl=bsnak.htm
125 Bibliography
[46] M. Berry. Universal oscillations of high derivatives. In: Proceedings of the Royal
Society A: Mathematical, Physical and Engineering Sciences 461.2058 (2005),
pp. 17351751. issn: 1364-5021. doi: 10.1098/rspa.2005.1446. url: https://
pdfs.semanticscholar.org/5894/498141d9c79ee33dd13419118b37fb17888c.
pdf%20http://rspa.royalsocietypublishing.org/cgi/doi/10.1098/rspa.
2005.1446.
[47] Mathworks. MATLAB Documentation - fit - Fit curve or surface to data. url:
https://uk.mathworks.com/help/curvefit/fit.html (Accessed: 18 June
2019).
[48] G. Hoffstaetter. Advanced Accelerator Physics. 2010. url: https://www.classe.
cornell.edu/~hoff/LECTURES/10USPAS/ (Accessed: 18 June 2019).
[49] E. Mcintosh, R. D. Maria and M. Giovannozzi. Investigation of Numerical Precision
Issues of Long Term Single Particle Tracking. In: Proceedings of IPAC2013. 2013,
pp. 942944. isbn: 9783954501229.
[50] R. De Maria, D. Gamba and F. Plassard. Update on the V1.4 optics. 2018.
url: https : / / indico . cern . ch / event / 750135 / contributions / 3104578 /
attachments/1702836/2742913/HL14-WP2-2.pdf.
[51] G. Arduini et al. Optics and Layout V1.2. 2015. url: https://indico.cern.
ch/event/394926/contributions/938361/attachments/1131849/1618192/
Layoutv1.2.pdf.
[52] R. De Maria. Status of v1.3 optics. 2017. url: https://indico.cern.ch/event/
627307/contributions/2535226/attachments/1441305/2219084/OpticsV1.
3_v2.pdf.
https://doi.org/10.1098/rspa.2005.1446
https://pdfs.semanticscholar.org/5894/498141d9c79ee33dd13419118b37fb17888c.pdf%20http://rspa.royalsocietypublishing.org/cgi/doi/10.1098/rspa.2005.1446
https://pdfs.semanticscholar.org/5894/498141d9c79ee33dd13419118b37fb17888c.pdf%20http://rspa.royalsocietypublishing.org/cgi/doi/10.1098/rspa.2005.1446
https://pdfs.semanticscholar.org/5894/498141d9c79ee33dd13419118b37fb17888c.pdf%20http://rspa.royalsocietypublishing.org/cgi/doi/10.1098/rspa.2005.1446
https://pdfs.semanticscholar.org/5894/498141d9c79ee33dd13419118b37fb17888c.pdf%20http://rspa.royalsocietypublishing.org/cgi/doi/10.1098/rspa.2005.1446
https://uk.mathworks.com/help/curvefit/fit.html
https://www.classe.cornell.edu/~hoff/LECTURES/10USPAS/
https://www.classe.cornell.edu/~hoff/LECTURES/10USPAS/
https://indico.cern.ch/event/750135/contributions/3104578/attachments/1702836/2742913/HL14-WP2-2.pdf
https://indico.cern.ch/event/750135/contributions/3104578/attachments/1702836/2742913/HL14-WP2-2.pdf
https://indico.cern.ch/event/394926/contributions/938361/attachments/1131849/1618192/Layoutv1.2.pdf
https://indico.cern.ch/event/394926/contributions/938361/attachments/1131849/1618192/Layoutv1.2.pdf
https://indico.cern.ch/event/394926/contributions/938361/attachments/1131849/1618192/Layoutv1.2.pdf
https://indico.cern.ch/event/627307/contributions/2535226/attachments/1441305/2219084/OpticsV1.3_v2.pdf
https://indico.cern.ch/event/627307/contributions/2535226/attachments/1441305/2219084/OpticsV1.3_v2.pdf
https://indico.cern.ch/event/627307/contributions/2535226/attachments/1441305/2219084/OpticsV1.3_v2.pdf
	Title Page
	Contents
	List of Figures
	List of Tables
	Abstract
	Acknowledgements
	1 Introduction
	2 Literature Review
	2.1 HL-LHC studies
	2.1.1 The effect of fringe fields on the linear optics of the HL-LHC
	2.1.2 Numeric estimate of the impact of the fringe fields
	2.1.3 Dynamic aperture studies for the HL-LHC optics
	2.2 Benchmarking SAMM against PTC and MAD-X using LHC optics
	2.3 Generalised gradients
	2.4 Differential algebra BlitzDA code
	2.5 Analytic description of a fringe field
	2.6 Frequency map analysis
	3 Physics Theory
	3.1 Magnets in accelerators
	3.1.1 Multipole fields
	3.1.2 Quadrupoles
	3.1.3 HL-LHC lattice
	3.1.4 Fringe fields
	3.1.5 Enge fields
	3.1.6 Generalised gradients
	3.1.7 Electromagnetic fields with s-dependence
	3.2 Particle dynamics discussion
	3.2.1 Newtonian mechanics
	3.2.2 Lagrangian mechanics
	3.2.3 Hamiltonian mechanics
	3.2.4 Dynamical variables from a Hamiltonian
	3.2.5 Transfer maps for beamline elements
	3.2.6 Symplecticity
	3.2.7 The FODO lattice
	3.2.8 Courant-Snyder parameters
	3.2.9 Chromaticity
	Chromaticity of a FODO
	Chromaticity in a storage ring
	3.2.10 Tracking with many particles
	3.2.11 Coupled optics
	3.2.12 Tune shift with amplitude and frequency map analysis
	3.2.13 Dynamic aperture
	3.3 Numeric integration methods
	3.3.1 Wu-Forest-Robin
	3.3.2 Implicit Runge-Kutta
	4 Method
	4.1 Magnetic field descriptions of the inner triplet
	4.1.1 Simulating the numeric field
	4.1.2 Fitting the Enge field
	4.1.3 Generating the generalised gradients
	Cylindrical surface data creation
	Constructing generalised gradients from surface data
	4.2 Construction of the HL-LHC in the simulation
	4.2.1 Importing a MAD lattice into SAMM
	4.2.2 Adding fringe fields to the HL-LHC lattice
	4.2.3 Restoring the desired chromaticity of the HL-LHC lattice
	4.3 Techniques used to produce results
	4.3.1 Transfer functions
	4.3.2 Numerical analysis of fundamental frequencies (NAFF)
	4.3.3 Chromaticity investigations
	4.3.4 Tune shift with amplitude
	4.3.5 Frequency map analysis
	4.3.6 Processing the tracking results
	4.4 BlitzDA differential algebra code
	4.5 SAMM particle tracking code
	5 Results
	5.1 Generalised gradients
	5.2 Transfer functions
	5.3 Chromaticity
	5.4 Tune shift with amplitude
	5.5 Frequency map analysis
	6 Conclusions
	6.1 Summary and conclusions
	6.2 Recommendations for further work
	6.3 Closing remarks
	List of Publications
	Bibliography
